local encoded = "DQotLSBVbWFyIEh1YiBQYXlsb2FkIEd1YXJkDQppZiBub3QgZ2V0Z2VudigpLlVtYXJIdWJfTG9hZGVyIHRoZW4NCiAgICB3YXJuKCJVbWFyIEh1YjogVW5hdXRob3JpemVkIGV4ZWN1dGlvbi4iKQ0KICAgIHJldHVybg0KZW5kDQoNCi0tLy8gVU1BUiBIVUIgfCBSaXZhbHMNCi0tLy8gUmVicmFuZGVkIGZyb20gOGJpdA0KLS0vLyBUZXN0IGJ1aWxkIChubyBsb2FkZXIgeWV0KQ0KDQppZiBub3QgZ2FtZTpJc0xvYWRlZCgpIHRoZW4NCiAgICBnYW1lLkxvYWRlZDpXYWl0KCkNCmVuZA0KDQpsb2NhbCBGbHVlbnQgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgNCiAgICAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3BlcmZlY3RCbHVlMFgvdGhlLXJpdmFscy9yZWZzL2hlYWRzL21haW4vOGJpdGZsdWVudC5sdWEiDQopKSgpDQoNCg0KbG9jYWwgU2F2ZU1hbmFnZXIgPSBsb2Fkc3RyaW5nKGdhbWU6SHR0cEdldCgNCiAgICAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL2Rhd2lkLXNjcmlwdHMvRmx1ZW50L21hc3Rlci9BZGRvbnMvU2F2ZU1hbmFnZXIubHVhIg0KKSkoKQ0KDQpsb2NhbCBJbnRlcmZhY2VNYW5hZ2VyID0gbG9hZHN0cmluZyhnYW1lOkh0dHBHZXQoDQogICAgImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9kYXdpZC1zY3JpcHRzL0ZsdWVudC9tYXN0ZXIvQWRkb25zL0ludGVyZmFjZU1hbmFnZXIubHVhIg0KKSkoKQ0KDQoNCi0tIHZuZXcNCmxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikNCmxvY2FsIFdpbmRvdyA9IEZsdWVudDpDcmVhdGVXaW5kb3coew0KICAgIFRpdGxlID0gIlVNQVIgSFVCIFtSaXZhbHNdICIgLi4gRmx1ZW50LlZlcnNpb24sDQogICAgU3ViVGl0bGUgPSAidGVzdCBidWlsZCIsDQogICAgVGFiV2lkdGggPSAxNjAsDQogICAgU2l6ZSA9IFVEaW0yLmZyb21PZmZzZXQoNjAwLCA0NzApLA0KICAgIEFjcnlsaWMgPSBmYWxzZSwNCiAgICBUaGVtZSA9ICJEZWZhdWx0IiwNCg0KDQogICAgTWluaW1pemVLZXkgPSBFbnVtLktleUNvZGUuTGVmdENvbnRyb2wNCn0pDQoNCmxvY2FsIFRhYnMgPSB7DQogICAgV2xjID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIkJvYXJkaW5nIiwgSWNvbiA9ICJyYnhhc3NldGlkOi8vMTA3MjM0MDczODkiIH0pLA0KICAgIE1haW4gPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiVmlzdWFscyIsIEljb24gPSAiaGV4YWdvbiIgfSksDQogICAgQWltVGFiID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIkFpbSBGZWF0dXJlcyIsIEljb24gPSAibW91c2UiIH0pLA0KICAgIFNpbGVudCA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJTaWxlbnQgW0JldGFdIiwgSWNvbiA9ICJyYnhhc3NldGlkOi8vNzY2NjAxMDAyMTg3NjAiIH0pLA0KICAgIFNraW56ID0gV2luZG93OkFkZFRhYih7IFRpdGxlID0gIlNraW4gQ2hhbmdlciIsIEljb24gPSAic3dvcmRzIiB9KSwNCiAgICBFc3NlbnRpYWwgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiRXNzZW50aWFsIiwgSWNvbiA9ICJyYnhhc3NldGlkOi8vMTA3MDk4MTkxNDkiIH0pLA0KICAgIE1vZFRhYiA9IFdpbmRvdzpBZGRUYWIoeyBUaXRsZSA9ICJNb2RzIiwgSWNvbiA9ICJyYnhhc3NldGlkOi8vMTA3MjM0MDUzNjAiIH0pLA0KICAgIE1pc2MgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiTWlzYyIsIEljb24gPSAibGlzdC1tdXNpYyIgfSksDQogICAgU2V0dGluZ3MgPSBXaW5kb3c6QWRkVGFiKHsgVGl0bGUgPSAiQ29uZmlnIiwgSWNvbiA9ICJzZXR0aW5ncy0yIiB9KQ0KfQ0KDQpsb2NhbCBPcHRpb25zID0gRmx1ZW50Lk9wdGlvbnMNCg0KZG8NCg0KDQoNCg0KDQotLS0tLS0tLUFuaW1hdG9yLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpsb2NhbCBUd2VlblNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlR3ZWVuU2VydmljZSIpDQpsb2NhbCBzY3JlZW5HdWkgPSBJbnN0YW5jZS5uZXcoIlNjcmVlbkd1aSIpDQpzY3JlZW5HdWkuUmVzZXRPblNwYXduID0gZmFsc2UNCnNjcmVlbkd1aS5QYXJlbnQgPSBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKQ0KDQpsb2NhbCB4UG9zT2Zmc2V0ID0gLTIxMA0KbG9jYWwgc3RhcnRZID0gMA0KbG9jYWwgdGV4dExhYmVsc0RhdGEgPSB7DQogICAgdGV4dExhYmVsMSA9ICJQbGF5ZXIgRXNwIFtEcmF3aW5nXSIsDQogICAgdGV4dExhYmVsMiA9ICJBaW1ib3QgW0NhbV0iLA0KICAgIHRleHRMYWJlbDMgPSAiQWltYm90IFtJbnB1dF0iLA0KICAgIGJfZWZmZWN0ID0gIkJ1bGxldCBFZmZlY3RzIiwNCiAgICB0ZXh0TGFiZWw1ID0gIkhpdCBNYXJrZXIiLA0KICAgIGF0bW9zcGhlcmUgPSAiQXRtb3NwaGVyZSIsDQogICAgZ2hvc3R0eHQgPSAiR2hvc3QgSGFuZHMiLA0KICAgIHNpbGVudGFpbSA9ICJTaWxlbnQgQWltIg0KfQ0KDQpsb2NhbCB0ZXh0TGFiZWxzID0ge30NCmxvY2FsIHlJbnRlcnZhbCA9IDMwDQoNCmxvY2FsIGZ1bmN0aW9uIGNyZWF0ZVRleHRMYWJlbChuYW1lLCB0ZXh0LCB5T2Zmc2V0KQ0KICAgIGxvY2FsIHRleHRMYWJlbCA9IEluc3RhbmNlLm5ldygiVGV4dExhYmVsIikNCiAgICB0ZXh0TGFiZWwuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMDAsIDAsIDI1KQ0KICAgIHRleHRMYWJlbC5Qb3NpdGlvbiA9IFVEaW0yLm5ldygxLCB4UG9zT2Zmc2V0LCAwLCB5T2Zmc2V0KQ0KICAgIHRleHRMYWJlbC5UZXh0ID0gdGV4dA0KICAgIHRleHRMYWJlbC5UZXh0Q29sb3IzID0gQ29sb3IzLm5ldygxLCAxLCAxKQ0KICAgIHRleHRMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgIHRleHRMYWJlbC5Gb250RmFjZSA9IEZvbnQubmV3KCdyYnhhc3NldGlkOi8vMTY2NTgyMzcxNzQnKQ0KICAgIHRleHRMYWJlbC5UZXh0U2l6ZSA9IDE4DQogICAgdGV4dExhYmVsLlRleHRYQWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5SaWdodA0KICAgIHRleHRMYWJlbC5QYXJlbnQgPSBzY3JlZW5HdWkNCiAgICB0ZXh0TGFiZWwuVGV4dFN0cm9rZVRyYW5zcGFyZW5jeSA9IDENCiAgICB0ZXh0TGFiZWwuVGV4dFN0cm9rZUNvbG9yMyA9IENvbG9yMy5uZXcoMCwgMCwgMCkNCiAgICB0ZXh0TGFiZWxzW25hbWVdID0gdGV4dExhYmVsDQogICAgcmV0dXJuIHRleHRMYWJlbA0KZW5kDQoNCmxvY2FsIGN1cnJlbnRZID0gc3RhcnRZDQpmb3IgbmFtZSwgdGV4dCBpbiBwYWlycyh0ZXh0TGFiZWxzRGF0YSkgZG8NCiAgICBjcmVhdGVUZXh0TGFiZWwobmFtZSwgdGV4dCwgY3VycmVudFkpDQogICAgY3VycmVudFkgPSBjdXJyZW50WSArIHlJbnRlcnZhbA0KZW5kDQoNCmxvY2FsIGZ1bmN0aW9uIGFsaWduVGV4dExhYmVscygpDQogICAgbG9jYWwgY3VycmVudFkgPSBzdGFydFkNCiAgICBsb2NhbCB0d2VlbnMgPSB7fQ0KICAgIGZvciBfLCBsYWJlbCBpbiBwYWlycyh0ZXh0TGFiZWxzKSBkbw0KICAgICAgICBpZiBsYWJlbC5WaXNpYmxlIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIHR3ZWVuSW5mbyA9IFR3ZWVuSW5mby5uZXcoMC4yLCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCkNCiAgICAgICAgICAgIGxvY2FsIGdvYWwgPSB7UG9zaXRpb24gPSBVRGltMi5uZXcoMSwgeFBvc09mZnNldCwgMCwgY3VycmVudFkpfQ0KICAgICAgICAgICAgbG9jYWwgdHdlZW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKGxhYmVsLCB0d2VlbkluZm8sIGdvYWwpDQogICAgICAgICAgICB0YWJsZS5pbnNlcnQodHdlZW5zLCB0d2VlbikNCiAgICAgICAgICAgIGN1cnJlbnRZID0gY3VycmVudFkgKyB5SW50ZXJ2YWwNCiAgICAgICAgZW5kDQogICAgZW5kDQogICAgZm9yIF8sIHR3ZWVuIGluIGlwYWlycyh0d2VlbnMpIGRvDQogICAgICAgIHR3ZWVuOlBsYXkoKQ0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIFNsaWRlciA9IFRhYnMuTWlzYzpBZGRTbGlkZXIoIkdhcFNsaWRlciIsIHsNCiAgICBUaXRsZSA9ICJHYXAgU2VsZWN0IiwNCiAgICBEZXNjcmlwdGlvbiA9ICJBZGp1c3QgdGhlIGdhcCBzaXplIiwNCiAgICBEZWZhdWx0ID0geUludGVydmFsLA0KICAgIE1pbiA9IDUsDQogICAgTWF4ID0gMTAwLA0KICAgIFJvdW5kaW5nID0gMSwNCn0pDQoNClNsaWRlcjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpDQogICAgeUludGVydmFsID0gVmFsdWUNCiAgICBhbGlnblRleHRMYWJlbHMoKQ0KZW5kKQ0KDQpsb2NhbCBmdW5jdGlvbiBmYWRlVGV4dChsYWJlbCwgZmFkZUluKQ0KICAgIGxvY2FsIHR3ZWVuSW5mbyA9IFR3ZWVuSW5mby5uZXcoMC4yLCBFbnVtLkVhc2luZ1N0eWxlLlF1YWQsIEVudW0uRWFzaW5nRGlyZWN0aW9uLk91dCkNCiAgICBsb2NhbCBnb2FsID0gZmFkZUluIGFuZCB7VGV4dFRyYW5zcGFyZW5jeSA9IDB9IG9yIHtUZXh0VHJhbnNwYXJlbmN5ID0gMX0NCiAgICBsb2NhbCB0d2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUobGFiZWwsIHR3ZWVuSW5mbywgZ29hbCkNCiAgICB0d2VlbjpQbGF5KCkNCmVuZA0KDQpsb2NhbCBjdXJyZW50QW5pbWF0aW9uVHlwZSA9ICJOb25lIg0KbG9jYWwgaXNBbmltYXRpbmcgPSBmYWxzZQ0KDQpsb2NhbCBmdW5jdGlvbiBhbmltYXRlVGV4dExvb3AoKQ0KICAgIHdoaWxlIGN1cnJlbnRBbmltYXRpb25UeXBlID09ICJGYWRlIiBkbw0KICAgICAgICBmb3IgXywgbGFiZWwgaW4gcGFpcnModGV4dExhYmVscykgZG8NCiAgICAgICAgICAgIGxvY2FsIGZhZGVPdXRUd2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUobGFiZWwsIFR3ZWVuSW5mby5uZXcoMC4yKSwge1RleHRUcmFuc3BhcmVuY3kgPSAwLjV9KQ0KICAgICAgICAgICAgbG9jYWwgZmFkZUluVHdlZW4gPSBUd2VlblNlcnZpY2U6Q3JlYXRlKGxhYmVsLCBUd2VlbkluZm8ubmV3KDAuMiksIHtUZXh0VHJhbnNwYXJlbmN5ID0gMH0pDQogICAgICAgICAgICBmYWRlT3V0VHdlZW46UGxheSgpDQogICAgICAgICAgICBmYWRlT3V0VHdlZW4uQ29tcGxldGVkOldhaXQoKQ0KICAgICAgICAgICAgZmFkZUluVHdlZW46UGxheSgpDQogICAgICAgICAgICBmYWRlSW5Ud2Vlbi5Db21wbGV0ZWQ6V2FpdCgpDQogICAgICAgIGVuZA0KICAgICAgICB3YWl0KDAuMikNCiAgICBlbmQNCmVuZA0KDQpsb2NhbCBmdW5jdGlvbiBjb2xvckZsYXNoQW5pbWF0aW9uKCkNCiAgICB3aGlsZSBjdXJyZW50QW5pbWF0aW9uVHlwZSA9PSAiQ29sb3IgRmxhc2giIGRvDQogICAgICAgIGZvciBfLCBsYWJlbCBpbiBwYWlycyh0ZXh0TGFiZWxzKSBkbw0KICAgICAgICAgICAgbG9jYWwgZmxhc2hUd2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUobGFiZWwsIFR3ZWVuSW5mby5uZXcoMC4xKSwge1RleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigxNzMsIDIxNiwgMjMwKX0pDQogICAgICAgICAgICBsb2NhbCByZXZlcnRUd2VlbiA9IFR3ZWVuU2VydmljZTpDcmVhdGUobGFiZWwsIFR3ZWVuSW5mby5uZXcoMC4xKSwge1RleHRDb2xvcjMgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KX0pDQogICAgICAgICAgICBmbGFzaFR3ZWVuOlBsYXkoKQ0KICAgICAgICAgICAgZmxhc2hUd2Vlbi5Db21wbGV0ZWQ6V2FpdCgpDQogICAgICAgICAgICByZXZlcnRUd2VlbjpQbGF5KCkNCiAgICAgICAgICAgIHJldmVydFR3ZWVuLkNvbXBsZXRlZDpXYWl0KCkNCiAgICAgICAgZW5kDQogICAgICAgIHdhaXQoMC4yKQ0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIGFuaW1hdGlvbkRyb3Bkb3duID0gVGFicy5NaXNjOkFkZERyb3Bkb3duKCJBbmltYXRpb25UeXBlRHJvcGRvd24iLCB7DQogICAgVGl0bGUgPSAiVGV4dCBBbmltYXRpb24iLA0KICAgIFZhbHVlcyA9IHsiTm9uZSIsICJGYWRlIiwgIkNvbG9yIEZsYXNoIn0sDQogICAgTXVsdGkgPSBmYWxzZSwNCiAgICBEZWZhdWx0ID0gMSwNCn0pDQoNCmFuaW1hdGlvbkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihzZWxlY3RlZEFuaW1hdGlvbikNCiAgICBpZiBzZWxlY3RlZEFuaW1hdGlvbiA9PSAiRmFkZSIgYW5kIG5vdCBpc0FuaW1hdGluZyB0aGVuDQogICAgICAgIGN1cnJlbnRBbmltYXRpb25UeXBlID0gc2VsZWN0ZWRBbmltYXRpb24NCiAgICAgICAgaXNBbmltYXRpbmcgPSB0cnVlDQogICAgICAgIHNwYXduKGFuaW1hdGVUZXh0TG9vcCkNCiAgICBlbHNlaWYgc2VsZWN0ZWRBbmltYXRpb24gPT0gIkNvbG9yIEZsYXNoIiBhbmQgbm90IGlzQW5pbWF0aW5nIHRoZW4NCiAgICAgICAgY3VycmVudEFuaW1hdGlvblR5cGUgPSBzZWxlY3RlZEFuaW1hdGlvbg0KICAgICAgICBpc0FuaW1hdGluZyA9IHRydWUNCiAgICAgICAgc3Bhd24oY29sb3JGbGFzaEFuaW1hdGlvbikNCiAgICBlbHNlaWYgc2VsZWN0ZWRBbmltYXRpb24gPT0gIk5vbmUiIHRoZW4NCiAgICAgICAgY3VycmVudEFuaW1hdGlvblR5cGUgPSAiTm9uZSINCiAgICAgICAgaXNBbmltYXRpbmcgPSBmYWxzZQ0KICAgIGVuZA0KZW5kKQ0KDQpsb2NhbCBEcm9wZG93biA9IFRhYnMuTWlzYzpBZGREcm9wZG93bigiU3RhdFRleHRBbGlnbkRyb3Bkb3duIiwgew0KICAgIFRpdGxlID0gIlRleHQgQWxpZ25tZW50IiwNCiAgICBWYWx1ZXMgPSB7IkxlZnQiLCAiQ2VudGVyIiwgIlJpZ2h0In0sDQogICAgTXVsdGkgPSBmYWxzZSwNCiAgICBEZWZhdWx0ID0gMywNCn0pDQoNCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCiAgICBsb2NhbCBhbGlnbm1lbnQgPSBFbnVtLlRleHRYQWxpZ25tZW50LlJpZ2h0DQogICAgaWYgVmFsdWUgPT0gIkxlZnQiIHRoZW4NCiAgICAgICAgYWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5MZWZ0DQogICAgZWxzZWlmIFZhbHVlID09ICJDZW50ZXIiIHRoZW4NCiAgICAgICAgYWxpZ25tZW50ID0gRW51bS5UZXh0WEFsaWdubWVudC5DZW50ZXINCiAgICBlbmQNCiAgICBmb3IgXywgbGFiZWwgaW4gcGFpcnModGV4dExhYmVscykgZG8NCiAgICAgICAgbGFiZWwuVGV4dFhBbGlnbm1lbnQgPSBhbGlnbm1lbnQNCiAgICBlbmQNCiAgICBhbGlnblRleHRMYWJlbHMoKQ0KZW5kKQ0KDQpsb2NhbCBJbnB1dCA9IFRhYnMuTWlzYzpBZGRJbnB1dCgiU3RhdFRleHRQb3NJbnB1dCIsIHsNCiAgICBUaXRsZSA9ICJJbnB1dCIsDQogICAgRGVmYXVsdCA9IHRvc3RyaW5nKC0yMTApLA0KICAgIFBsYWNlaG9sZGVyID0gIkVudGVyIHggcG9zaXRpb24iLA0KICAgIE51bWVyaWMgPSB0cnVlLA0KfSkNCg0KSW5wdXQ6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBpbnB1dFZhbCA9IHRvbnVtYmVyKElucHV0LlZhbHVlKQ0KICAgIGlmIGlucHV0VmFsIHRoZW4NCiAgICAgICAgeFBvc09mZnNldCA9IGlucHV0VmFsDQogICAgICAgIGFsaWduVGV4dExhYmVscygpDQogICAgZW5kDQplbmQpDQoNCmxvY2FsIFRvZ2dsZU91dGxpbmUgPSBUYWJzLk1pc2M6QWRkVG9nZ2xlKCJTdGF0VGV4dFRvZ2dsZU91dGxpbmUiLCB7VGl0bGUgPSAiVG9nZ2xlIHRoZSBUZXh0IE91dGxpbmUiLCBEZWZhdWx0ID0gZmFsc2V9KQ0KDQpUb2dnbGVPdXRsaW5lOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgbG9jYWwgb3V0bGluZUVuYWJsZWQgPSBPcHRpb25zLlN0YXRUZXh0VG9nZ2xlT3V0bGluZS5WYWx1ZQ0KICAgIGZvciBfLCBsYWJlbCBpbiBwYWlycyh0ZXh0TGFiZWxzKSBkbw0KICAgICAgICBsYWJlbC5UZXh0U3Ryb2tlVHJhbnNwYXJlbmN5ID0gb3V0bGluZUVuYWJsZWQgYW5kIDAgb3IgMQ0KICAgIGVuZA0KZW5kKQ0KDQpsb2NhbCBTbGlkZXIgPSBUYWJzLk1pc2M6QWRkU2xpZGVyKCJTdGF0VGV4dFNsaWRlciIsIHsNCiAgICBUaXRsZSA9ICJUZXh0IFNpemUiLA0KICAgIERlc2NyaXB0aW9uID0gIkFkanVzdCB0aGUgdGV4dCBzaXplIiwNCiAgICBEZWZhdWx0ID0gMTgsDQogICAgTWluID0gNSwNCiAgICBNYXggPSAxMDAsDQogICAgUm91bmRpbmcgPSAxLA0KfSkNCg0KU2xpZGVyOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCiAgICBmb3IgXywgbGFiZWwgaW4gcGFpcnModGV4dExhYmVscykgZG8NCiAgICAgICAgbGFiZWwuVGV4dFNpemUgPSBWYWx1ZQ0KICAgIGVuZA0KZW5kKQ0KDQpsb2NhbCBDb2xvcnBpY2tlciA9IFRhYnMuTWlzYzpBZGRDb2xvcnBpY2tlcigiU3RhdFR4dENvbG9ycGlja2VyIiwgew0KICAgIFRpdGxlID0gIlRleHQgQ29sb3IiLA0KICAgIERlZmF1bHQgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDI1NSwgMjU1KQ0KfSkNCg0KQ29sb3JwaWNrZXI6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBzZWxlY3RlZENvbG9yID0gT3B0aW9ucy5TdGF0VHh0Q29sb3JwaWNrZXIgYW5kIE9wdGlvbnMuU3RhdFR4dENvbG9ycGlja2VyLlZhbHVlIG9yIENvbG9ycGlja2VyLlZhbHVlDQogICAgZm9yIF8sIGxhYmVsIGluIHBhaXJzKHRleHRMYWJlbHMpIGRvDQogICAgICAgIGxhYmVsLlRleHRDb2xvcjMgPSBzZWxlY3RlZENvbG9yDQogICAgZW5kDQplbmQpDQoNCmFsaWduVGV4dExhYmVscygpDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0td2VsY29tZS0tDQpsb2NhbCBQbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KbG9jYWwgQ2FtZXJhID0gZ2FtZTpHZXRTZXJ2aWNlKCJXb3Jrc3BhY2UiKS5DdXJyZW50Q2FtZXJhDQpsb2NhbCBNb3VzZSA9IFBsYXllcjpHZXRNb3VzZSgpDQoNCiAgICBGbHVlbnQ6Tm90aWZ5KHsNCiAgICAgICAgVGl0bGUgPSAiTG9hZGluZyBNb2R1bGUuLi4iLA0KICAgICAgICBDb250ZW50ID0gIk1vZHVsZSBMb2FkZWQgWzcvMThdIiwNCiAgICAgICAgRHVyYXRpb24gPSAzDQogICAgfSkNCg0KDQoNCiAgICBsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikNCiAgICBsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikNCiAgICANCiAgICAtLSBGdW5jdGlvbiB0byBnZXQgY3VycmVudCBkZXZpY2UgaW5mbw0KICAgIGxvY2FsIGZ1bmN0aW9uIGdldERldmljZVR5cGUoKQ0KICAgICAgICByZXR1cm4gVXNlcklucHV0U2VydmljZS5Ub3VjaEVuYWJsZWQgYW5kICJNb2JpbGUiIG9yICJQQyINCiAgICBlbmQNCiAgICANCiAgICAtLSBGdW5jdGlvbiB0byBjcmVhdGUgaW5pdGlhbCBjb250ZW50IGZvciB0aGUgcGFyYWdyYXBoDQogICAgbG9jYWwgZnVuY3Rpb24gZ2V0RXhlY3V0aW9uRGV0YWlscygpDQogICAgICAgIGxvY2FsIHBsYXllciA9IFBsYXllcnMuTG9jYWxQbGF5ZXINCiAgICAgICAgbG9jYWwgZGlzcGxheU5hbWUgPSBwbGF5ZXIuRGlzcGxheU5hbWUNCiAgICAgICAgbG9jYWwgdXNlcm5hbWUgPSBwbGF5ZXIuTmFtZQ0KICAgICAgICBsb2NhbCBleGVjdXRvciA9IGlkZW50aWZ5ZXhlY3V0b3IoKSAgLS0gR2V0IHRoZSBleGVjdXRvciBuYW1lDQogICAgICAgIGxvY2FsIGRldmljZVR5cGUgPSBnZXREZXZpY2VUeXBlKCkNCiAgICAgICAgbG9jYWwgZGV2aWNlVGltZSA9IG9zLmRhdGUoIiVZLSVtLSVkICVJOiVNOiVTICVwIikgIC0tIDEyLWhvdXIgZm9ybWF0IHdpdGggQU0vUE0NCiAgICANCiAgICAgICAgcmV0dXJuICJFeGVjdXRlZCBieTogIiAuLiBkaXNwbGF5TmFtZSAuLiAiICgiIC4uIHVzZXJuYW1lIC4uICIpXG4iIC4uDQogICAgICAgICAgICAiRGV2aWNlOiAiIC4uIGRldmljZVR5cGUgLi4gIlxuIiAuLg0KICAgICAgICAgICAgIkV4ZWN1dG9yOiAiIC4uIGV4ZWN1dG9yIC4uICJcbiIgLi4NCiAgICAgICAgICAgICJEZXZpY2UgVGltZTogIiAuLiBkZXZpY2VUaW1lDQogICAgZW5kDQogICAgDQogICAgLS0gU2V0IHVwIHRoZSBwYXJhZ3JhcGggd2l0aCBvbmUtdGltZSBjb250ZW50DQogICAgVGFicy5XbGM6QWRkUGFyYWdyYXBoKHsNCiAgICAgICAgVGl0bGUgPSAiRXhlY3V0aW9uIERldGFpbHMiLA0KICAgICAgICBDb250ZW50ID0gZ2V0RXhlY3V0aW9uRGV0YWlscygpICAtLSBTZXQgY29udGVudCBvbmNlDQogICAgfSkNCg0KICAgIFRhYnMuV2xjOkFkZFBhcmFncmFwaCh7DQogICAgICAgIFRpdGxlID0gIkFyZSB5b3Ugd2lubmluZyBzb24gPyIsDQogICAgICAgIENvbnRlbnQgPSAiIg0KICAgIH0pDQoNCg0KLS0tVmlzdWFscy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCmxvY2FsIGVzcF9zZXR0aW5ncyA9IHsgLS0tLSB0YWJsZSBmb3IgZXNwIHNldHRpbmdzIA0KdGV4dHNpemUgPSAxMiwNCmNvbG91ciA9IENvbG9yMy5mcm9tUkdCKDI1NSwgMjU1LCAyNTUpLA0Kc3Ryb2tlQ29sb3VyID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCksDQptYXhEaXN0YW5jZSA9IDMwMA0KfQ0KDQpsb2NhbCBndWlUZW1wbGF0ZSA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikNCmxvY2FsIGVzcFRlbXBsYXRlID0gSW5zdGFuY2UubmV3KCJUZXh0TGFiZWwiLCBndWlUZW1wbGF0ZSkNCg0KZ3VpVGVtcGxhdGUuTmFtZSA9ICJVbWFyIEh1YiINCmd1aVRlbXBsYXRlLlJlc2V0T25TcGF3biA9IGZhbHNlDQpndWlUZW1wbGF0ZS5BbHdheXNPblRvcCA9IHRydWUNCmd1aVRlbXBsYXRlLkVuYWJsZWQgPSBmYWxzZQ0KZ3VpVGVtcGxhdGUuTGlnaHRJbmZsdWVuY2UgPSAwDQpndWlUZW1wbGF0ZS5TaXplID0gVURpbTIubmV3KDIsIDAsIDIsIDApDQpndWlUZW1wbGF0ZS5TdHVkc09mZnNldCA9IFZlY3RvcjMubmV3KDAsIDIsIDApDQoNCmVzcFRlbXBsYXRlLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxDQplc3BUZW1wbGF0ZS5UZXh0ID0gIiINCmVzcFRlbXBsYXRlLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkNCmVzcFRlbXBsYXRlLkJvcmRlclNpemVQaXhlbCA9IDANCmVzcFRlbXBsYXRlLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtDQplc3BUZW1wbGF0ZS5UZXh0U2l6ZSA9IGVzcF9zZXR0aW5ncy50ZXh0c2l6ZQ0KZXNwVGVtcGxhdGUuVGV4dENvbG9yMyA9IGVzcF9zZXR0aW5ncy5jb2xvdXINCmVzcFRlbXBsYXRlLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwDQplc3BUZW1wbGF0ZS5UZXh0U3Ryb2tlQ29sb3IzID0gZXNwX3NldHRpbmdzLnN0cm9rZUNvbG91cg0KDQpsb2NhbCB3ZWFwb25OYW1lcyA9IHsNCiJIYWNrZXIgUmlmbGUiLCAiUGl4ZWwgRmxhbWV0aHJvd2VyIiwgIkJsYXN0ZXIiLCAiQ2hhbmNsYSIsICJHaW5nZXJicmVhZCBIYW5kZ3VuIiwgIktuaWZlIiwgIkdvYWxwb3N0IiwgIlN0aWNrIiwgIlNwcmF5IiwgDQoiVXppIiwgIlNsaW1lIEd1biIsICJUcmljayBvciBUcmVhdCIsICJGaXJld29yayBHdW4iLCAiRmxhcmUgR3VuIiwgIkFwZXggUmlmbGUiLCAiQmF0dGxlIEF4ZSIsIA0KIkJ1cnN0IFJpZmxlIiwgIlNjZXB0ZXIiLCAiV2hvb3BlZSBDdXNoaW9uIiwgIkRlc2VydCBFYWdsZSIsICJSZXZvbHZlciIsICJKaW5nbGUgR3JlbmFkZSIsICJTbW9rZSBHcmVuYWRlIiwgIkVtb2ppIENsb3VkIiwgDQoiVHJvd2VsIiwgIlBsYXN0aWMgU2hvdmVsIiwgIk1vbG90b3YiLCAiQ29mZmVlIiwgIkV4b2d1biIsICJXb25kZXJndW4iLCAiTm9yZGljIEF4ZSIsDQoiQnJpZWZjYXNlIiwgIkRpc2NvIEJhbGwiLCAiRmxhc2hiYW5nIiwgIkZlc3RpdmUgRmlzdHMiLCAiU2hvdGd1biIsICJBSy00NyIsICJBc3NhdWx0IFJpZmxlIiwgDQoiU25pcGVyIiwgIkdyZW5hZGUgTGF1bmNoZXIiLCAiU2hvcnR5IiwgIk1pbmlndW4iLCAiUGFpbnRiYWxsIEd1biIsICJCdWJibGUgUmF5IiwgIlN3YXNoYnVja2xlciIsICJMYXNlcmd1biAzMDAwIiwgDQoiRmxhbWV0aHJvd2VyIiwgIkJ1Y2tldCBvZiBDYW5keSIsICJOdWtlIExhdW5jaGVyIiwgIkRvbid0IFByZXNzIiwgIkVsaXhpciIsICJLYXRhbmEiLCANCiJDcm9zc2JvdyIsICJSZWluZGVlciBTbGluZ3Nob3QiLCAiRmlzdHMiLCAiQWR2YW5jZWQgU2F0Y2hlbCIsICJSUEtFWSIsICJTaW5ndWxhcml0eSIsICJFbmVyZ3kgUmlmbGUiLCANCiJBcGV4IFBpc3RvbHMiLCAiRHluYW1pdGUgR3VuIiwgIkJvbmVzaG90IiwgIkNhbWVyYSIsICJQaXhlbCBNaW5pZ3VuIiwgIldhdGVyIEJhbGxvb24iLCAiQW5jaG9yIiwgIkVuZXJneSBQaXN0b2xzIiwgDQoiQWNlcyIsICJSYXkgR3VuIiwgIlBpeGVsIENyb3NzYm93IiwgIkxhbWV0aHJvd2VyIiwgIlNwcmluZyIsICJUZW1wb3JhbCBSYXkiLCAiVXJhbml1bSBMYXVuY2hlciIsICJTa3VsbGJhbmciLA0KIkJhbGFuY2UiLCAiUGVwcGVybWludCBTaGVyaWZmIiwgIkNvb2tpZXMiLCAiQVVHIiwgIkFxdWEgQnVyc3QiLCAiTGlnaHRuaW5nIEJvbHQiLCANCiJUb3JjaCIsICJTcGFjZXNoaXAgTGF1bmNoZXIiLCAiSGFja2VyIFBpc3RvbHMiLCAiRnJlZXplIFJheSIsICJLZXlwZXIiLCAiUGl4ZWwgRmxhc2hiYW5nIiwgDQoiQUtFWS00NyIsICJQaXhlbCBLYXRhbmEiLCAiUGl4ZWwgSGFuZGd1biIsICJIYW5kIEd1biIsICJIeXBlciBHdW5ibGFkZSIsICJNYWNoZXRlIiwgIkRldmlsJ3MgVHJpZGVudCIsICJCb25lY2xhdyBSaWZsZSIsIA0KIlB1bXBraW4gTGF1bmNoZXIiLCAiU3BlY3RyYWwgQnVyc3QiLCAiU3BpZGVyIFJheSIsICJSUEciLCAiSGV4eGVkIENhbmRsZSIsICJMb3ZlbHkgU3ByYXkiLCANCiJTbGluZ3Nob3QiLCAiQnJhaW4gR3VuIiwgIlNrdWxsIExhdW5jaGVyIiwgIlB1bXBraW4gSGFuZGd1biIsICJCb2JhIEd1biIsICJFbGVjdHJvIFJpZmxlIiwgIkVsZidzIEd1bmJsYWRlIiwgDQoiRXllYmFsbCIsICJCb25lY2xhdyBSZXZvbHZlciIsICJCYXQgU2N5dGhlIiwgIlB1bXBraW4gQ2FydmVyIiwgIkJyb29tc3RpY2siLCAiU291bCBHcmVuYWRlIiwgIkphY2sgTydUaHJvd2VyIiwgDQoiV2FyIEhvcm4iLCAiVHJ1bXBldCIsICJUaGUgU2hyZWQiLCAiU3Vic3BhY2UgVHJpcG1pbmUiLCAiU2hlcmlmZiIsICJTY3l0aGUgb2YgRGVhdGgiLCAiU2N5dGhlIiwgIlNhdGNoZWwiLCAiU2FuZHdpY2giLCANCiJTYWJlciIsICJSaW90IFNoaWVsZCIsICJNZWRraXQiLCAiTGFwdG9wIiwgIktleXRoZSIsICJLYXJhbWJpdCIsICJHYXJkZW4gU2hvdmVsIiwgIkV4b2dvdXJkIiwgIkRvb3IiLCANCiJDb21wb3VuZCBCb3ciLCAiQ2hhaW5zYXciLCAiQnV6enNhdyIsICJCbG9ic2F3IiwgIlB1bXBraW4gQ2xhd3MiLCAiQm94aW5nIEdsb3ZlcyIsICJIYW5kc2F3cyIsICJCcmFzcyBLbnVja2xlcyIsIA0KIldyYXBwZWQgTWluaWd1biIsICJDcnlzdGFsIERhZ2dlcnMiLCAiRnJvc3RiaXRlIENyb3NzYm93IiwgIkdpbmdlcmJyZWFkIEFVRyIsICJDcnlvIFNjeXRoZSIsIA0KIlNoaW5pbmcgU3RhciIsICJTbm93Z2xvYmUiLCAiU25vd2JhbGwgR3VuIiwgIlNub3cgU2hvdmVsIiwgIkd1bmJsYWRlIiwgIjIwMjUgS2F0YW5hIiwgDQoiV3JhcHBlZCBGcmVlemUgUmF5IiwgIjIwMjUgRW5lcmd5IFBpc3RvbHMiLCAiU25vd2Jsb3dlciIsICJTbGVkIiwgIjIwMjUgRW5lcmd5IFJpZmxlIiwgIkhhbmRndW4iLCANCiJGZXN0aXZlIEJ1enpzYXciLCAiTWlsayAmIENvb2tpZXMiLCAiR3JlbmFkZSIsICJEZXYtaW4tdGhlLUJveCIsICJNYW1tb3RoIEhvcm4iLCAiUGluZSBTcHJheSIsICJGaXJld29yayBMYXVuY2hlciIsDQoiUmF2ZW4gQm93IiwgIkJhdCBCb3ciLCAiQm93IiwgIlN1c3BpY2lvdXMgR2lmdCIsICJXcmFwcGVkIEZsYXJlIEd1biIsIA0KIkNhbmR5IENhbmUiLCAiRnJvc3RiaXRlIEJvdyIsICJEYWdnZXJzIiwgIlNub3diYWxsIExhdW5jaGVyIiwgIlBpeGVsIEJ1cnN0IiwgIlBpbmUgQnVyc3QiLCAiSG90IENvYWxzIg0KfQ0KDQpsb2NhbCBlc3BDb21wb25lbnRzID0geyBOYW1lID0gdHJ1ZSwgV2VhcG9uID0gdHJ1ZSwgRGlzdGFuY2UgPSB0cnVlIH0gLS0gRGVmYXVsdHMNCg0KbG9jYWwgVEVzcE11bHRpRHJvcGRvd24gPSBUYWJzLk1haW46QWRkRHJvcGRvd24oIlRFc3BNdWx0aURyb3Bkb3duIiwgeyANClRpdGxlID0gIkRyb3Bkb3duIiwNCkRlc2NyaXB0aW9uID0gIllvdSBjYW4gc2VsZWN0IG11bHRpcGxlIHZhbHVlcy4iLA0KVmFsdWVzID0geyJOYW1lIiwgIldlYXBvbiIsICJEaXN0YW5jZSJ9LA0KTXVsdGkgPSB0cnVlLA0KRGVmYXVsdCA9IHsiTmFtZSIsICJXZWFwb24ifSwNCn0pDQoNClRFc3BNdWx0aURyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCmVzcENvbXBvbmVudHMgPSB7IE5hbWUgPSBmYWxzZSwgV2VhcG9uID0gZmFsc2UsIERpc3RhbmNlID0gZmFsc2UgfSAtLSBSZXNldA0KZm9yIGNvbXBvbmVudCwgc3RhdGUgaW4gcGFpcnMoVmFsdWUpIGRvDQogICAgaWYgc3RhdGUgdGhlbg0KICAgICAgICBlc3BDb21wb25lbnRzW2NvbXBvbmVudF0gPSB0cnVlDQogICAgZW5kDQplbmQNCmVuZCkNCg0KbG9jYWwgU2xpZGVyID0gVGFicy5NYWluOkFkZFNsaWRlcigiRXNwVHh0U2l6ZVNsaWRlciIsIHsgDQpUaXRsZSA9ICJGb250IFNpemUiLA0KRGVzY3JpcHRpb24gPSAiQWRqdXN0IHRoZSBmb250IHNpemUgb2YgRVNQIHRleHQuIiwNCkRlZmF1bHQgPSAxMiwgDQpNaW4gPSAwLA0KTWF4ID0gNTAsIA0KUm91bmRpbmcgPSAxLA0KQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkNCiAgICBlc3Bfc2V0dGluZ3MudGV4dHNpemUgPSBWYWx1ZQ0KZW5kDQp9KQ0KDQpTbGlkZXI6T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KZXNwX3NldHRpbmdzLnRleHRzaXplID0gVmFsdWUNCmVuZCkNCg0KbG9jYWwgQ29sb3JwaWNrZXIgPSBUYWJzLk1haW46QWRkQ29sb3JwaWNrZXIoIkVzcFR4dENvbG9ycGlja2VyIiwgeyANClRpdGxlID0gIlRleHQgQ29sb3IiLA0KRGVmYXVsdCA9IGVzcF9zZXR0aW5ncy5jb2xvdXINCn0pDQoNCkNvbG9ycGlja2VyOk9uQ2hhbmdlZChmdW5jdGlvbigpDQplc3Bfc2V0dGluZ3MuY29sb3VyID0gQ29sb3JwaWNrZXIuVmFsdWUNCmVuZCkNCg0KbG9jYWwgZnVuY3Rpb24gZXh0cmFjdFdlYXBvbk5hbWUobW9kZWxOYW1lKQ0KZm9yIF8sIHdlYXBvbiBpbiBpcGFpcnMod2VhcG9uTmFtZXMpIGRvDQogICAgaWYgc3RyaW5nLmZpbmQobW9kZWxOYW1lLCB3ZWFwb24pIHRoZW4NCiAgICAgICAgcmV0dXJuIHdlYXBvbg0KICAgIGVuZA0KZW5kDQpyZXR1cm4gIkhhbmQiDQplbmQNCg0KbG9jYWwgZnVuY3Rpb24gZ2V0RGlzdGFuY2UocGxheWVyKQ0KbG9jYWwgbG9jYWxQbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KaWYgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4NCiAgICBsb2NhbCBkaXN0YW5jZSA9IChsb2NhbFBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbiAtIHBsYXllci5DaGFyYWN0ZXIuSGVhZC5Qb3NpdGlvbikubWFnbml0dWRlDQogICAgcmV0dXJuIG1hdGguZmxvb3IoZGlzdGFuY2UpDQplbmQNCnJldHVybiBtYXRoLmh1Z2UNCmVuZA0KDQpsb2NhbCBmdW5jdGlvbiB1cGRhdGVFU1AodikNCmlmIHYgPT0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIgdGhlbiByZXR1cm4gZW5kDQoNCmxvY2FsIGRpc3RhbmNlID0gZ2V0RGlzdGFuY2UodikNCmlmIGRpc3RhbmNlID4gZXNwX3NldHRpbmdzLm1heERpc3RhbmNlIHRoZW4NCiAgICBpZiB2LkNoYXJhY3RlciBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgICAgIGxvY2FsIGV4aXN0aW5nR3VpID0gdi5DaGFyYWN0ZXIuSGVhZDpGaW5kRmlyc3RDaGlsZCgiOGJpdCIpDQogICAgICAgIGlmIGV4aXN0aW5nR3VpIHRoZW4NCiAgICAgICAgICAgIGV4aXN0aW5nR3VpOkRlc3Ryb3koKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCiAgICByZXR1cm4NCmVuZA0KDQpsb2NhbCBtb2RlbE5hbWVQYXR0ZXJuID0gdi5OYW1lDQpsb2NhbCBlc3BUZXh0ID0gIkhhbmQiDQoNCmZvciBfLCBtb2RlbCBpbiBwYWlycyhnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpLlZpZXdNb2RlbHM6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICBpZiBzdHJpbmcuZmluZChtb2RlbC5OYW1lLCBtb2RlbE5hbWVQYXR0ZXJuKSB0aGVuDQogICAgICAgIGVzcFRleHQgPSBleHRyYWN0V2VhcG9uTmFtZShtb2RlbC5OYW1lKQ0KICAgICAgICBicmVhaw0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIGNvbXBvbmVudHMgPSB7fQ0KaWYgZXNwQ29tcG9uZW50cy5OYW1lIHRoZW4gdGFibGUuaW5zZXJ0KGNvbXBvbmVudHMsIHYuTmFtZSkgZW5kDQppZiBlc3BDb21wb25lbnRzLldlYXBvbiB0aGVuIHRhYmxlLmluc2VydChjb21wb25lbnRzLCBlc3BUZXh0KSBlbmQNCmlmIGVzcENvbXBvbmVudHMuRGlzdGFuY2UgdGhlbiB0YWJsZS5pbnNlcnQoY29tcG9uZW50cywgZGlzdGFuY2UgLi4gIiBzdHVkcyIpIGVuZA0KDQpsb2NhbCBkaXNwbGF5VGV4dCA9IHRhYmxlLmNvbmNhdChjb21wb25lbnRzLCAiIOKXjyAiKQ0KDQppZiB2LkNoYXJhY3RlciBhbmQgdi5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSB0aGVuDQogICAgbG9jYWwgcGxheWVyR3VpID0gdi5DaGFyYWN0ZXIuSGVhZDpGaW5kRmlyc3RDaGlsZCgiOGJpdCIpDQogICAgaWYgcGxheWVyR3VpIHRoZW4NCiAgICAgICAgcGxheWVyR3VpLlRleHRMYWJlbC5UZXh0ID0gZGlzcGxheVRleHQNCiAgICAgICAgcGxheWVyR3VpLlRleHRMYWJlbC5UZXh0U2l6ZSA9IGVzcF9zZXR0aW5ncy50ZXh0c2l6ZSAtLSBVcGRhdGUgZm9udCBzaXplDQogICAgICAgIHBsYXllckd1aS5UZXh0TGFiZWwuVGV4dENvbG9yMyA9IGVzcF9zZXR0aW5ncy5jb2xvdXIgLS0gVXBkYXRlIHRleHQgY29sb3INCiAgICBlbHNlDQogICAgICAgIGxvY2FsIHBsYXllckd1aUNsb25lID0gZ3VpVGVtcGxhdGU6Q2xvbmUoKQ0KICAgICAgICBwbGF5ZXJHdWlDbG9uZS5UZXh0TGFiZWwuVGV4dCA9IGRpc3BsYXlUZXh0DQogICAgICAgIHBsYXllckd1aUNsb25lLlRleHRMYWJlbC5UZXh0U2l6ZSA9IGVzcF9zZXR0aW5ncy50ZXh0c2l6ZSAtLSBTZXQgZm9udCBzaXplDQogICAgICAgIHBsYXllckd1aUNsb25lLlRleHRMYWJlbC5UZXh0Q29sb3IzID0gZXNwX3NldHRpbmdzLmNvbG91ciAtLSBTZXQgdGV4dCBjb2xvcg0KICAgICAgICBwbGF5ZXJHdWlDbG9uZS5QYXJlbnQgPSB2LkNoYXJhY3Rlci5IZWFkDQogICAgZW5kDQplbmQNCmVuZA0KDQpnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoZnVuY3Rpb24oKQ0KZm9yIF8sIHYgaW4gcGFpcnMoZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik6R2V0UGxheWVycygpKSBkbw0KICAgIGlmIHYuQ2hhcmFjdGVyIGFuZCB2LkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIHRoZW4NCiAgICAgICAgdXBkYXRlRVNQKHYpDQogICAgZW5kDQplbmQNCmVuZCkNCg0KZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpDQpwbGF5ZXIuQ2hhcmFjdGVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGFyYWN0ZXIpDQogICAgdXBkYXRlRVNQKHBsYXllcikNCmVuZCkNCmVuZCkNCg0KZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpDQppZiBwbGF5ZXIuQ2hhcmFjdGVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikgdGhlbg0KICAgIGxvY2FsIGVzcEd1aSA9IHBsYXllci5DaGFyYWN0ZXIuSGVhZDpGaW5kRmlyc3RDaGlsZCgiOGJpdCIpDQogICAgaWYgZXNwR3VpIHRoZW4NCiAgICAgICAgZXNwR3VpOkRlc3Ryb3koKQ0KICAgIGVuZA0KZW5kDQplbmQpDQoNCg0KDQoNCg0KDQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikNCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcg0KbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpDQoNCi0tIERlZmluZSBTZXR0aW5ncyBvYmplY3Qgd2l0aCBkZWZhdWx0IHZhbHVlcw0KbG9jYWwgU2V0dGluZ3MgPSB7DQogICAgRVNQX0VuYWJsZWQgPSB0cnVlLA0KICAgIEVTUF9UZWFtQ2hlY2sgPSBmYWxzZSwNCiAgICBDaGFtcyA9IGZhbHNlLCAgLS0gSW5pdGlhbGx5IHNldCB0byBmYWxzZQ0KICAgIENoYW1zX0NvbG9yID0gQ29sb3IzLmZyb21SR0IoMywgNDQsIDI1MiksICAtLSBGaXhlZCBjb2xvciBmb3IgQ2hhbXMNCiAgICBDaGFtc19UcmFuc3BhcmVuY3kgPSAwLjYsDQp9DQoNCi0tIEFkZCBUb2dnbGUgZm9yIENoYW1zDQpsb2NhbCBUb2dnbGUgPSBUYWJzLk1haW46QWRkVG9nZ2xlKCJNeVRvZ2dsZSIsIHtUaXRsZSA9ICJDaGFtc1RvZ2dsZSIsIERlZmF1bHQgPSBmYWxzZSB9KQ0KVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgU2V0dGluZ3MuQ2hhbXMgPSBUb2dnbGUuVmFsdWUNCiAgICBwcmludCgiQ2hhbXMgVG9nZ2xlIGNoYW5nZWQ6IiwgU2V0dGluZ3MuQ2hhbXMpDQplbmQpDQoNCi0tIEZ1bmN0aW9uIHRvIG1hbmFnZSBDaGFtcw0KbG9jYWwgZnVuY3Rpb24gVXBkYXRlQ2hhbXMocGxheWVyKQ0KICAgIGxvY2FsIGNoYXJhY3RlciA9IHBsYXllci5DaGFyYWN0ZXINCiAgICBpZiBub3QgY2hhcmFjdGVyIHRoZW4gcmV0dXJuIGVuZA0KDQogICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKGNoYXJhY3RlcjpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICBpZiBwYXJ0OklzQSgiQmFzZVBhcnQiKSBhbmQgcGFydC5UcmFuc3BhcmVuY3kgfj0gMSB0aGVuDQogICAgICAgICAgICBsb2NhbCBleGlzdGluZ0NoYW1zID0gcGFydDpGaW5kRmlyc3RDaGlsZCgiQ2hhbXMiKQ0KDQogICAgICAgICAgICBpZiBTZXR0aW5ncy5DaGFtcyB0aGVuDQogICAgICAgICAgICAgICAgLS0gQ3JlYXRlIENoYW1zIGlmIGl0IGRvZXNuJ3QgZXhpc3QNCiAgICAgICAgICAgICAgICBpZiBub3QgZXhpc3RpbmdDaGFtcyB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIGNoYW1zQm94ID0gSW5zdGFuY2UubmV3KCJCb3hIYW5kbGVBZG9ybm1lbnQiKQ0KICAgICAgICAgICAgICAgICAgICBjaGFtc0JveC5OYW1lID0gIkNoYW1zIg0KICAgICAgICAgICAgICAgICAgICBjaGFtc0JveC5BbHdheXNPblRvcCA9IHRydWUNCiAgICAgICAgICAgICAgICAgICAgY2hhbXNCb3guWkluZGV4ID0gNA0KICAgICAgICAgICAgICAgICAgICBjaGFtc0JveC5BZG9ybmVlID0gcGFydA0KICAgICAgICAgICAgICAgICAgICBjaGFtc0JveC5Db2xvcjMgPSBTZXR0aW5ncy5DaGFtc19Db2xvcg0KICAgICAgICAgICAgICAgICAgICBjaGFtc0JveC5UcmFuc3BhcmVuY3kgPSBTZXR0aW5ncy5DaGFtc19UcmFuc3BhcmVuY3kNCiAgICAgICAgICAgICAgICAgICAgY2hhbXNCb3guU2l6ZSA9IHBhcnQuU2l6ZSArIFZlY3RvcjMubmV3KDAuMDIsIDAuMDIsIDAuMDIpDQogICAgICAgICAgICAgICAgICAgIGNoYW1zQm94LlBhcmVudCA9IHBhcnQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAtLSBSZW1vdmUgQ2hhbXMgaWYgdGhleSBleGlzdA0KICAgICAgICAgICAgICAgIGlmIGV4aXN0aW5nQ2hhbXMgdGhlbg0KICAgICAgICAgICAgICAgICAgICBleGlzdGluZ0NoYW1zOkRlc3Ryb3koKQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQoNCi0tIE9wdGltaXplIEhlYXJ0YmVhdCBwcm9jZXNzaW5nDQpSdW5TZXJ2aWNlLkhlYXJ0YmVhdDpDb25uZWN0KGZ1bmN0aW9uKCkNCiAgICBpZiBub3QgU2V0dGluZ3MuRVNQX0VuYWJsZWQgdGhlbiByZXR1cm4gZW5kDQoNCiAgICBmb3IgXywgcGxheWVyIGluIGlwYWlycyhQbGF5ZXJzOkdldFBsYXllcnMoKSkgZG8NCiAgICAgICAgaWYgcGxheWVyID09IExvY2FsUGxheWVyIG9yIG5vdCBwbGF5ZXIuQ2hhcmFjdGVyIG9yIG5vdCBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgdGhlbg0KICAgICAgICAgICAgY29udGludWUNCiAgICAgICAgZW5kDQoNCiAgICAgICAgbG9jYWwgaHVtYW5vaWQgPSBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZCIpDQogICAgICAgIGlmIGh1bWFub2lkIGFuZCBodW1hbm9pZC5IZWFsdGggPiAwIHRoZW4NCiAgICAgICAgICAgIGlmIG5vdCAoU2V0dGluZ3MuRVNQX1RlYW1DaGVjayBhbmQgcGxheWVyLlRlYW0gPT0gTG9jYWxQbGF5ZXIuVGVhbSkgdGhlbg0KICAgICAgICAgICAgICAgIFVwZGF0ZUNoYW1zKHBsYXllcikNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBEZXN0cm95Q2hhbXMocGxheWVyLkNoYXJhY3RlcikNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbHNlDQogICAgICAgICAgICBEZXN0cm95Q2hhbXMocGxheWVyLkNoYXJhY3RlcikNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNCi0tIERlc3Ryb3kgYWxsIENoYW1zIGluIGEgY2hhcmFjdGVyDQpsb2NhbCBmdW5jdGlvbiBEZXN0cm95Q2hhbXMoY2hhcmFjdGVyKQ0KICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhjaGFyYWN0ZXI6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgcGFydDpJc0EoIkJhc2VQYXJ0IikgdGhlbg0KICAgICAgICAgICAgbG9jYWwgZXhpc3RpbmdDaGFtcyA9IHBhcnQ6RmluZEZpcnN0Q2hpbGQoIkNoYW1zIikNCiAgICAgICAgICAgIGlmIGV4aXN0aW5nQ2hhbXMgdGhlbg0KICAgICAgICAgICAgICAgIGV4aXN0aW5nQ2hhbXM6RGVzdHJveSgpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQNCg0KDQoNCg0KDQoNCg0KDQoNCg0KDQotLSBzZXR0aW5ncw0KbG9jYWwgc2V0dGluZ3MgPSB7DQpkZWZhdWx0Y29sb3IgPSBDb2xvcjMuZnJvbVJHQigyNTUsIDAsIDApLA0KdGVhbWNoZWNrID0gZmFsc2UsDQp0ZWFtY29sb3IgPSB0cnVlLA0KbWF4RGlzdGFuY2UgPSAzMDAgIC0tIE1heGltdW0gZGlzdGFuY2UgZm9yIHJlbmRlcmluZyBFU1ANCn07DQoNCi0tIHNlcnZpY2VzDQpsb2NhbCBydW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIik7DQpsb2NhbCBwbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIik7DQoNCi0tIHZhcmlhYmxlcw0KbG9jYWwgbG9jYWxQbGF5ZXIgPSBwbGF5ZXJzLkxvY2FsUGxheWVyOw0KbG9jYWwgY2FtZXJhID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmE7DQoNCi0tIGZ1bmN0aW9ucw0KbG9jYWwgbmV3VmVjdG9yMiwgbmV3Q29sb3IzLCBuZXdEcmF3aW5nID0gVmVjdG9yMi5uZXcsIENvbG9yMy5uZXcsIERyYXdpbmcubmV3Ow0KbG9jYWwgdGFuLCByYWQgPSBtYXRoLnRhbiwgbWF0aC5yYWQ7DQpsb2NhbCByb3VuZCA9IGZ1bmN0aW9uKC4uLikgbG9jYWwgYSA9IHt9OyBmb3IgaSwgdiBpbiBuZXh0LCB0YWJsZS5wYWNrKC4uLikgZG8gYVtpXSA9IG1hdGgucm91bmQodik7IGVuZCByZXR1cm4gdW5wYWNrKGEpOyBlbmQ7DQpsb2NhbCB3dHZwID0gZnVuY3Rpb24oLi4uKSBsb2NhbCBhLCBiID0gY2FtZXJhLldvcmxkVG9WaWV3cG9ydFBvaW50KGNhbWVyYSwgLi4uKSByZXR1cm4gbmV3VmVjdG9yMihhLlgsIGEuWSksIGIsIGEuWiBlbmQ7DQoNCmxvY2FsIGVzcENhY2hlID0ge307DQpsb2NhbCBib3hWaXNpYmxlID0gdHJ1ZSAtLSBUb2dnbGUgZm9yIGJveCB2aXNpYmlsaXR5DQpsb2NhbCBoZWFsdGhCYXJWaXNpYmxlID0gdHJ1ZSAtLSBUb2dnbGUgZm9yIGhlYWx0aCBiYXIgdmlzaWJpbGl0eQ0KDQotLSBUb2dnbGVzIGZvciBib3ggYW5kIGhlYWx0aCBiYXIgdmlzaWJpbGl0eQ0KbG9jYWwgQm94VG9nZ2xlID0gVGFicy5NYWluOkFkZFRvZ2dsZSgiQm94VG9nZ2xlIiwge1RpdGxlID0gIlRvZ2dsZSBCb3giLCBEZWZhdWx0ID0gZmFsc2V9KQ0KbG9jYWwgSGVhbHRoQmFyVG9nZ2xlID0gVGFicy5NYWluOkFkZFRvZ2dsZSgiSGVhbHRoQmFyVG9nZ2xlIiwge1RpdGxlID0gIlRvZ2dsZSBIZWFsdGggQmFyIiwgRGVmYXVsdCA9IGZhbHNlfSkNCg0KQm94VG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogYm94VmlzaWJsZSA9IEJveFRvZ2dsZS5WYWx1ZSAtLSBVcGRhdGUgYm94IHZpc2liaWxpdHkNCmVuZCkNCg0KSGVhbHRoQmFyVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogaGVhbHRoQmFyVmlzaWJsZSA9IEhlYWx0aEJhclRvZ2dsZS5WYWx1ZSAtLSBVcGRhdGUgaGVhbHRoIGJhciB2aXNpYmlsaXR5DQplbmQpDQoNCi0tIEZ1bmN0aW9uIHRvIGNyZWF0ZSBFU1AgZm9yIGEgcGxheWVyDQpsb2NhbCBmdW5jdGlvbiBjcmVhdGVFc3AocGxheWVyKQ0KbG9jYWwgZHJhd2luZ3MgPSB7fTsNCg0KLS0gQm94DQpkcmF3aW5ncy5ib3ggPSBuZXdEcmF3aW5nKCJTcXVhcmUiKTsNCmRyYXdpbmdzLmJveC5UaGlja25lc3MgPSAxOw0KZHJhd2luZ3MuYm94LkZpbGxlZCA9IGZhbHNlOw0KZHJhd2luZ3MuYm94LkNvbG9yID0gc2V0dGluZ3MuZGVmYXVsdGNvbG9yOw0KZHJhd2luZ3MuYm94LlZpc2libGUgPSBmYWxzZTsNCmRyYXdpbmdzLmJveC5aSW5kZXggPSAyOw0KDQotLSBIZWFsdGggQmFyIChUaGlubmVyIHZlcnNpb24pDQpkcmF3aW5ncy5oZWFsdGhCYXIgPSBuZXdEcmF3aW5nKCJTcXVhcmUiKTsNCmRyYXdpbmdzLmhlYWx0aEJhci5GaWxsZWQgPSB0cnVlOw0KZHJhd2luZ3MuaGVhbHRoQmFyLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMjU1LCAwKTsgLS0gRGVmYXVsdDogR3JlZW4NCmRyYXdpbmdzLmhlYWx0aEJhci5WaXNpYmxlID0gZmFsc2U7DQpkcmF3aW5ncy5oZWFsdGhCYXIuWkluZGV4ID0gMzsNCmRyYXdpbmdzLmhlYWx0aEJhci5TaXplID0gbmV3VmVjdG9yMigyLCAwKSAtLSBIZWFsdGggYmFyIGlzIG5vdyB0aGlubmVyDQpkcmF3aW5ncy5oZWFsdGhCYXJCYWNrZ3JvdW5kID0gbmV3RHJhd2luZygiU3F1YXJlIik7DQpkcmF3aW5ncy5oZWFsdGhCYXJCYWNrZ3JvdW5kLkZpbGxlZCA9IHRydWU7DQpkcmF3aW5ncy5oZWFsdGhCYXJCYWNrZ3JvdW5kLkNvbG9yID0gQ29sb3IzLmZyb21SR0IoNTAsIDUwLCA1MCk7IC0tIEJhY2tncm91bmQ6IERhcmsgZ3JheQ0KZHJhd2luZ3MuaGVhbHRoQmFyQmFja2dyb3VuZC5WaXNpYmxlID0gZmFsc2U7DQpkcmF3aW5ncy5oZWFsdGhCYXJCYWNrZ3JvdW5kLlpJbmRleCA9IDI7DQpkcmF3aW5ncy5oZWFsdGhCYXJCYWNrZ3JvdW5kLlNpemUgPSBuZXdWZWN0b3IyKDIsIDApIC0tIEJhY2tncm91bmQgYWxzbyB0aGlubmVyDQoNCmVzcENhY2hlW3BsYXllcl0gPSBkcmF3aW5nczsNCmVuZA0KDQotLSBGdW5jdGlvbiB0byByZW1vdmUgRVNQIGZvciBhIHBsYXllcg0KbG9jYWwgZnVuY3Rpb24gcmVtb3ZlRXNwKHBsYXllcikNCmlmIHJhd2dldChlc3BDYWNoZSwgcGxheWVyKSB0aGVuDQogICAgZm9yIF8sIGRyYXdpbmcgaW4gbmV4dCwgZXNwQ2FjaGVbcGxheWVyXSBkbw0KICAgICAgICBkcmF3aW5nOlJlbW92ZSgpOw0KICAgIGVuZA0KICAgIGVzcENhY2hlW3BsYXllcl0gPSBuaWw7DQplbmQNCmVuZA0KDQotLSBGdW5jdGlvbiB0byB1cGRhdGUgRVNQIGZvciBhIHBsYXllcg0KbG9jYWwgZnVuY3Rpb24gdXBkYXRlRXNwKHBsYXllciwgZXNwKQ0KbG9jYWwgY2hhcmFjdGVyID0gcGxheWVyIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyOw0KbG9jYWwgaHVtYW5vaWQgPSBjaGFyYWN0ZXIgYW5kIGNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIkh1bWFub2lkIik7DQppZiBjaGFyYWN0ZXIgYW5kIGh1bWFub2lkIHRoZW4NCiAgICBsb2NhbCBjZnJhbWUgPSBjaGFyYWN0ZXI6R2V0TW9kZWxDRnJhbWUoKTsNCiAgICBsb2NhbCBwb3NpdGlvbiwgdmlzaWJsZSwgZGVwdGggPSB3dHZwKGNmcmFtZS5Qb3NpdGlvbik7DQogICAgDQogICAgLS0gQ2hlY2sgaWYgdGhlIHBsYXllciBpcyB3aXRoaW4gdGhlIG1heCBkaXN0YW5jZSAoMzAwIHN0dWRzKQ0KICAgIGxvY2FsIGRpc3RhbmNlID0gKGxvY2FsUGxheWVyLkNoYXJhY3Rlci5IdW1hbm9pZFJvb3RQYXJ0LlBvc2l0aW9uIC0gY2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pLk1hZ25pdHVkZTsNCiAgICBpZiBkaXN0YW5jZSA+IHNldHRpbmdzLm1heERpc3RhbmNlIHRoZW4NCiAgICAgICAgZXNwLmJveC5WaXNpYmxlID0gZmFsc2U7DQogICAgICAgIGVzcC5oZWFsdGhCYXIuVmlzaWJsZSA9IGZhbHNlOw0KICAgICAgICBlc3AuaGVhbHRoQmFyQmFja2dyb3VuZC5WaXNpYmxlID0gZmFsc2U7DQogICAgICAgIHJldHVybjsNCiAgICBlbmQNCiAgICANCiAgICAtLSBVcGRhdGUgdmlzaWJpbGl0eSBiYXNlZCBvbiB0b2dnbGVzDQogICAgZXNwLmJveC5WaXNpYmxlID0gdmlzaWJsZSBhbmQgYm94VmlzaWJsZTsNCiAgICBlc3AuaGVhbHRoQmFyLlZpc2libGUgPSB2aXNpYmxlIGFuZCBoZWFsdGhCYXJWaXNpYmxlOw0KICAgIGVzcC5oZWFsdGhCYXJCYWNrZ3JvdW5kLlZpc2libGUgPSB2aXNpYmxlIGFuZCBoZWFsdGhCYXJWaXNpYmxlOw0KDQogICAgaWYgY2ZyYW1lIGFuZCB2aXNpYmxlIHRoZW4NCiAgICAgICAgbG9jYWwgc2NhbGVGYWN0b3IgPSAxIC8gKGRlcHRoICogdGFuKHJhZChjYW1lcmEuRmllbGRPZlZpZXcgLyAyKSkgKiAyKSAqIDEwMDA7DQogICAgICAgIGxvY2FsIHdpZHRoLCBoZWlnaHQgPSByb3VuZCg0ICogc2NhbGVGYWN0b3IsIDUgKiBzY2FsZUZhY3Rvcik7DQogICAgICAgIGxvY2FsIHgsIHkgPSByb3VuZChwb3NpdGlvbi5YLCBwb3NpdGlvbi5ZKTsNCg0KICAgICAgICBlc3AuYm94LlNpemUgPSBuZXdWZWN0b3IyKHdpZHRoLCBoZWlnaHQpOw0KICAgICAgICBlc3AuYm94LlBvc2l0aW9uID0gbmV3VmVjdG9yMihyb3VuZCh4IC0gd2lkdGggLyAyLCB5IC0gaGVpZ2h0IC8gMikpOw0KICAgICAgICBlc3AuYm94LkNvbG9yID0gc2V0dGluZ3MudGVhbWNvbG9yIGFuZCBwbGF5ZXIuVGVhbUNvbG9yLkNvbG9yIG9yIHNldHRpbmdzLmRlZmF1bHRjb2xvcjsNCg0KICAgICAgICAtLSBVcGRhdGUgaGVhbHRoIGJhcg0KICAgICAgICBsb2NhbCBoZWFsdGhQZXJjZW50ID0gaHVtYW5vaWQuSGVhbHRoIC8gaHVtYW5vaWQuTWF4SGVhbHRoOw0KICAgICAgICBlc3AuaGVhbHRoQmFyQmFja2dyb3VuZC5TaXplID0gbmV3VmVjdG9yMigyLCBoZWlnaHQpOyAtLSBBZGp1c3RlZCB3aWR0aCBmb3IgdGhpbm5lciBoZWFsdGggYmFyDQogICAgICAgIGVzcC5oZWFsdGhCYXJCYWNrZ3JvdW5kLlBvc2l0aW9uID0gbmV3VmVjdG9yMih4IC0gd2lkdGggLyAyIC0gNiwgeSAtIGhlaWdodCAvIDIpOw0KDQogICAgICAgIGVzcC5oZWFsdGhCYXIuU2l6ZSA9IG5ld1ZlY3RvcjIoMiwgaGVpZ2h0ICogaGVhbHRoUGVyY2VudCk7IC0tIFRoaW5uZXIgaGVhbHRoIGJhcg0KICAgICAgICBlc3AuaGVhbHRoQmFyLlBvc2l0aW9uID0gbmV3VmVjdG9yMih4IC0gd2lkdGggLyAyIC0gNiwgeSAtIGhlaWdodCAvIDIgKyBoZWlnaHQgKiAoMSAtIGhlYWx0aFBlcmNlbnQpKTsNCiAgICAgICAgZXNwLmhlYWx0aEJhci5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDI1NSAqICgxIC0gaGVhbHRoUGVyY2VudCksIDI1NSAqIGhlYWx0aFBlcmNlbnQsIDApOyAtLSBHcmFkaWVudDogR3JlZW4gdG8gUmVkDQogICAgZW5kDQplbHNlDQogICAgZXNwLmJveC5WaXNpYmxlID0gZmFsc2U7DQogICAgZXNwLmhlYWx0aEJhci5WaXNpYmxlID0gZmFsc2U7DQogICAgZXNwLmhlYWx0aEJhckJhY2tncm91bmQuVmlzaWJsZSA9IGZhbHNlOw0KZW5kDQplbmQNCg0KLS0gbWFpbg0KZm9yIF8sIHBsYXllciBpbiBuZXh0LCBwbGF5ZXJzOkdldFBsYXllcnMoKSBkbw0KaWYgcGxheWVyIH49IGxvY2FsUGxheWVyIHRoZW4NCiAgICBjcmVhdGVFc3AocGxheWVyKTsNCmVuZA0KZW5kDQoNCnBsYXllcnMuUGxheWVyQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpDQpjcmVhdGVFc3AocGxheWVyKTsNCmVuZCk7DQoNCnBsYXllcnMuUGxheWVyUmVtb3Zpbmc6Q29ubmVjdChmdW5jdGlvbihwbGF5ZXIpDQpyZW1vdmVFc3AocGxheWVyKTsNCmVuZCkNCg0KcnVuU2VydmljZTpCaW5kVG9SZW5kZXJTdGVwKCJlc3AiLCBFbnVtLlJlbmRlclByaW9yaXR5LkNhbWVyYS5WYWx1ZSwgZnVuY3Rpb24oKQ0KZm9yIHBsYXllciwgZHJhd2luZ3MgaW4gbmV4dCwgZXNwQ2FjaGUgZG8NCiAgICBpZiBzZXR0aW5ncy50ZWFtY2hlY2sgYW5kIHBsYXllci5UZWFtID09IGxvY2FsUGxheWVyLlRlYW0gdGhlbg0KICAgICAgICBjb250aW51ZTsNCiAgICBlbmQNCg0KICAgIGlmIGRyYXdpbmdzIGFuZCBwbGF5ZXIgfj0gbG9jYWxQbGF5ZXIgdGhlbg0KICAgICAgICB1cGRhdGVFc3AocGxheWVyLCBkcmF3aW5ncyk7DQogICAgZW5kDQplbmQNCmVuZCkNCg0KLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQotLS0tLUFpbVRhYi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCmxvY2FsIFdvcmtzcGFjZSA9IGdhbWU6R2V0U2VydmljZSgiV29ya3NwYWNlIikNCmxvY2FsIFVzZXJJbnB1dFNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlVzZXJJbnB1dFNlcnZpY2UiKQ0KbG9jYWwgTGlnaHRpbmcgPSBnYW1lOkdldFNlcnZpY2UoIkxpZ2h0aW5nIikNCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQ0KbG9jYWwgUnVuU2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiUnVuU2VydmljZSIpDQoNCi0tIExvY2FsIFBsYXllcg0KbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyDQoNCi0tIEFpbWJvdENhbSBDb25maWcNCkFpbWJvdENhbSA9IHsNCiAgICBFbmFibGVkID0gZmFsc2UsICAtLSBJbml0aWFsbHkgc2V0IHRvIGZhbHNlIChkaXNhYmxlZCkNCiAgICBIaXRDaGFuY2UgPSAxMDAsDQogICAgTm90V29ya0lmRmxhc2hlZCA9IHRydWUNCn0NCg0KLS0gR2V0IHRoZSBjbG9zZXN0IHBsYXllciB0byB0aGUgbW91c2UgKG5vIEZPViByZXN0cmljdGlvbikNCmZ1bmN0aW9uIEdldENsb3Nlc3RQbGF5ZXJUb01vdXNlKCkNCiAgICBsb2NhbCBtb3VzZUxvY2F0aW9uID0gVXNlcklucHV0U2VydmljZTpHZXRNb3VzZUxvY2F0aW9uKCkNCiAgICBsb2NhbCBjbG9zZXN0UGxheWVyID0gbmlsDQogICAgbG9jYWwgY2xvc2VzdERpc3RhbmNlID0gbWF0aC5odWdlDQoNCiAgICBmb3IgXywgcGxheWVyIGluIHBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbw0KICAgICAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkh1bWFub2lkUm9vdFBhcnQiKSB0aGVuDQogICAgICAgICAgICBsb2NhbCBzY3JlZW5Qb3NpdGlvbiwgb25TY3JlZW4gPSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludChwbGF5ZXIuQ2hhcmFjdGVyLkh1bWFub2lkUm9vdFBhcnQuUG9zaXRpb24pDQogICAgICAgICAgICBpZiBvblNjcmVlbiB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2UgPSAoVmVjdG9yMi5uZXcoc2NyZWVuUG9zaXRpb24uWCwgc2NyZWVuUG9zaXRpb24uWSkgLSBtb3VzZUxvY2F0aW9uKS5NYWduaXR1ZGUNCiAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZSA8IGNsb3Nlc3REaXN0YW5jZSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGNsb3Nlc3RQbGF5ZXIgPSBwbGF5ZXINCiAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3RhbmNlID0gZGlzdGFuY2UNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBjbG9zZXN0UGxheWVyDQplbmQNCg0KLS0gR2V0IEFpbWJvdCBUYXJnZXQgUGFydA0KZnVuY3Rpb24gR2V0QWltYm90UGFydChwbGF5ZXIpDQogICAgcmV0dXJuIHBsYXllci5DaGFyYWN0ZXIgYW5kIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSAtLSBBZGp1c3QgaWYgdGFyZ2V0aW5nIG90aGVyIHBhcnRzDQplbmQNCg0KLS0gTG9va0F0IGZ1bmN0aW9uDQpmdW5jdGlvbiBMb29rQXQodGFyZ2V0KQ0KICAgIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZSA9IENGcmFtZS5sb29rQXQoDQogICAgICAgIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Qb3NpdGlvbiwNCiAgICAgICAgdGFyZ2V0LlBvc2l0aW9uDQogICAgKQ0KZW5kDQoNCi0tIEhvbGQgdHJhY2tpbmcgZmxhZw0KbG9jYWwgaXNUcmFja2luZyA9IGZhbHNlDQpsb2NhbCB0YXJnZXRQbGF5ZXIgPSBuaWwNCg0KLS0gVHJhY2sgY2xvc2VzdCBwbGF5ZXIgd2hpbGUgaG9sZGluZyBNb3VzZUJ1dHRvbjINCmZ1bmN0aW9uIFRyYWNrVGFyZ2V0KCkNCiAgICBsb2NhbCBjbG9zZXN0UGxheWVyID0gR2V0Q2xvc2VzdFBsYXllclRvTW91c2UoKQ0KICAgIGlmIGNsb3Nlc3RQbGF5ZXIgdGhlbg0KICAgICAgICB0YXJnZXRQbGF5ZXIgPSBjbG9zZXN0UGxheWVyDQogICAgZW5kDQoNCiAgICB3aGlsZSBpc1RyYWNraW5nIGFuZCBBaW1ib3RDYW0uRW5hYmxlZCBhbmQgdGFyZ2V0UGxheWVyIGRvDQogICAgICAgIGxvY2FsIHBlcmNlbnRhZ2UgPSBtYXRoLnJhbmRvbSgwLCAxMDApDQogICAgICAgIGlmIHBlcmNlbnRhZ2UgPD0gQWltYm90Q2FtLkhpdENoYW5jZSB0aGVuDQogICAgICAgICAgICBpZiBBaW1ib3RDYW0uTm90V29ya0lmRmxhc2hlZCBhbmQgTGlnaHRpbmc6RmluZEZpcnN0Q2hpbGQoIkZsYXNoYmFuZyIpIHRoZW4NCiAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0ID0gR2V0QWltYm90UGFydCh0YXJnZXRQbGF5ZXIpDQogICAgICAgICAgICBpZiB0YXJnZXQgdGhlbg0KICAgICAgICAgICAgICAgIExvb2tBdCh0YXJnZXQpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgICAgIFJ1blNlcnZpY2UuUmVuZGVyU3RlcHBlZDpXYWl0KCkNCiAgICBlbmQNCmVuZA0KDQotLSBNb3VzZSBJbnB1dCBIYW5kbGluZw0KVXNlcklucHV0U2VydmljZS5JbnB1dEJlZ2FuOkNvbm5lY3QoZnVuY3Rpb24oaW8sIGdhbWVQcm9jZXNzZWRFdmVudCkNCiAgICBpZiBub3QgZ2FtZVByb2Nlc3NlZEV2ZW50IGFuZCBpby5Vc2VySW5wdXRUeXBlID09IEVudW0uVXNlcklucHV0VHlwZS5Nb3VzZUJ1dHRvbjIgdGhlbg0KICAgICAgICBpc1RyYWNraW5nID0gdHJ1ZQ0KICAgICAgICB0YXNrLnNwYXduKFRyYWNrVGFyZ2V0KQ0KICAgIGVuZA0KZW5kKQ0KDQpVc2VySW5wdXRTZXJ2aWNlLklucHV0RW5kZWQ6Q29ubmVjdChmdW5jdGlvbihpbywgZ2FtZVByb2Nlc3NlZEV2ZW50KQ0KICAgIGlmIGlvLlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMiB0aGVuDQogICAgICAgIGlzVHJhY2tpbmcgPSBmYWxzZQ0KICAgICAgICB0YXJnZXRQbGF5ZXIgPSBuaWwgLS0gUmVzZXQgdGFyZ2V0IHdoZW4gbW91c2UgaXMgcmVsZWFzZWQNCiAgICBlbmQNCmVuZCkNCg0KLS0gVG9nZ2xlIGxvZ2ljIHRvIGVuYWJsZS9kaXNhYmxlIHRoZSBBaW1ib3QNCmxvY2FsIFRvZ2dsZSA9IFRhYnMuQWltVGFiOkFkZFRvZ2dsZSgiQ2FtVG9nZ2xlIiwge1RpdGxlID0gIkNhbSBBaW1ib3QiLCBEZWZhdWx0ID0gZmFsc2V9KSANCg0KVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgaWYgdGV4dExhYmVscyBhbmQgdGV4dExhYmVscy50ZXh0TGFiZWwyIHRoZW4gDQogICAgICAgIHRleHRMYWJlbHMudGV4dExhYmVsMi5WaXNpYmxlID0gT3B0aW9ucy5DYW1Ub2dnbGUuVmFsdWUNCiAgICAgICAgZmFkZVRleHQodGV4dExhYmVscy50ZXh0TGFiZWwyLCBPcHRpb25zLkNhbVRvZ2dsZS5WYWx1ZSkNCiAgICAgICAgYWxpZ25UZXh0TGFiZWxzKCkNCiAgICBlbmQNCiAgICBBaW1ib3RDYW0uRW5hYmxlZCA9IFRvZ2dsZS5WYWx1ZQ0KZW5kKQ0KLS0tTW91c2UtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQotLS0tLS0tLS0tU2lsZW50LS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KDQpsb2NhbCBXb3Jrc3BhY2UgPSBnYW1lOkdldFNlcnZpY2UoIldvcmtzcGFjZSIpDQpsb2NhbCBVc2VySW5wdXRTZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJVc2VySW5wdXRTZXJ2aWNlIikNCmxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpDQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikNCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQ0KDQotLSBMb2NhbCBQbGF5ZXINCmxvY2FsIExvY2FsUGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcg0KDQotLSBTaWxlbnQgQWltIENvbmZpZw0KU2lsZW50QWltID0gew0KICAgIEVuYWJsZWQgPSBmYWxzZSwgLS0gQ29udHJvbGxlZCBieSB0b2dnbGUNCiAgICBIaXRDaGFuY2UgPSAxMDAsDQogICAgTm90V29ya0lmRmxhc2hlZCA9IHRydWUsDQogICAgTWF4RGlzdGFuY2UgPSAyNTAsIC0tIE1heGltdW0gdGFyZ2V0IGRpc3RhbmNlDQogICAgVGFyZ2V0UGFydCA9ICJIZWFkIiAtLSBEZWZhdWx0IHRhcmdldCBwYXJ0IChjYW4gYmUgY2hhbmdlZCB2aWEgZHJvcGRvd24pDQp9DQoNClNpbGVudEFpbUZvdiA9IHsNCiAgICBWaXNpYmxlID0gdHJ1ZSwgLS0gQ29udHJvbGxlZCBieSB0b2dnbGUNCiAgICBSYWRpdXMgPSAxNTAsICAgLS0gRGVmYXVsdCBGT1YgcmFkaXVzDQogICAgQ29sb3IgPSBDb2xvcjMuZnJvbVJHQig5NiwgMjA1LCAyNTUpLCAtLSBEZWZhdWx0IEZPViBjb2xvcg0KICAgIENpcmNsZSA9IG5pbCAtLSBXaWxsIGhvbGQgdGhlIERyYXdpbmcgb2JqZWN0DQp9DQoNCi0tIERyYXcgRk9WIENpcmNsZQ0KZnVuY3Rpb24gRHJhd0ZvdigpDQogICAgaWYgU2lsZW50QWltRm92LkNpcmNsZSB0aGVuDQogICAgICAgIFNpbGVudEFpbUZvdi5DaXJjbGU6UmVtb3ZlKCkNCiAgICBlbmQNCg0KICAgIGxvY2FsIGNpcmNsZSA9IERyYXdpbmcubmV3KCJDaXJjbGUiKQ0KICAgIGNpcmNsZS5Db2xvciA9IFNpbGVudEFpbUZvdi5Db2xvciAtLSBJbml0aWFsIGNvbG9yDQogICAgY2lyY2xlLlRoaWNrbmVzcyA9IDAuMg0KICAgIGNpcmNsZS5OdW1TaWRlcyA9IDEwMA0KICAgIGNpcmNsZS5SYWRpdXMgPSBTaWxlbnRBaW1Gb3YuUmFkaXVzDQogICAgY2lyY2xlLkZpbGxlZCA9IGZhbHNlDQogICAgY2lyY2xlLlRyYW5zcGFyZW5jeSA9IDENCiAgICBjaXJjbGUuVmlzaWJsZSA9IFNpbGVudEFpbUZvdi5WaXNpYmxlDQogICAgU2lsZW50QWltRm92LkNpcmNsZSA9IGNpcmNsZQ0KZW5kDQoNCi0tIFVwZGF0ZSBGT1YgQ2lyY2xlIFBvc2l0aW9uDQpmdW5jdGlvbiBVcGRhdGVGb3YoKQ0KICAgIGlmIFNpbGVudEFpbUZvdi5DaXJjbGUgdGhlbg0KICAgICAgICBTaWxlbnRBaW1Gb3YuQ2lyY2xlLlZpc2libGUgPSBTaWxlbnRBaW1Gb3YuVmlzaWJsZQ0KICAgICAgICBTaWxlbnRBaW1Gb3YuQ2lyY2xlLlBvc2l0aW9uID0gVXNlcklucHV0U2VydmljZTpHZXRNb3VzZUxvY2F0aW9uKCkNCiAgICBlbmQNCmVuZA0KDQotLSBHZXQgdGhlIGNsb3Nlc3QgcGxheWVyIG9yIHRhcmdldCBwYXJ0IHdpdGhpbiB0aGUgRk9WIGNpcmNsZSBhbmQgbWF4IGRpc3RhbmNlDQpmdW5jdGlvbiBHZXRDbG9zZXN0VGFyZ2V0VG9Nb3VzZSgpDQogICAgbG9jYWwgbW91c2VMb2NhdGlvbiA9IFVzZXJJbnB1dFNlcnZpY2U6R2V0TW91c2VMb2NhdGlvbigpDQogICAgbG9jYWwgY2xvc2VzdFRhcmdldCA9IG5pbA0KICAgIGxvY2FsIGNsb3Nlc3REaXN0YW5jZSA9IG1hdGguaHVnZQ0KDQogICAgLS0gQ2hlY2sgUGxheWVycw0KICAgIGZvciBfLCBwbGF5ZXIgaW4gcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvDQogICAgICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIHRhcmdldFBhcnQgPSBwbGF5ZXIuQ2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKFNpbGVudEFpbS5UYXJnZXRQYXJ0KQ0KICAgICAgICAgICAgaWYgdGFyZ2V0UGFydCB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2VGcm9tUGxheWVyID0gKHRhcmdldFBhcnQuUG9zaXRpb24gLSBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUuUG9zaXRpb24pLk1hZ25pdHVkZQ0KDQogICAgICAgICAgICAgICAgaWYgZGlzdGFuY2VGcm9tUGxheWVyIDw9IFNpbGVudEFpbS5NYXhEaXN0YW5jZSB0aGVuDQogICAgICAgICAgICAgICAgICAgIGxvY2FsIHNjcmVlblBvc2l0aW9uLCBvblNjcmVlbiA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhOldvcmxkVG9WaWV3cG9ydFBvaW50KHRhcmdldFBhcnQuUG9zaXRpb24pDQogICAgICAgICAgICAgICAgICAgIGlmIG9uU2NyZWVuIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlVG9Nb3VzZSA9IChWZWN0b3IyLm5ldyhzY3JlZW5Qb3NpdGlvbi5YLCBzY3JlZW5Qb3NpdGlvbi5ZKSAtIG1vdXNlTG9jYXRpb24pLk1hZ25pdHVkZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgZGlzdGFuY2VUb01vdXNlIDwgU2lsZW50QWltRm92LlJhZGl1cyBhbmQgZGlzdGFuY2VUb01vdXNlIDwgY2xvc2VzdERpc3RhbmNlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjbG9zZXN0VGFyZ2V0ID0gdGFyZ2V0UGFydA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3REaXN0YW5jZSA9IGRpc3RhbmNlVG9Nb3VzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KDQogICAgLS0gQ2hlY2sgb3RoZXIgdGFyZ2V0cyBsaWtlICdUYXJnZXQnIG1vZGVsDQogICAgZm9yIF8sIHRhcmdldCBpbiBwYWlycyhXb3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgdGFyZ2V0OklzQSgiTW9kZWwiKSBhbmQgdGFyZ2V0OkZpbmRGaXJzdENoaWxkKCJIdW1hbm9pZFJvb3RQYXJ0IikgYW5kIHRhcmdldC5OYW1lID09ICJUYXJnZXQiIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIHRhcmdldFBhcnQgPSB0YXJnZXQ6RmluZEZpcnN0Q2hpbGQoU2lsZW50QWltLlRhcmdldFBhcnQpIG9yIHRhcmdldDpGaW5kRmlyc3RDaGlsZCgiSHVtYW5vaWRSb290UGFydCIpDQogICAgICAgICAgICBpZiB0YXJnZXRQYXJ0IHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBkaXN0YW5jZUZyb21QbGF5ZXIgPSAodGFyZ2V0UGFydC5Qb3NpdGlvbiAtIFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhLkNGcmFtZS5Qb3NpdGlvbikuTWFnbml0dWRlDQoNCiAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZUZyb21QbGF5ZXIgPD0gU2lsZW50QWltLk1heERpc3RhbmNlIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgbG9jYWwgc2NyZWVuUG9zaXRpb24sIG9uU2NyZWVuID0gV29ya3NwYWNlLkN1cnJlbnRDYW1lcmE6V29ybGRUb1ZpZXdwb3J0UG9pbnQodGFyZ2V0UGFydC5Qb3NpdGlvbikNCiAgICAgICAgICAgICAgICAgICAgaWYgb25TY3JlZW4gdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgbG9jYWwgZGlzdGFuY2VUb01vdXNlID0gKFZlY3RvcjIubmV3KHNjcmVlblBvc2l0aW9uLlgsIHNjcmVlblBvc2l0aW9uLlkpIC0gbW91c2VMb2NhdGlvbikuTWFnbml0dWRlDQogICAgICAgICAgICAgICAgICAgICAgICBpZiBkaXN0YW5jZVRvTW91c2UgPCBTaWxlbnRBaW1Gb3YuUmFkaXVzIGFuZCBkaXN0YW5jZVRvTW91c2UgPCBjbG9zZXN0RGlzdGFuY2UgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsb3Nlc3RUYXJnZXQgPSB0YXJnZXRQYXJ0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xvc2VzdERpc3RhbmNlID0gZGlzdGFuY2VUb01vdXNlDQogICAgICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICByZXR1cm4gY2xvc2VzdFRhcmdldA0KZW5kDQoNCi0tIExvb2tBdCBmdW5jdGlvbg0KZnVuY3Rpb24gTG9va0F0KHRhcmdldCkNCiAgICBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUgPSBDRnJhbWUubG9va0F0KA0KICAgICAgICBXb3Jrc3BhY2UuQ3VycmVudENhbWVyYS5DRnJhbWUuUG9zaXRpb24sDQogICAgICAgIHRhcmdldC5Qb3NpdGlvbg0KICAgICkNCmVuZA0KDQotLSBTaWxlbnQgQWltIElucHV0IEhhbmRsaW5nDQpmdW5jdGlvbiBTaWxlbnRBaW1VSVMoaW8sIGdhbWVQcm9jZXNzZWRFdmVudCkNCiAgICBpZiBub3QgZ2FtZVByb2Nlc3NlZEV2ZW50IGFuZCBTaWxlbnRBaW0uRW5hYmxlZCB0aGVuDQogICAgICAgIGlmIGlvLlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuDQogICAgICAgICAgICBsb2NhbCBwZXJjZW50YWdlID0gbWF0aC5yYW5kb20oMCwgMTAwKQ0KICAgICAgICAgICAgaWYgcGVyY2VudGFnZSA8PSBTaWxlbnRBaW0uSGl0Q2hhbmNlIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBjbG9zZXN0VGFyZ2V0ID0gR2V0Q2xvc2VzdFRhcmdldFRvTW91c2UoKQ0KICAgICAgICAgICAgICAgIGlmIGNsb3Nlc3RUYXJnZXQgfj0gbmlsIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgaWYgU2lsZW50QWltLk5vdFdvcmtJZkZsYXNoZWQgYW5kIExpZ2h0aW5nOkZpbmRGaXJzdENoaWxkKCJGbGFzaGJhbmciKSB0aGVuDQogICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4NCiAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIExvb2tBdChjbG9zZXN0VGFyZ2V0KQ0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQoNCi0tIFJlbmRlciBsb29wIGZvciBGT1YgY2lyY2xlDQpSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpDQogICAgVXBkYXRlRm92KCkNCmVuZCkNCg0KLS0gQ29ubmVjdCBJbnB1dEJlZ2FuDQpVc2VySW5wdXRTZXJ2aWNlLklucHV0QmVnYW46Q29ubmVjdChTaWxlbnRBaW1VSVMpDQoNCi0tIEluaXRpYWxpemUgRk9WIENpcmNsZQ0KRHJhd0ZvdigpDQoNCi0tIFRvZ2dsZXMgSW50ZWdyYXRpb24NCmxvY2FsIFNpbGVudEFpbVRvZ2dsZSA9IFRhYnMuU2lsZW50OkFkZFRvZ2dsZSgiU0FpbXRnbCIsIHtUaXRsZSA9ICJTaWxlbnQgQWltIiwgRGVmYXVsdCA9IGZhbHNlfSkNCmxvY2FsIEZvdlRvZ2dsZSA9IFRhYnMuU2lsZW50OkFkZFRvZ2dsZSgiRm92dGdsIiwge1RpdGxlID0gIlNob3cgRk9WIiwgRGVmYXVsdCA9IGZhbHNlfSkNCg0KU2lsZW50QWltVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgICAgIGlmIHRleHRMYWJlbHMgYW5kIHRleHRMYWJlbHMuc2lsZW50YWltIHRoZW4NCiAgICAgICAgdGV4dExhYmVscy5zaWxlbnRhaW0uVmlzaWJsZSA9IE9wdGlvbnMuU0FpbXRnbC5WYWx1ZQ0KICAgICAgICBmYWRlVGV4dCh0ZXh0TGFiZWxzLnNpbGVudGFpbSwgT3B0aW9ucy5TQWltdGdsLlZhbHVlKQ0KICAgICAgICBhbGlnblRleHRMYWJlbHMoKQ0KICAgIGVuZA0KICAgIFNpbGVudEFpbS5FbmFibGVkID0gU2lsZW50QWltVG9nZ2xlLlZhbHVlDQplbmQpDQoNCkZvdlRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oKQ0KICAgIFNpbGVudEFpbUZvdi5WaXNpYmxlID0gRm92VG9nZ2xlLlZhbHVlDQplbmQpDQoNCi0tIFNsaWRlciBmb3IgRk9WIFJhZGl1cw0KbG9jYWwgU2xpZGVyID0gVGFicy5TaWxlbnQ6QWRkU2xpZGVyKCJTRm92U2xpZGVyIiwgeyANCiAgICBUaXRsZSA9ICJTaWxlbnQgRm92IFJhZGl1cyIsIA0KICAgIERlc2NyaXB0aW9uID0gIkFkanVzdCB0aGUgRk9WIFJhZGl1cyIsDQogICAgRGVmYXVsdCA9IDE1MCwgLS0gRGVmYXVsdCByYWRpdXMNCiAgICBNaW4gPSA1MCwgICAgICAtLSBNaW5pbXVtIHJhZGl1cw0KICAgIE1heCA9IDkwMCwgICAgIC0tIE1heGltdW0gcmFkaXVzDQogICAgUm91bmRpbmcgPSAwLCAgLS0gTm8gcm91bmRpbmcgKGludGVnZXIgdmFsdWVzKQ0KICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpDQogICAgICAgIFNpbGVudEFpbUZvdi5SYWRpdXMgPSBWYWx1ZSAtLSBVcGRhdGUgdGhlIHJhZGl1cyB2YWx1ZQ0KICAgICAgICBpZiBTaWxlbnRBaW1Gb3YuQ2lyY2xlIHRoZW4NCiAgICAgICAgICAgIFNpbGVudEFpbUZvdi5DaXJjbGUuUmFkaXVzID0gVmFsdWUgLS0gVXBkYXRlIHRoZSBkcmF3biBjaXJjbGUncyByYWRpdXMNCiAgICAgICAgZW5kDQogICAgZW5kDQp9KQ0KDQotLSBDb2xvciBQaWNrZXIgZm9yIEZPViBDaXJjbGUNCmxvY2FsIENvbG9ycGlja2VyID0gVGFicy5TaWxlbnQ6QWRkQ29sb3JwaWNrZXIoIlNGb3ZDb2xvcnBpY2tlciIsIHsNCiAgICBUaXRsZSA9ICJGb3YgQ29sb3IiLA0KICAgIERlZmF1bHQgPSBDb2xvcjMuZnJvbVJHQig5NiwgMjA1LCAyNTUpIC0tIERlZmF1bHQgRk9WIGNvbG9yDQp9KQ0KDQpDb2xvcnBpY2tlcjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpDQogICAgU2lsZW50QWltRm92LkNvbG9yID0gVmFsdWUgLS0gVXBkYXRlIGNvbG9yIHZhbHVlDQogICAgaWYgU2lsZW50QWltRm92LkNpcmNsZSB0aGVuDQogICAgICAgIFNpbGVudEFpbUZvdi5DaXJjbGUuQ29sb3IgPSBWYWx1ZSAtLSBVcGRhdGUgdGhlIGNpcmNsZSBjb2xvciBkeW5hbWljYWxseQ0KICAgIGVuZA0KZW5kKQ0KDQotLSBUYXJnZXQgRHJvcGRvd24NCmxvY2FsIERyb3Bkb3duID0gVGFicy5TaWxlbnQ6QWRkRHJvcGRvd24oIkRyb3Bkb3duIiwgew0KICAgIFRpdGxlID0gIlRhcmdldCBEcm9wZG93biIsDQogICAgVmFsdWVzID0geyJIZWFkIiwgIlVwcGVyVG9yc28iLCAiTG93ZXJUb3JzbyJ9LA0KICAgIE11bHRpID0gZmFsc2UsDQogICAgRGVmYXVsdCA9IDEsIC0tIERlZmF1bHQgaXMgSGVhZA0KfSkNCg0KRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KICAgIFNpbGVudEFpbS5UYXJnZXRQYXJ0ID0gVmFsdWUNCiAgICBEb3RQb3NpdGlvbiA9IFZhbHVlDQplbmQpDQoNCi0tIFNldHRpbmdzDQpsb2NhbCBFU1BDb2xvciA9IENvbG9yMy5uZXcoMSwgMCwgMCkgLS0gUmVkDQpsb2NhbCBEb3RTaXplID0gMiAtLSBEZWZhdWx0IGRvdCBzaXplDQpsb2NhbCBNYXhSaW5nU2l6ZSA9IDEyIC0tIE1heGltdW0gc2l6ZSBvZiB0aGUgYW5pbWF0ZWQgcmluZw0KbG9jYWwgUmluZ1RoaWNrbmVzcyA9IDIgLS0gVGhpY2tuZXNzIG9mIHRoZSByaW5nDQpsb2NhbCBBbmltYXRpb25TdGVwcyA9IDYgLS0gUmVkdWNlZCBzdGVwcyBmb3IgcXVpY2tlciB0cmFuc2l0aW9ucw0KbG9jYWwgQW5pbWF0aW9uU3BlZWQgPSAwLjAzIC0tIFRpbWUgYmV0d2VlbiBhbmltYXRpb24gc3RlcHMgKHNlY29uZHMpDQpsb2NhbCBSZWZyZXNoUmF0ZSA9IDAuMiAtLSBVcGRhdGUgcmF0ZSAoc2Vjb25kcykNCmxvY2FsIE1heERpc3RhbmNlID0gMzAwIC0tIE1heGltdW0gZGlzdGFuY2UgZm9yIGNoZWNraW5nIHBsYXllcnMNCg0KLS0gQ3VzdG9taXphYmxlIFBvc2l0aW9uDQpsb2NhbCBEb3RQb3NpdGlvbiA9ICJIZWFkIiAtLSBUaGUgcGFydCBvZiB0aGUgY2hhcmFjdGVyIHRvIGF0dGFjaCB0aGUgZG90IChlLmcuLCAiSGVhZCIsICJUb3JzbyIpDQoNCi0tIFNlcnZpY2VzDQpsb2NhbCBQbGF5ZXJzID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikNCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQ0KbG9jYWwgVXNlcklucHV0U2VydmljZSA9IGdhbWU6R2V0U2VydmljZSgiVXNlcklucHV0U2VydmljZSIpDQoNCi0tIExvY2FsIFBsYXllcg0KbG9jYWwgTG9jYWxQbGF5ZXIgPSBQbGF5ZXJzLkxvY2FsUGxheWVyDQoNCi0tIFRhYmxlIHRvIHN0b3JlIEVTUCBkb3RzDQpsb2NhbCBFU1BEb3RzID0ge30NCmxvY2FsIEhvbGRpbmcgPSBmYWxzZSAtLSBUcmFja3MgaWYgTW91c2UxIGlzIGJlaW5nIGhlbGQNCmxvY2FsIElzRW5hYmxlZCA9IGZhbHNlIC0tIFRyYWNrcyBpZiB0aGUgRVNQIHRvZ2dsZSBpcyBhY3RpdmUNCg0KLS0gRnVuY3Rpb24gdG8gY3JlYXRlIGEgbmV3IGRvdA0KbG9jYWwgZnVuY3Rpb24gY3JlYXRlRG90KCkNCiAgICBsb2NhbCBkb3QgPSBEcmF3aW5nLm5ldygiQ2lyY2xlIikNCiAgICBkb3QuQ29sb3IgPSBFU1BDb2xvcg0KICAgIGRvdC5SYWRpdXMgPSBEb3RTaXplDQogICAgZG90LlRoaWNrbmVzcyA9IDENCiAgICBkb3QuRmlsbGVkID0gdHJ1ZQ0KICAgIGRvdC5WaXNpYmxlID0gZmFsc2UNCiAgICByZXR1cm4gZG90DQplbmQNCg0KLS0gRnVuY3Rpb24gdG8gdXBkYXRlIEVTUCBkb3RzDQpsb2NhbCBmdW5jdGlvbiB1cGRhdGVFU1AoKQ0KICAgIGlmIG5vdCBJc0VuYWJsZWQgdGhlbiByZXR1cm4gbmlsIGVuZCAgLS0gSWYgRVNQIGlzIGRpc2FibGVkLCBleGl0IHRoZSBmdW5jdGlvbg0KDQogICAgbG9jYWwgY2FtZXJhID0gd29ya3NwYWNlLkN1cnJlbnRDYW1lcmENCiAgICBsb2NhbCBjZW50ZXJTY3JlZW4gPSBWZWN0b3IyLm5ldyhjYW1lcmEuVmlld3BvcnRTaXplLlggLyAyLCBjYW1lcmEuVmlld3BvcnRTaXplLlkgLyAyKQ0KICAgIGxvY2FsIGNsb3Nlc3RQbGF5ZXIgPSBuaWwNCiAgICBsb2NhbCBjbG9zZXN0RGlzdGFuY2UgPSBtYXRoLmh1Z2UNCg0KICAgIGZvciBfLCBwbGF5ZXIgaW4gcGFpcnMoUGxheWVyczpHZXRQbGF5ZXJzKCkpIGRvDQogICAgICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciBhbmQgcGxheWVyLkNoYXJhY3RlciBhbmQgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZChEb3RQb3NpdGlvbikgdGhlbg0KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UGFydCA9IHBsYXllci5DaGFyYWN0ZXJbRG90UG9zaXRpb25dDQogICAgICAgICAgICBsb2NhbCB0YXJnZXRQb3NpdGlvbiwgb25TY3JlZW4gPSBjYW1lcmE6V29ybGRUb1ZpZXdwb3J0UG9pbnQodGFyZ2V0UGFydC5Qb3NpdGlvbikNCiAgICAgICAgICAgIGxvY2FsIGRpc3RhbmNlID0gKHRhcmdldFBhcnQuUG9zaXRpb24gLSBjYW1lcmEuQ0ZyYW1lLlBvc2l0aW9uKS5NYWduaXR1ZGUNCg0KICAgICAgICAgICAgaWYgb25TY3JlZW4gYW5kIGRpc3RhbmNlIDw9IE1heERpc3RhbmNlIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBzY3JlZW5Qb3NpdGlvbiA9IFZlY3RvcjIubmV3KHRhcmdldFBvc2l0aW9uLlgsIHRhcmdldFBvc2l0aW9uLlkpDQogICAgICAgICAgICAgICAgbG9jYWwgY2VudGVyRGlzdGFuY2UgPSAoc2NyZWVuUG9zaXRpb24gLSBjZW50ZXJTY3JlZW4pLk1hZ25pdHVkZQ0KDQogICAgICAgICAgICAgICAgaWYgY2VudGVyRGlzdGFuY2UgPCBjbG9zZXN0RGlzdGFuY2UgdGhlbg0KICAgICAgICAgICAgICAgICAgICBjbG9zZXN0RGlzdGFuY2UgPSBjZW50ZXJEaXN0YW5jZQ0KICAgICAgICAgICAgICAgICAgICBjbG9zZXN0UGxheWVyID0gcGxheWVyDQogICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICAtLSBVcGRhdGUgdmlzaWJpbGl0eSBmb3IgYWxsIGRvdHMNCiAgICBmb3IgcGxheWVyLCBkb3QgaW4gcGFpcnMoRVNQRG90cykgZG8NCiAgICAgICAgaWYgcGxheWVyID09IGNsb3Nlc3RQbGF5ZXIgdGhlbg0KICAgICAgICAgICAgbG9jYWwgdGFyZ2V0UG9zaXRpb24gPSB3b3Jrc3BhY2UuQ3VycmVudENhbWVyYTpXb3JsZFRvVmlld3BvcnRQb2ludChwbGF5ZXIuQ2hhcmFjdGVyW0RvdFBvc2l0aW9uXS5Qb3NpdGlvbikNCiAgICAgICAgICAgIGRvdC5Qb3NpdGlvbiA9IFZlY3RvcjIubmV3KHRhcmdldFBvc2l0aW9uLlgsIHRhcmdldFBvc2l0aW9uLlkpDQogICAgICAgICAgICBkb3QuVmlzaWJsZSA9IHRydWUNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgZG90LlZpc2libGUgPSBmYWxzZQ0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIHJldHVybiBjbG9zZXN0UGxheWVyDQplbmQNCg0KLS0gRnVuY3Rpb24gdG8gYW5pbWF0ZSB0aGUgdHJhbnNpdGlvbiBpbnRvIGEgcmluZw0KbG9jYWwgZnVuY3Rpb24gYW5pbWF0ZVRvUmluZyhkb3QpDQogICAgZG90LkZpbGxlZCA9IGZhbHNlDQogICAgZm9yIGkgPSAxLCBBbmltYXRpb25TdGVwcyBkbw0KICAgICAgICBpZiBub3QgSG9sZGluZyB0aGVuIGJyZWFrIGVuZCAtLSBTdG9wIGFuaW1hdGlvbiBpZiBjbGljayBlbmRzDQogICAgICAgIGRvdC5SYWRpdXMgPSBEb3RTaXplICsgKChNYXhSaW5nU2l6ZSAtIERvdFNpemUpIC8gQW5pbWF0aW9uU3RlcHMpICogaQ0KICAgICAgICBkb3QuVGhpY2tuZXNzID0gKChSaW5nVGhpY2tuZXNzIC0gMSkgLyBBbmltYXRpb25TdGVwcykgKiBpDQogICAgICAgIHRhc2sud2FpdChBbmltYXRpb25TcGVlZCkNCiAgICBlbmQNCmVuZA0KDQotLSBGdW5jdGlvbiB0byBhbmltYXRlIHRoZSB0cmFuc2l0aW9uIGJhY2sgdG8gYSBkb3QNCmxvY2FsIGZ1bmN0aW9uIGFuaW1hdGVUb0RvdChkb3QpDQogICAgZG90LkZpbGxlZCA9IGZhbHNlIC0tIEtlZXBzIGl0IGhvbGxvdyB1bnRpbCBhbmltYXRpb24gZW5kcw0KICAgIGZvciBpID0gQW5pbWF0aW9uU3RlcHMsIDEsIC0xIGRvDQogICAgICAgIGlmIEhvbGRpbmcgdGhlbiBicmVhayBlbmQgLS0gU3RvcCBhbmltYXRpb24gaWYgaG9sZGluZyBzdGFydHMNCiAgICAgICAgZG90LlJhZGl1cyA9IERvdFNpemUgKyAoKE1heFJpbmdTaXplIC0gRG90U2l6ZSkgLyBBbmltYXRpb25TdGVwcykgKiBpDQogICAgICAgIGRvdC5UaGlja25lc3MgPSAoKFJpbmdUaGlja25lc3MgLSAxKSAvIEFuaW1hdGlvblN0ZXBzKSAqIGkNCiAgICAgICAgdGFzay53YWl0KEFuaW1hdGlvblNwZWVkKQ0KICAgIGVuZA0KICAgIGRvdC5SYWRpdXMgPSBEb3RTaXplDQogICAgZG90LlRoaWNrbmVzcyA9IDENCiAgICBkb3QuRmlsbGVkID0gdHJ1ZSAtLSBSZXN0b3JlcyB0aGUgZmlsbGVkIGRvdA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIGNsZWFuIHVwIEVTUCBkb3RzIHdoZW4gcGxheWVycyBsZWF2ZQ0KbG9jYWwgZnVuY3Rpb24gY2xlYW5VcChwbGF5ZXIpDQogICAgaWYgRVNQRG90c1twbGF5ZXJdIHRoZW4NCiAgICAgICAgRVNQRG90c1twbGF5ZXJdOlJlbW92ZSgpDQogICAgICAgIEVTUERvdHNbcGxheWVyXSA9IG5pbA0KICAgIGVuZA0KZW5kDQoNCi0tIENyZWF0ZSBkb3RzIGZvciBwbGF5ZXJzDQpmb3IgXywgcGxheWVyIGluIHBhaXJzKFBsYXllcnM6R2V0UGxheWVycygpKSBkbw0KICAgIGlmIHBsYXllciB+PSBMb2NhbFBsYXllciB0aGVuDQogICAgICAgIEVTUERvdHNbcGxheWVyXSA9IGNyZWF0ZURvdCgpDQogICAgZW5kDQplbmQNCg0KUGxheWVycy5QbGF5ZXJBZGRlZDpDb25uZWN0KGZ1bmN0aW9uKHBsYXllcikNCiAgICBpZiBwbGF5ZXIgfj0gTG9jYWxQbGF5ZXIgdGhlbg0KICAgICAgICBFU1BEb3RzW3BsYXllcl0gPSBjcmVhdGVEb3QoKQ0KICAgIGVuZA0KZW5kKQ0KDQpQbGF5ZXJzLlBsYXllclJlbW92aW5nOkNvbm5lY3QoY2xlYW5VcCkNCg0KLS0gTW91c2UgaW5wdXQgaGFuZGxpbmcNClVzZXJJbnB1dFNlcnZpY2UuSW5wdXRCZWdhbjpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBpc1Byb2Nlc3NlZCkNCiAgICBpZiBub3QgaXNQcm9jZXNzZWQgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuDQogICAgICAgIEhvbGRpbmcgPSB0cnVlDQogICAgICAgIGxvY2FsIGNsb3Nlc3RQbGF5ZXIgPSB1cGRhdGVFU1AoKQ0KICAgICAgICBpZiBjbG9zZXN0UGxheWVyIGFuZCBFU1BEb3RzW2Nsb3Nlc3RQbGF5ZXJdIHRoZW4NCiAgICAgICAgICAgIGFuaW1hdGVUb1JpbmcoRVNQRG90c1tjbG9zZXN0UGxheWVyXSkNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNClVzZXJJbnB1dFNlcnZpY2UuSW5wdXRFbmRlZDpDb25uZWN0KGZ1bmN0aW9uKGlucHV0LCBpc1Byb2Nlc3NlZCkNCiAgICBpZiBub3QgaXNQcm9jZXNzZWQgYW5kIGlucHV0LlVzZXJJbnB1dFR5cGUgPT0gRW51bS5Vc2VySW5wdXRUeXBlLk1vdXNlQnV0dG9uMSB0aGVuDQogICAgICAgIEhvbGRpbmcgPSBmYWxzZQ0KICAgICAgICBsb2NhbCBjbG9zZXN0UGxheWVyID0gdXBkYXRlRVNQKCkNCiAgICAgICAgaWYgY2xvc2VzdFBsYXllciBhbmQgRVNQRG90c1tjbG9zZXN0UGxheWVyXSB0aGVuDQogICAgICAgICAgICBhbmltYXRlVG9Eb3QoRVNQRG90c1tjbG9zZXN0UGxheWVyXSkNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNCi0tIFVwZGF0ZSBFU1Agb24gcmVuZGVyDQpSdW5TZXJ2aWNlLlJlbmRlclN0ZXBwZWQ6Q29ubmVjdChmdW5jdGlvbigpDQogICAgdGFzay53YWl0KFJlZnJlc2hSYXRlKQ0KICAgIHVwZGF0ZUVTUCgpDQplbmQpDQoNCi0tIFRvZ2dsZSBoYW5kbGluZw0KbG9jYWwgVG9nZ2xlID0gVGFicy5TaWxlbnQ6QWRkVG9nZ2xlKCJUYXJnZXRJbmRpY2F0b3IiLCB7VGl0bGUgPSAiVGFyZ2V0IEluZGljYXRvciIsIERlZmF1bHQgPSBmYWxzZSB9KQ0KDQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCiAgICBJc0VuYWJsZWQgPSBUb2dnbGUuVmFsdWUgIC0tIFRvZ2dsZSBFU1AgdmlzaWJpbGl0eQ0KICAgIGlmIG5vdCBJc0VuYWJsZWQgdGhlbg0KICAgICAgICAtLSBIaWRlIGFsbCBkb3RzIHdoZW4gRVNQIGlzIGRpc2FibGVkDQogICAgICAgIGZvciBfLCBkb3QgaW4gcGFpcnMoRVNQRG90cykgZG8NCiAgICAgICAgICAgIGRvdC5WaXNpYmxlID0gZmFsc2UNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KLS0tLS0tLU1vZFRhYi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQpsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KbG9jYWwgdXNlcm5hbWUgPSBwbGF5ZXIuTmFtZQ0KbG9jYWwgZmlyc3RQZXJzb25Gb2xkZXIgPSBXb3Jrc3BhY2U6RmluZEZpcnN0Q2hpbGQoIlZpZXdNb2RlbHMiKTpGaW5kRmlyc3RDaGlsZCgiRmlyc3RQZXJzb24iKQ0KaWYgbm90IGZpcnN0UGVyc29uRm9sZGVyIHRoZW4NCiAgICB3YXJuKCJGaXJzdFBlcnNvbiBmb2xkZXIgbm90IGZvdW5kIGluIFZpZXdNb2RlbHMiKQ0KICAgIHJldHVybg0KZW5kDQoNCi0tIFN0b3JlIHRoZSBvcmlnaW5hbCBzaXplIG9mIExlZnRBcm0gYW5kIFJpZ2h0QXJtDQpsb2NhbCBvcmlnaW5hbFNpemVzID0ge30NCg0KLS0gRnVuY3Rpb24gdG8gbW9kaWZ5IHRoZSBhcm1zIG9mIHRoZSBtb2RlbA0KbG9jYWwgZnVuY3Rpb24gbW9kaWZ5QXJtcyhtb2RlbCwgdG9nZ2xlU3RhdGUpDQogICAgbG9jYWwgbGVmdEFybSA9IG1vZGVsOkZpbmRGaXJzdENoaWxkKCJMZWZ0QXJtIikNCiAgICBsb2NhbCByaWdodEFybSA9IG1vZGVsOkZpbmRGaXJzdENoaWxkKCJSaWdodEFybSIpDQoNCiAgICBpZiBsZWZ0QXJtIHRoZW4NCiAgICAgICAgaWYgdG9nZ2xlU3RhdGUgdGhlbg0KICAgICAgICAgICAgLS0gUmVtb3ZlIHRoZSBNZXNoIGZyb20gTGVmdEFybSBpZiBpdCBleGlzdHMNCiAgICAgICAgICAgIGxvY2FsIGxlZnRBcm1NZXNoID0gbGVmdEFybTpGaW5kRmlyc3RDaGlsZCgiTWVzaCIpDQogICAgICAgICAgICBpZiBsZWZ0QXJtTWVzaCB0aGVuDQogICAgICAgICAgICAgICAgbGVmdEFybU1lc2g6RGVzdHJveSgpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIC0tIFNhdmUgdGhlIG9yaWdpbmFsIHNpemUgaWYgbm90IHNhdmVkIGFuZCBzZXQgdG8gKDAsIDAsIDApDQogICAgICAgICAgICBpZiBub3Qgb3JpZ2luYWxTaXplc1tsZWZ0QXJtXSB0aGVuDQogICAgICAgICAgICAgICAgb3JpZ2luYWxTaXplc1tsZWZ0QXJtXSA9IGxlZnRBcm0uU2l6ZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICBsZWZ0QXJtLlNpemUgPSBWZWN0b3IzLm5ldygwLCAwLCAwKQ0KICAgICAgICBlbHNlDQogICAgICAgICAgICAtLSBSZXN0b3JlIHRoZSBvcmlnaW5hbCBzaXplDQogICAgICAgICAgICBpZiBvcmlnaW5hbFNpemVzW2xlZnRBcm1dIHRoZW4NCiAgICAgICAgICAgICAgICBsZWZ0QXJtLlNpemUgPSBvcmlnaW5hbFNpemVzW2xlZnRBcm1dDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICBpZiByaWdodEFybSB0aGVuDQogICAgICAgIGlmIHRvZ2dsZVN0YXRlIHRoZW4NCiAgICAgICAgICAgIC0tIFJlbW92ZSB0aGUgTWVzaCBmcm9tIFJpZ2h0QXJtIGlmIGl0IGV4aXN0cw0KICAgICAgICAgICAgbG9jYWwgcmlnaHRBcm1NZXNoID0gcmlnaHRBcm06RmluZEZpcnN0Q2hpbGQoIk1lc2giKQ0KICAgICAgICAgICAgaWYgcmlnaHRBcm1NZXNoIHRoZW4NCiAgICAgICAgICAgICAgICByaWdodEFybU1lc2g6RGVzdHJveSgpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIC0tIFNhdmUgdGhlIG9yaWdpbmFsIHNpemUgaWYgbm90IHNhdmVkIGFuZCBzZXQgdG8gKDAsIDAsIDApDQogICAgICAgICAgICBpZiBub3Qgb3JpZ2luYWxTaXplc1tyaWdodEFybV0gdGhlbg0KICAgICAgICAgICAgICAgIG9yaWdpbmFsU2l6ZXNbcmlnaHRBcm1dID0gcmlnaHRBcm0uU2l6ZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgICAgICByaWdodEFybS5TaXplID0gVmVjdG9yMy5uZXcoMCwgMCwgMCkNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgLS0gUmVzdG9yZSB0aGUgb3JpZ2luYWwgc2l6ZQ0KICAgICAgICAgICAgaWYgb3JpZ2luYWxTaXplc1tyaWdodEFybV0gdGhlbg0KICAgICAgICAgICAgICAgIHJpZ2h0QXJtLlNpemUgPSBvcmlnaW5hbFNpemVzW3JpZ2h0QXJtXQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIGZpbmQgYW5kIG1vZGlmeSB0aGUgbW9kZWwgd2hlbiBpdCBjaGFuZ2VzDQpsb2NhbCBmdW5jdGlvbiBvbk1vZGVsQ2hhbmdlZCgpDQogICAgaWYgbm90IE9wdGlvbnMgb3Igbm90IE9wdGlvbnMuTm9IYW5kcyB0aGVuDQogICAgICAgIHdhcm4oIk9wdGlvbnMuTm9IYW5kcyBpcyBtaXNzaW5nIikNCiAgICAgICAgcmV0dXJuDQogICAgZW5kDQoNCiAgICBsb2NhbCBtb2RlbFRvTW9kaWZ5ID0gbmlsDQogICAgZm9yIF8sIG1vZGVsIGluIHBhaXJzKGZpcnN0UGVyc29uRm9sZGVyOkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgIGlmIG1vZGVsLk5hbWU6ZmluZCh1c2VybmFtZSkgdGhlbg0KICAgICAgICAgICAgbW9kZWxUb01vZGlmeSA9IG1vZGVsDQogICAgICAgICAgICBicmVhaw0KICAgICAgICBlbmQNCiAgICBlbmQNCg0KICAgIGlmIG1vZGVsVG9Nb2RpZnkgdGhlbg0KICAgICAgICAtLSBBcHBseSB0aGUgdG9nZ2xlIHN0YXRlIHRvIG1vZGlmeSB0aGUgYXJtcw0KICAgICAgICBsb2NhbCB0b2dnbGVTdGF0ZSA9IE9wdGlvbnMuTm9IYW5kcy5WYWx1ZQ0KICAgICAgICBtb2RpZnlBcm1zKG1vZGVsVG9Nb2RpZnksIHRvZ2dsZVN0YXRlKQ0KICAgIGVsc2UNCiAgICAgICAgd2FybigiTm8gbW9kZWwgZm91bmQgZm9yIHBsYXllcjogIiAuLiB1c2VybmFtZSkNCiAgICBlbmQNCmVuZA0KDQotLSBJbml0aWFsbHkgY2hlY2sgYW5kIG1vZGlmeSB0aGUgZmlyc3QgbW9kZWwNCm9uTW9kZWxDaGFuZ2VkKCkNCg0KLS0gTGlzdGVuIGZvciBjaGFuZ2VzIGluIHRoZSBGaXJzdFBlcnNvbiBmb2xkZXIgYW5kIGFwcGx5IGNoYW5nZXMgdG8gdGhlIG5ldyBtb2RlbA0KZmlyc3RQZXJzb25Gb2xkZXIuQ2hpbGRBZGRlZDpDb25uZWN0KG9uTW9kZWxDaGFuZ2VkKQ0KZmlyc3RQZXJzb25Gb2xkZXIuQ2hpbGRSZW1vdmVkOkNvbm5lY3Qob25Nb2RlbENoYW5nZWQpDQoNCi0tIFRvZ2dsZSBpbXBsZW1lbnRhdGlvbg0KbG9jYWwgVG9nZ2xlID0gVGFicy5Nb2RUYWI6QWRkVG9nZ2xlKCJOb0hhbmRzIiwge1RpdGxlID0gIkdob3N0IEhhbmRzIiwgRGVmYXVsdCA9IGZhbHNlfSkNCg0KVG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgLS0gVXBkYXRlIHRleHQgbGFiZWxzIGlmIHByZXNlbnQNCiAgICBpZiB0ZXh0TGFiZWxzIGFuZCB0ZXh0TGFiZWxzLmdob3N0dHh0IHRoZW4NCiAgICAgICAgdGV4dExhYmVscy5naG9zdHR4dC5WaXNpYmxlID0gVG9nZ2xlLlZhbHVlDQogICAgICAgIGZhZGVUZXh0KHRleHRMYWJlbHMuZ2hvc3R0eHQsIFRvZ2dsZS5WYWx1ZSkNCiAgICAgICAgYWxpZ25UZXh0TGFiZWxzKCkNCiAgICBlbmQNCg0KICAgIC0tIFJlY2hlY2sgdGhlIG1vZGVsIGFuZCBhcHBseSB0aGUgdG9nZ2xlIHN0YXRlIHRvIHRoZSBhcm1zDQogICAgb25Nb2RlbENoYW5nZWQoKQ0KZW5kKQ0KDQpsb2NhbCBSdW5TZXJ2aWNlID0gZ2FtZTpHZXRTZXJ2aWNlKCJSdW5TZXJ2aWNlIikNCmxvY2FsIGZpcnN0UGVyc29uID0gV29ya3NwYWNlLlZpZXdNb2RlbHMuRmlyc3RQZXJzb24NCg0KLS0gVGFibGUgdG8gc3RvcmUgcGFydHMgZm9yIHRoZSBlZmZlY3QNCmxvY2FsIGFmZmVjdGVkUGFydHMgPSB7fQ0KDQotLSBGdW5jdGlvbiB0byBhcHBseSBzdGF0aWMgdHJhbnNwYXJlbmN5IHRvIE1lc2hQYXJ0cw0KbG9jYWwgZnVuY3Rpb24gYXBwbHlTdGF0aWNUcmFuc3BhcmVuY3koKQ0KICAgIC0tIENsZWFyIHRoZSBwcmV2aW91cyBwYXJ0cyB0byBhdm9pZCBhcHBseWluZyBlZmZlY3RzIHRvIHRoZSBvbGQgbW9kZWwNCiAgICBhZmZlY3RlZFBhcnRzID0ge30NCg0KICAgIC0tIExvb3AgdGhyb3VnaCBhbGwgZGVzY2VuZGFudHMgaW4gdGhlIEZpcnN0UGVyc29uIG1vZGVsDQogICAgZm9yIF8sIGRlc2NlbmRhbnQgaW4gaXBhaXJzKGZpcnN0UGVyc29uOkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgIC0tIENoZWNrIGlmIHRoZSBkZXNjZW5kYW50IGlzIGEgTW9kZWwgYW5kIGNvbnRhaW5zIGFuIEl0ZW1WaXN1YWwgd2l0aCBhIEJvZHkgcGFydA0KICAgICAgICBsb2NhbCBpdGVtVmlzdWFsID0gZGVzY2VuZGFudDpGaW5kRmlyc3RDaGlsZCgiSXRlbVZpc3VhbCIpDQogICAgICAgIGlmIGRlc2NlbmRhbnQ6SXNBKCJNb2RlbCIpIGFuZCBpdGVtVmlzdWFsIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGJvZHkgPSBpdGVtVmlzdWFsOkZpbmRGaXJzdENoaWxkKCJCb2R5IikNCiAgICAgICAgICAgIC0tIENoZWNrIGlmIHRoZSBCb2R5IHBhcnQgZXhpc3RzDQogICAgICAgICAgICBpZiBib2R5IHRoZW4NCiAgICAgICAgICAgICAgICAtLSBMb29wIHRocm91Z2ggYWxsIGNoaWxkcmVuIGluIHRoZSBCb2R5IG1vZGVsDQogICAgICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKGJvZHk6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdGhlIGNoaWxkIGlzIGEgTWVzaFBhcnQNCiAgICAgICAgICAgICAgICAgICAgaWYgcGFydDpJc0EoIk1lc2hQYXJ0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgLS0gU2V0IHRoZSBzdGF0aWMgdHJhbnNwYXJlbmN5IHZhbHVlDQogICAgICAgICAgICAgICAgICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAuNg0KICAgICAgICAgICAgICAgICAgICAgICAgdGFibGUuaW5zZXJ0KGFmZmVjdGVkUGFydHMsIHBhcnQpICAtLSBTdG9yZSB0aGUgcGFydCBmb3IgcmVmZXJlbmNlDQogICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIHJlbW92ZSBzdGF0aWMgdHJhbnNwYXJlbmN5IGZyb20gTWVzaFBhcnRzDQpsb2NhbCBmdW5jdGlvbiByZW1vdmVTdGF0aWNUcmFuc3BhcmVuY3koKQ0KICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhhZmZlY3RlZFBhcnRzKSBkbw0KICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAgIC0tIFJlc2V0IHRyYW5zcGFyZW5jeSBiYWNrIHRvIDANCiAgICBlbmQNCmVuZA0KDQotLSBBZGQgYSBUb2dnbGUgdG8gZW5hYmxlL2Rpc2FibGUgdGhlIGVmZmVjdA0KbG9jYWwgVG9nZ2xlID0gVGFicy5Nb2RUYWI6QWRkVG9nZ2xlKCJUcmFuc3BhcmVuY3lUb2dnbGUiLCB7DQogICAgVGl0bGUgPSAiTWF0ZXJpYWwgV2VhcG9uIiwgIC0tIFRpdGxlIG9mIHRoZSB0b2dnbGUNCiAgICBEZWZhdWx0ID0gZmFsc2UsICAgICAgICAgICAgLS0gRGVmYXVsdCBzdGF0ZSAoZmFsc2UgbWVhbnMgdGhlIGVmZmVjdCBpcyBvZmYgYnkgZGVmYXVsdCkNCn0pDQoNClRvZ2dsZTpPbkNoYW5nZWQoZnVuY3Rpb24oKQ0KICAgIGlmIFRvZ2dsZS5WYWx1ZSB0aGVuDQogICAgICAgIGFwcGx5U3RhdGljVHJhbnNwYXJlbmN5KCkgIC0tIEFwcGx5IHRoZSBzdGF0aWMgdHJhbnNwYXJlbmN5IGlmIHRoZSB0b2dnbGUgaXMgb24NCiAgICBlbHNlDQogICAgICAgIHJlbW92ZVN0YXRpY1RyYW5zcGFyZW5jeSgpICAtLSBSZW1vdmUgdGhlIHN0YXRpYyB0cmFuc3BhcmVuY3kgaWYgdGhlIHRvZ2dsZSBpcyBvZmYNCiAgICBlbmQNCmVuZCkNCg0KLS0gRnVuY3Rpb24gdG8gbW9uaXRvciBhbmQgcmVhcHBseSBzdGF0aWMgdHJhbnNwYXJlbmN5IGlmIHRoZSBtb2RlbCBjaGFuZ2VzDQpsb2NhbCBmdW5jdGlvbiBtb25pdG9yTW9kZWxDaGFuZ2UoKQ0KICAgIGxvY2FsIGxhc3RNb2RlbCA9IG5pbA0KICAgIC0tIE1vbml0b3IgZm9yIGFueSBjaGFuZ2VzIGluIHRoZSBGaXJzdFBlcnNvbiBtb2RlbA0KICAgIFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICBsb2NhbCBjdXJyZW50TW9kZWwgPSBmaXJzdFBlcnNvbjpGaW5kRmlyc3RDaGlsZE9mQ2xhc3MoIk1vZGVsIikNCiAgICAgICAgaWYgY3VycmVudE1vZGVsIH49IGxhc3RNb2RlbCB0aGVuDQogICAgICAgICAgICBsYXN0TW9kZWwgPSBjdXJyZW50TW9kZWwNCiAgICAgICAgICAgIC0tIFJlYXBwbHkgc3RhdGljIHRyYW5zcGFyZW5jeSBpZiB0aGUgdG9nZ2xlIGlzIG9uDQogICAgICAgICAgICBpZiBUb2dnbGUuVmFsdWUgdGhlbg0KICAgICAgICAgICAgICAgIGFwcGx5U3RhdGljVHJhbnNwYXJlbmN5KCkgIC0tIFJlYXBwbHkgdGhlIHN0YXRpYyB0cmFuc3BhcmVuY3kgdG8gdGhlIG5ldyBtb2RlbA0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZCkNCmVuZA0KDQotLSBTdGFydCBtb25pdG9yaW5nIHRoZSBtb2RlbCBjaGFuZ2VzIGFmdGVyIFRvZ2dsZSBpcyBpbml0aWFsaXplZA0KbW9uaXRvck1vZGVsQ2hhbmdlKCkNCg0KDQpsb2NhbCBwbGF5ZXIgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllcg0KbG9jYWwgbWlzY0Fzc2V0cyA9IHBsYXllci5QbGF5ZXJTY3JpcHRzLkFzc2V0czpXYWl0Rm9yQ2hpbGQoIk1pc2MiKQ0KbG9jYWwgbXV6emxlRmxhc2hlcyA9IG1pc2NBc3NldHM6V2FpdEZvckNoaWxkKCJNdXp6bGVGbGFzaGVzIikNCg0KLS0gQ2xvbmUgdGhlIG9yaWdpbmFsICJNdXp6bGUgRmxhc2hlcyIgbW9kZWwNCmxvY2FsIGRlZmF1bHRNdXp6bGVGbGFzaCA9IG11enpsZUZsYXNoZXM6RmluZEZpcnN0Q2hpbGQoIkRlZmF1bHQiKQ0KaWYgZGVmYXVsdE11enpsZUZsYXNoIHRoZW4NCiAgICBsb2NhbCBtdXp6bGVGbGFzaE9yaWdpbmFsID0gZGVmYXVsdE11enpsZUZsYXNoOkNsb25lKCkNCiAgICBtdXp6bGVGbGFzaE9yaWdpbmFsLk5hbWUgPSAiTXV6emxlIEZsYXNoIE9yaWdpbmFsIg0KICAgIG11enpsZUZsYXNoT3JpZ2luYWwuUGFyZW50ID0gbXV6emxlRmxhc2hlcw0KZW5kDQoNCi0tIERyb3Bkb3duIGZvciBzZWxlY3RpbmcgTXV6emxlIEZsYXNoDQpsb2NhbCBNdXp6bGVGbGFzaERyb3Bkb3duID0gVGFicy5Nb2RUYWI6QWRkRHJvcGRvd24oIk11enpsZUZsYXNoRHJvcGRvd24iLCB7DQogICAgVGl0bGUgPSAiRmlyZSBFZmZlY3QgW0J1bGxldF0iLA0KICAgIFZhbHVlcyA9IHsNCiAgICAgICAgIk5vbmUiLCAiQXF1YSBCdXJzdCIsICJEZW1vbiBTaG9ydHkiLCANCiAgICAgICAgIkRlbW9uIFV6aSIsICJEeW5hbWl0ZSBHdW4iLCAiRWxlY3RybyBSaWZsZSIsIA0KICAgICAgICAiRXhvZ3VuIiwgIlNpbmd1bGFyaXR5IiwgIldvbmRlcmd1biINCiAgICB9LA0KICAgIE11bHRpID0gZmFsc2UsDQogICAgRGVmYXVsdCA9IDEsDQp9KQ0KDQoNCk11enpsZUZsYXNoRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KICAgIC0tIFJlbW92ZSBhbnkgY3VycmVudCBNdXp6bGUgRmxhc2ggbW9kZWwNCiAgICBsb2NhbCBjdXJyZW50TXV6emxlRmxhc2ggPSBtdXp6bGVGbGFzaGVzOkZpbmRGaXJzdENoaWxkKCJEZWZhdWx0Iikgb3IgbXV6emxlRmxhc2hlczpGaW5kRmlyc3RDaGlsZCgiTXV6emxlIEZsYXNoIE9yaWdpbmFsIikNCiAgICBpZiBjdXJyZW50TXV6emxlRmxhc2ggdGhlbg0KICAgICAgICBjdXJyZW50TXV6emxlRmxhc2g6RGVzdHJveSgpDQogICAgZW5kDQoNCiAgICBpZiBWYWx1ZSB+PSAiTm9uZSIgdGhlbg0KICAgICAgICAtLSBDbG9uZSBzZWxlY3RlZCBNdXp6bGUgRmxhc2ggbW9kZWwNCiAgICAgICAgdGV4dExhYmVscy5iX2VmZmVjdC5WaXNpYmxlID0gdHJ1ZQ0KICAgICAgICBmYWRlVGV4dCh0ZXh0TGFiZWxzLmJfZWZmZWN0LCB0cnVlKQ0KICAgICAgICBhbGlnblRleHRMYWJlbHMoKSANCiAgICAgICAgbG9jYWwgc2VsZWN0ZWRNdXp6bGVGbGFzaCA9IG11enpsZUZsYXNoZXM6RmluZEZpcnN0Q2hpbGQoVmFsdWUpDQogICAgICAgIA0KICAgICAgICBpZiBzZWxlY3RlZE11enpsZUZsYXNoIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGNsb25lZE11enpsZUZsYXNoID0gc2VsZWN0ZWRNdXp6bGVGbGFzaDpDbG9uZSgpDQogICAgICAgICAgICBjbG9uZWRNdXp6bGVGbGFzaC5QYXJlbnQgPSBtdXp6bGVGbGFzaGVzDQogICAgICAgICAgICBjbG9uZWRNdXp6bGVGbGFzaC5OYW1lID0gIkRlZmF1bHQiDQogICAgICAgIGVuZA0KDQogICAgZWxzZQ0KICAgICAgICAtLSBSZXN0b3JlIHRoZSBvcmlnaW5hbCBNdXp6bGUgRmxhc2ggbW9kZWwNCiAgICAgICAgbG9jYWwgb3JpZ2luYWxNdXp6bGVGbGFzaCA9IG11enpsZUZsYXNoZXM6RmluZEZpcnN0Q2hpbGQoIk11enpsZSBGbGFzaCBPcmlnaW5hbCIpDQogICAgICAgIHRleHRMYWJlbHMuYl9lZmZlY3QuVmlzaWJsZSA9IGZhbHNlDQogICAgICAgIGZhZGVUZXh0KHRleHRMYWJlbHMuYl9lZmZlY3QsIGZhbHNlKQ0KICAgICAgICBhbGlnblRleHRMYWJlbHMoKSANCiAgICAgICAgaWYgb3JpZ2luYWxNdXp6bGVGbGFzaCB0aGVuDQogICAgICAgICAgICBsb2NhbCBjbG9uZWRPcmlnaW5hbCA9IG9yaWdpbmFsTXV6emxlRmxhc2g6Q2xvbmUoKQ0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuUGFyZW50ID0gbXV6emxlRmxhc2hlcw0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuTmFtZSA9ICJEZWZhdWx0Ig0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KDQoNCg0KbG9jYWwgbWlzY0Fzc2V0cyA9IHBsYXllci5QbGF5ZXJTY3JpcHRzLkFzc2V0czpXYWl0Rm9yQ2hpbGQoIk1pc2MiKQ0KDQotLSBSZWZlcmVuY2VzIHRvIEJ1cm5pbmdFZmZlY3RzIGFuZCBGaXJlSGl0Ym94ZXMgZm9sZGVycw0KbG9jYWwgYnVybmluZ0VmZmVjdHMgPSBtaXNjQXNzZXRzOldhaXRGb3JDaGlsZCgiQnVybmluZ0VmZmVjdHMiKQ0KbG9jYWwgZmlyZUhpdGJveGVzID0gbWlzY0Fzc2V0czpXYWl0Rm9yQ2hpbGQoIkZpcmVIaXRib3hlcyIpDQoNCi0tIEJhY2t1cCBvcmlnaW5hbCBEZWZhdWx0IG1vZGVscw0KbG9jYWwgYnVybmluZ0VmZmVjdERlZmF1bHQgPSBidXJuaW5nRWZmZWN0czpGaW5kRmlyc3RDaGlsZCgiRGVmYXVsdCIpDQppZiBidXJuaW5nRWZmZWN0RGVmYXVsdCB0aGVuDQogICAgbG9jYWwgYnVybmluZ0VmZmVjdE9yaWdpbmFsID0gYnVybmluZ0VmZmVjdERlZmF1bHQ6Q2xvbmUoKQ0KICAgIGJ1cm5pbmdFZmZlY3RPcmlnaW5hbC5OYW1lID0gIkJ1cm5pbmcgRWZmZWN0IE9yaWdpbmFsIg0KICAgIGJ1cm5pbmdFZmZlY3RPcmlnaW5hbC5QYXJlbnQgPSBidXJuaW5nRWZmZWN0cw0KZW5kDQoNCmxvY2FsIGZpcmVIaXRib3hEZWZhdWx0ID0gZmlyZUhpdGJveGVzOkZpbmRGaXJzdENoaWxkKCJEZWZhdWx0IikNCmlmIGZpcmVIaXRib3hEZWZhdWx0IHRoZW4NCiAgICBsb2NhbCBmaXJlSGl0Ym94T3JpZ2luYWwgPSBmaXJlSGl0Ym94RGVmYXVsdDpDbG9uZSgpDQogICAgZmlyZUhpdGJveE9yaWdpbmFsLk5hbWUgPSAiRmlyZSBIaXRib3ggT3JpZ2luYWwiDQogICAgZmlyZUhpdGJveE9yaWdpbmFsLlBhcmVudCA9IGZpcmVIaXRib3hlcw0KZW5kDQoNCi0tIERyb3Bkb3duIGZvciBzZWxlY3RpbmcgQnVybmluZyBFZmZlY3QgYW5kIEZpcmUgSGl0Ym94DQpsb2NhbCBGaXJlRWZmZWN0RHJvcGRvd24gPSBUYWJzLk1vZFRhYjpBZGREcm9wZG93bigiRmlyZUVmZmVjdERyb3Bkb3duIiwgew0KICAgIFRpdGxlID0gIk1vbHRvdiBGaXJlICIsDQogICAgVmFsdWVzID0gew0KICAgICAgICAiTm9uZSIsICJIZXh4ZWQgQ2FuZGxlIFtQdXJwbGVdIg0KICAgIH0sDQogICAgTXVsdGkgPSBmYWxzZSwNCiAgICBEZWZhdWx0ID0gMSwNCn0pDQoNCg0KRmlyZUVmZmVjdERyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCiAgICAtLSBSZW1vdmUgY3VycmVudCBEZWZhdWx0IG1vZGVscw0KICAgIGxvY2FsIGN1cnJlbnRCdXJuaW5nRWZmZWN0ID0gYnVybmluZ0VmZmVjdHM6RmluZEZpcnN0Q2hpbGQoIkRlZmF1bHQiKSBvciBidXJuaW5nRWZmZWN0czpGaW5kRmlyc3RDaGlsZCgiQnVybmluZyBFZmZlY3QgT3JpZ2luYWwiKQ0KICAgIGxvY2FsIGN1cnJlbnRGaXJlSGl0Ym94ID0gZmlyZUhpdGJveGVzOkZpbmRGaXJzdENoaWxkKCJEZWZhdWx0Iikgb3IgZmlyZUhpdGJveGVzOkZpbmRGaXJzdENoaWxkKCJGaXJlIEhpdGJveCBPcmlnaW5hbCIpDQoNCiAgICBpZiBjdXJyZW50QnVybmluZ0VmZmVjdCB0aGVuDQogICAgICAgIGN1cnJlbnRCdXJuaW5nRWZmZWN0OkRlc3Ryb3koKQ0KICAgIGVuZA0KICAgIGlmIGN1cnJlbnRGaXJlSGl0Ym94IHRoZW4NCiAgICAgICAgY3VycmVudEZpcmVIaXRib3g6RGVzdHJveSgpDQogICAgZW5kDQoNCiAgICBpZiBWYWx1ZSA9PSAiSGV4eGVkIENhbmRsZSIgdGhlbg0KICAgICAgICAtLSBTZXQgSGV4eGVkIENhbmRsZSBtb2RlbHMgYXMgRGVmYXVsdA0KICAgICAgICBsb2NhbCBoZXh4ZWRCdXJuaW5nRWZmZWN0ID0gYnVybmluZ0VmZmVjdHM6RmluZEZpcnN0Q2hpbGQoIkhleHhlZCBDYW5kbGUiKQ0KICAgICAgICBsb2NhbCBoZXh4ZWRGaXJlSGl0Ym94ID0gZmlyZUhpdGJveGVzOkZpbmRGaXJzdENoaWxkKCJIZXh4ZWQgQ2FuZGxlIikNCg0KICAgICAgICBpZiBoZXh4ZWRCdXJuaW5nRWZmZWN0IHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGNsb25lZEJ1cm5pbmdFZmZlY3QgPSBoZXh4ZWRCdXJuaW5nRWZmZWN0OkNsb25lKCkNCiAgICAgICAgICAgIGNsb25lZEJ1cm5pbmdFZmZlY3QuTmFtZSA9ICJEZWZhdWx0Ig0KICAgICAgICAgICAgY2xvbmVkQnVybmluZ0VmZmVjdC5QYXJlbnQgPSBidXJuaW5nRWZmZWN0cw0KICAgICAgICBlbmQNCiAgICAgICAgaWYgaGV4eGVkRmlyZUhpdGJveCB0aGVuDQogICAgICAgICAgICBsb2NhbCBjbG9uZWRGaXJlSGl0Ym94ID0gaGV4eGVkRmlyZUhpdGJveDpDbG9uZSgpDQogICAgICAgICAgICBjbG9uZWRGaXJlSGl0Ym94Lk5hbWUgPSAiRGVmYXVsdCINCiAgICAgICAgICAgIGNsb25lZEZpcmVIaXRib3guUGFyZW50ID0gZmlyZUhpdGJveGVzDQogICAgICAgIGVuZA0KICAgIGVsc2UNCiAgICAgICAgLS0gUmVzdG9yZSB0aGUgb3JpZ2luYWwgRGVmYXVsdCBtb2RlbHMNCiAgICAgICAgbG9jYWwgb3JpZ2luYWxCdXJuaW5nRWZmZWN0ID0gYnVybmluZ0VmZmVjdHM6RmluZEZpcnN0Q2hpbGQoIkJ1cm5pbmcgRWZmZWN0IE9yaWdpbmFsIikNCiAgICAgICAgbG9jYWwgb3JpZ2luYWxGaXJlSGl0Ym94ID0gZmlyZUhpdGJveGVzOkZpbmRGaXJzdENoaWxkKCJGaXJlIEhpdGJveCBPcmlnaW5hbCIpDQoNCiAgICAgICAgaWYgb3JpZ2luYWxCdXJuaW5nRWZmZWN0IHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGNsb25lZE9yaWdpbmFsID0gb3JpZ2luYWxCdXJuaW5nRWZmZWN0OkNsb25lKCkNCiAgICAgICAgICAgIGNsb25lZE9yaWdpbmFsLk5hbWUgPSAiRGVmYXVsdCINCiAgICAgICAgICAgIGNsb25lZE9yaWdpbmFsLlBhcmVudCA9IGJ1cm5pbmdFZmZlY3RzDQogICAgICAgIGVuZA0KICAgICAgICBpZiBvcmlnaW5hbEZpcmVIaXRib3ggdGhlbg0KICAgICAgICAgICAgbG9jYWwgY2xvbmVkT3JpZ2luYWwgPSBvcmlnaW5hbEZpcmVIaXRib3g6Q2xvbmUoKQ0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuTmFtZSA9ICJEZWZhdWx0Ig0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuUGFyZW50ID0gZmlyZUhpdGJveGVzDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kKQ0KDQoNCg0KbG9jYWwgcGxheWVyID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXINCmxvY2FsIG1pc2NBc3NldHMgPSBwbGF5ZXIuUGxheWVyU2NyaXB0cy5Bc3NldHM6V2FpdEZvckNoaWxkKCJMaWdodGluZ1Byb2ZpbGVzIikNCg0KLS0gQmFja3VwIG9yaWdpbmFsIERlZmF1bHQgTGlnaHRpbmcgUHJvZmlsZQ0KbG9jYWwgZGVmYXVsdExpZ2h0aW5nUHJvZmlsZSA9IG1pc2NBc3NldHM6RmluZEZpcnN0Q2hpbGQoIkRlZmF1bHQiKQ0KaWYgZGVmYXVsdExpZ2h0aW5nUHJvZmlsZSB0aGVuDQogICAgbG9jYWwgZGVmYXVsdFByb2ZpbGVPcmlnaW5hbCA9IGRlZmF1bHRMaWdodGluZ1Byb2ZpbGU6Q2xvbmUoKQ0KICAgIGRlZmF1bHRQcm9maWxlT3JpZ2luYWwuTmFtZSA9ICJMaWdodGluZyBQcm9maWxlIE9yaWdpbmFsIg0KICAgIGRlZmF1bHRQcm9maWxlT3JpZ2luYWwuUGFyZW50ID0gbWlzY0Fzc2V0cw0KZW5kDQotLSBDdXN0b20gbmFtZXMgZm9yIGRyb3Bkb3duIG9wdGlvbnMNCmxvY2FsIGxpZ2h0aW5nUHJvZmlsZXMgPSB7DQogICAgTm9uZSA9ICJOb25lIiwNCiAgICBHcmF2ZXlhcmQgPSAiU2NhcnkgTmlnaHRMaWdodCIsDQogICAgR3JhdmV5YXJkTWF0Y2hQb2ludCA9ICJVbmZhaXIiLA0KICAgIExvYmJ5SGFsbG93ZWVuID0gIk9jZW4iLA0KICAgIFN0YXRpb24gPSAiSGVsbGZpcmUiDQp9DQoNCi0tIERyb3Bkb3duIGZvciBzZWxlY3RpbmcgTGlnaHRpbmcgUHJvZmlsZQ0KbG9jYWwgTGlnaHRpbmdQcm9maWxlRHJvcGRvd24gPSBUYWJzLk1vZFRhYjpBZGREcm9wZG93bigiTGlnaHRpbmdQcm9maWxlRHJvcGRvd24iLCB7DQogICAgVGl0bGUgPSAiQXRtb3NwaGVyZSIsDQogICAgVmFsdWVzID0gew0KICAgICAgICBsaWdodGluZ1Byb2ZpbGVzLk5vbmUsIGxpZ2h0aW5nUHJvZmlsZXMuR3JhdmV5YXJkLCBsaWdodGluZ1Byb2ZpbGVzLkdyYXZleWFyZE1hdGNoUG9pbnQsDQogICAgICAgIGxpZ2h0aW5nUHJvZmlsZXMuTG9iYnlIYWxsb3dlZW4sIGxpZ2h0aW5nUHJvZmlsZXMuU3RhdGlvbg0KICAgIH0sDQogICAgTXVsdGkgPSBmYWxzZSwNCiAgICBEZWZhdWx0ID0gMSwNCn0pDQoNCkxpZ2h0aW5nUHJvZmlsZURyb3Bkb3duOlNldFZhbHVlKGxpZ2h0aW5nUHJvZmlsZXMuTm9uZSkNCg0KTGlnaHRpbmdQcm9maWxlRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KICAgIC0tIEZpbmQgdGhlIGNvcnJlc3BvbmRpbmcgTGlnaHRpbmcgUHJvZmlsZSBrZXkNCiAgICBsb2NhbCBzZWxlY3RlZEtleQ0KICAgIGZvciBrZXksIG5hbWUgaW4gcGFpcnMobGlnaHRpbmdQcm9maWxlcykgZG8NCiAgICAgICAgaWYgbmFtZSA9PSBWYWx1ZSB0aGVuDQogICAgICAgICAgICBzZWxlY3RlZEtleSA9IGtleQ0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICAtLSBSZW1vdmUgY3VycmVudCBMaWdodGluZyBQcm9maWxlDQogICAgbG9jYWwgY3VycmVudExpZ2h0aW5nUHJvZmlsZSA9IG1pc2NBc3NldHM6RmluZEZpcnN0Q2hpbGQoIkRlZmF1bHQiKSBvciBtaXNjQXNzZXRzOkZpbmRGaXJzdENoaWxkKCJMaWdodGluZyBQcm9maWxlIE9yaWdpbmFsIikNCiAgICBpZiBjdXJyZW50TGlnaHRpbmdQcm9maWxlIHRoZW4NCiAgICAgICAgY3VycmVudExpZ2h0aW5nUHJvZmlsZTpEZXN0cm95KCkNCiAgICBlbmQNCg0KICAgIC0tIFVwZGF0ZSB2aXNpYmlsaXR5IG9mIGF0bW9zcGhlcmUgbGFiZWwgYmFzZWQgb24gc2VsZWN0aW9uDQogICAgbG9jYWwgc2hvd1RleHQgPSBzZWxlY3RlZEtleSBhbmQgc2VsZWN0ZWRLZXkgfj0gIk5vbmUiDQogICAgdGV4dExhYmVscy5hdG1vc3BoZXJlLlZpc2libGUgPSBzaG93VGV4dA0KICAgIGZhZGVUZXh0KHRleHRMYWJlbHMuYXRtb3NwaGVyZSwgc2hvd1RleHQpDQogICAgYWxpZ25UZXh0TGFiZWxzKCkNCg0KICAgIC0tIEFwcGx5IHRoZSBzZWxlY3RlZCBMaWdodGluZyBQcm9maWxlIG9yIHJlc3RvcmUgb3JpZ2luYWwNCiAgICBpZiBzaG93VGV4dCB0aGVuDQogICAgICAgIC0tIENsb25lIHNlbGVjdGVkIExpZ2h0aW5nIFByb2ZpbGUgbW9kZWwNCiAgICAgICAgbG9jYWwgc2VsZWN0ZWRMaWdodGluZ1Byb2ZpbGUgPSBtaXNjQXNzZXRzOkZpbmRGaXJzdENoaWxkKHNlbGVjdGVkS2V5KQ0KICAgICAgICBpZiBzZWxlY3RlZExpZ2h0aW5nUHJvZmlsZSB0aGVuDQogICAgICAgICAgICBsb2NhbCBjbG9uZWRMaWdodGluZ1Byb2ZpbGUgPSBzZWxlY3RlZExpZ2h0aW5nUHJvZmlsZTpDbG9uZSgpDQogICAgICAgICAgICBjbG9uZWRMaWdodGluZ1Byb2ZpbGUuUGFyZW50ID0gbWlzY0Fzc2V0cw0KICAgICAgICAgICAgY2xvbmVkTGlnaHRpbmdQcm9maWxlLk5hbWUgPSAiRGVmYXVsdCINCiAgICAgICAgZW5kDQogICAgZWxzZQ0KICAgICAgICAtLSBSZXN0b3JlIHRoZSBvcmlnaW5hbCBMaWdodGluZyBQcm9maWxlDQogICAgICAgIGxvY2FsIG9yaWdpbmFsTGlnaHRpbmdQcm9maWxlID0gbWlzY0Fzc2V0czpGaW5kRmlyc3RDaGlsZCgiTGlnaHRpbmcgUHJvZmlsZSBPcmlnaW5hbCIpDQogICAgICAgIGlmIG9yaWdpbmFsTGlnaHRpbmdQcm9maWxlIHRoZW4NCiAgICAgICAgICAgIGxvY2FsIGNsb25lZE9yaWdpbmFsID0gb3JpZ2luYWxMaWdodGluZ1Byb2ZpbGU6Q2xvbmUoKQ0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuUGFyZW50ID0gbWlzY0Fzc2V0cw0KICAgICAgICAgICAgY2xvbmVkT3JpZ2luYWwuTmFtZSA9ICJEZWZhdWx0Ig0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KDQpsb2NhbCBGbHNoQmFuZ09mZlRvZ2dsZSA9IFRhYnMuRXNzZW50aWFsOkFkZFRvZ2dsZSgiRmxzaEJhbmdPZmZUb2dnbGUiLCB7VGl0bGUgPSAiSGlkZSBGbGFzaCIsIERlc2NyaXB0aW9uID0gIkhpZGUgZmxhc2hiYW5nIGluIGdhbWUuIiwgRGVmYXVsdCA9IGZhbHNlIH0pDQpsb2NhbCBoYXNCZWVuVG9nZ2xlZE9uID0gZmFsc2UNCg0KRmxzaEJhbmdPZmZUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCiAgICBpZiBPcHRpb25zLkZsc2hCYW5nT2ZmVG9nZ2xlLlZhbHVlIHRoZW4NCiAgICAgICAgLS0gVG9nZ2xlIHR1cm5lZCBvbjogUmVtb3ZlIHRoZSBGbGFzaGJhbmdFZmZlY3QgYW5kIG1hcmsgYXMgdG9nZ2xlZCBvbg0KICAgICAgICBoYXNCZWVuVG9nZ2xlZE9uID0gdHJ1ZQ0KICAgICAgICBsb2NhbCBwbGF5ZXIgPSBnYW1lWyJQbGF5ZXJzIC0gQ2xpZW50Il0uTG9jYWxQbGF5ZXINCiAgICAgICAgbG9jYWwgZmxhc2hiYW5nRWZmZWN0ID0gcGxheWVyLlBsYXllclNjcmlwdHMuQXNzZXRzLk1pc2M6RmluZEZpcnN0Q2hpbGQoIkZsYXNoYmFuZ0VmZmVjdCIpDQogICAgICAgIGlmIGZsYXNoYmFuZ0VmZmVjdCB0aGVuDQogICAgICAgICAgICBmbGFzaGJhbmdFZmZlY3Q6RGVzdHJveSgpDQogICAgICAgIGVuZA0KICAgIGVsc2UNCiAgICAgICAgLS0gVG9nZ2xlIHR1cm5lZCBvZmYgYWZ0ZXIgYmVpbmcgdHVybmVkIG9uOiBTaG93IGRpYWxvZw0KICAgICAgICBpZiBoYXNCZWVuVG9nZ2xlZE9uIHRoZW4NCiAgICAgICAgICAgIFdpbmRvdzpEaWFsb2coew0KICAgICAgICAgICAgICAgIFRpdGxlID0gIldhcm5pbmciLA0KICAgICAgICAgICAgICAgIENvbnRlbnQgPSAiVG8gZ2V0IHRoZSBmbGFzaGJhbmcgd29ya2luZyBhZ2FpbiwgcmVqb2luIHRoZSBnYW1lLiBBbmQgYWxzbyBzYXZlIHRoZSBjb25maWcgaWYgeW91cmUgdXNpbmcgYXV0b2xvYWQuIiwNCiAgICAgICAgICAgICAgICBCdXR0b25zID0gew0KICAgICAgICAgICAgICAgICAgICB7DQogICAgICAgICAgICAgICAgICAgICAgICBUaXRsZSA9ICJDb25maXJtIiwNCiAgICAgICAgICAgICAgICAgICAgICAgIENhbGxiYWNrID0gZnVuY3Rpb24oKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHByaW50KCJvay4iKQ0KICAgICAgICAgICAgICAgICAgICAgICAgZW5kDQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9KQ0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KDQoNCi0tIEltcG9ydCBSdW5TZXJ2aWNlIGZvciB0aGUgbW92aW5nIGFuZCBwdWxzaW5nIGVmZmVjdHMNCmxvY2FsIFJ1blNlcnZpY2UgPSBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKQ0KDQpUYWJzLk1vZFRhYjpBZGRCdXR0b24oew0KICAgIFRpdGxlID0gIkFwcGx5IFN0YXRpYyBDb2xvciIsDQogICAgRGVzY3JpcHRpb24gPSAiQXBwbGllcyBhIHJhbmRvbSBjb2xvciB3ZWFwb24uIiwNCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkNCiAgICAgICAgLS0gQWNjZXNzIHRoZSBGaXJzdFBlcnNvbiBtb2RlbA0KICAgICAgICBsb2NhbCBmaXJzdFBlcnNvbiA9IFdvcmtzcGFjZS5WaWV3TW9kZWxzLkZpcnN0UGVyc29uDQoNCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gZ2VuZXJhdGUgYSByYW5kb20gY29sb3INCiAgICAgICAgbG9jYWwgZnVuY3Rpb24gZ2V0UmFuZG9tQ29sb3IoKQ0KICAgICAgICAgICAgcmV0dXJuIENvbG9yMy5uZXcobWF0aC5yYW5kb20oKSwgbWF0aC5yYW5kb20oKSwgbWF0aC5yYW5kb20oKSkNCiAgICAgICAgZW5kDQoNCiAgICAgICAgLS0gTG9vcCB0aHJvdWdoIGFsbCBkZXNjZW5kYW50cyBpbiB0aGUgRmlyc3RQZXJzb24gbW9kZWwNCiAgICAgICAgZm9yIF8sIGRlc2NlbmRhbnQgaW4gaXBhaXJzKGZpcnN0UGVyc29uOkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgICAgICAtLSBDaGVjayBpZiB0aGUgZGVzY2VuZGFudCBpcyBhIE1vZGVsIGFuZCBjb250YWlucyBhIEJvZHkgcGFydA0KICAgICAgICAgICAgaWYgZGVzY2VuZGFudDpJc0EoIk1vZGVsIikgYW5kIGRlc2NlbmRhbnQ6RmluZEZpcnN0Q2hpbGQoIkl0ZW1WaXN1YWwiKSB0aGVuDQogICAgICAgICAgICAgICAgbG9jYWwgYm9keSA9IGRlc2NlbmRhbnQuSXRlbVZpc3VhbC5Cb2R5DQogICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdGhlIEJvZHkgcGFydCBleGlzdHMNCiAgICAgICAgICAgICAgICBpZiBib2R5IHRoZW4NCiAgICAgICAgICAgICAgICAgICAgLS0gTG9vcCB0aHJvdWdoIGFsbCBjaGlsZHJlbiBpbiB0aGUgQm9keSBtb2RlbA0KICAgICAgICAgICAgICAgICAgICBmb3IgXywgcGFydCBpbiBpcGFpcnMoYm9keTpHZXRDaGlsZHJlbigpKSBkbw0KICAgICAgICAgICAgICAgICAgICAgICAgLS0gQ2hlY2sgaWYgdGhlIGNoaWxkIGlzIGEgTWVzaFBhcnQNCiAgICAgICAgICAgICAgICAgICAgICAgIGlmIHBhcnQ6SXNBKCJNZXNoUGFydCIpIHRoZW4NCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAtLSBBc3NpZ24gYSByYW5kb20gY29sb3IgdG8gdGhlIE1lc2hQYXJ0DQogICAgICAgICAgICAgICAgICAgICAgICAgICAgcGFydC5Db2xvciA9IGdldFJhbmRvbUNvbG9yKCkNCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCn0pDQoNCg0KVGFicy5Nb2RUYWI6QWRkQnV0dG9uKHsNCiAgICBUaXRsZSA9ICJBbmltYXRlZCBNYXRlcmlhbCBXZWFwb24iLA0KICAgIERlc2NyaXB0aW9uID0gIkFkZHMgYW5pbWF0ZWQgZWZmZWN0cyB0byB3ZWFwb24uIiwNCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKCkNCiAgICAgICAgLS0gQWNjZXNzIHRoZSBGaXJzdFBlcnNvbiBtb2RlbA0KICAgICAgICBsb2NhbCBmaXJzdFBlcnNvbiA9IFdvcmtzcGFjZS5WaWV3TW9kZWxzLkZpcnN0UGVyc29uDQoNCiAgICAgICAgLS0gVGFibGUgdG8gc3RvcmUgcGFydHMgZm9yIGNvbnRpbnVvdXMgZWZmZWN0cw0KICAgICAgICBsb2NhbCBhbmltYXRlZFBhcnRzID0ge30NCg0KICAgICAgICAtLSBMb29wIHRocm91Z2ggYWxsIGRlc2NlbmRhbnRzIGluIHRoZSBGaXJzdFBlcnNvbiBtb2RlbA0KICAgICAgICBmb3IgXywgZGVzY2VuZGFudCBpbiBpcGFpcnMoZmlyc3RQZXJzb246R2V0RGVzY2VuZGFudHMoKSkgZG8NCiAgICAgICAgICAgIC0tIENoZWNrIGlmIHRoZSBkZXNjZW5kYW50IGlzIGEgTW9kZWwgYW5kIGNvbnRhaW5zIGEgQm9keSBwYXJ0DQogICAgICAgICAgICBpZiBkZXNjZW5kYW50OklzQSgiTW9kZWwiKSBhbmQgZGVzY2VuZGFudDpGaW5kRmlyc3RDaGlsZCgiSXRlbVZpc3VhbCIpIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCBib2R5ID0gZGVzY2VuZGFudC5JdGVtVmlzdWFsLkJvZHkNCiAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0aGUgQm9keSBwYXJ0IGV4aXN0cw0KICAgICAgICAgICAgICAgIGlmIGJvZHkgdGhlbg0KICAgICAgICAgICAgICAgICAgICAtLSBMb29wIHRocm91Z2ggYWxsIGNoaWxkcmVuIGluIHRoZSBCb2R5IG1vZGVsDQogICAgICAgICAgICAgICAgICAgIGZvciBfLCBwYXJ0IGluIGlwYWlycyhib2R5OkdldENoaWxkcmVuKCkpIGRvDQogICAgICAgICAgICAgICAgICAgICAgICAtLSBDaGVjayBpZiB0aGUgY2hpbGQgaXMgYSBNZXNoUGFydA0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgcGFydDpJc0EoIk1lc2hQYXJ0IikgdGhlbg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC0tIFNldCBpbml0aWFsIHByb3BlcnRpZXMgZm9yIHNlbWktdHJhbnNwYXJlbnQgbG9vaw0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhcnQuVHJhbnNwYXJlbmN5ID0gMC40ICAtLSBTdGFydCB0cmFuc3BhcmVuY3kgaW4gdGhlIG1pZGRsZSBvZiB0aGUgcHVsc2UgcmFuZ2UNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0YWJsZS5pbnNlcnQoYW5pbWF0ZWRQYXJ0cywgcGFydCkgIC0tIFN0b3JlIGZvciBhbmltYXRpb24NCiAgICAgICAgICAgICAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgICAgICBlbmQNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCg0KICAgICAgICAtLSBGdW5jdGlvbiBmb3IgY29sb3IgY3ljbGluZw0KICAgICAgICBsb2NhbCBmdW5jdGlvbiBnZXRDb2xvckN5Y2xlKHQpDQogICAgICAgICAgICByZXR1cm4gQ29sb3IzLmZyb21IU1YoKHQgJSAxKSwgMC41LCAxKQ0KICAgICAgICBlbmQNCg0KICAgICAgICAtLSBSdW4gYW5pbWF0aW9uIHdpdGggaGVhcnRiZWF0DQogICAgICAgIFJ1blNlcnZpY2UuSGVhcnRiZWF0OkNvbm5lY3QoZnVuY3Rpb24oZGVsdGFUaW1lKQ0KICAgICAgICAgICAgbG9jYWwgdGltZSA9IHRpY2soKQ0KICAgICAgICAgICAgZm9yIF8sIHBhcnQgaW4gaXBhaXJzKGFuaW1hdGVkUGFydHMpIGRvDQogICAgICAgICAgICAgICAgLS0gQ29sb3IgY3ljbGluZyBlZmZlY3QNCiAgICAgICAgICAgICAgICBwYXJ0LkNvbG9yID0gZ2V0Q29sb3JDeWNsZSh0aW1lICogMC41KQ0KDQogICAgICAgICAgICAgICAgLS0gUHVsc2luZyB0cmFuc3BhcmVuY3kgZWZmZWN0IGJldHdlZW4gMC4zIGFuZCAwLjUNCiAgICAgICAgICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAuNCArIDAuMSAqIG1hdGguc2luKHRpbWUgKiAyKQ0KDQogICAgICAgICAgICAgICAgLS0gU2xvdyByb3RhdGlvbg0KICAgICAgICAgICAgICAgIHBhcnQuQ0ZyYW1lID0gcGFydC5DRnJhbWUgKiBDRnJhbWUuQW5nbGVzKDAsIG1hdGgucmFkKDEpLCAwKQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZCkNCiAgICBlbmQNCn0pDQoNCmxvY2FsIFJlc29sdXRpb25TbGlkZXIgPSBUYWJzLk1vZFRhYjpBZGRTbGlkZXIoIlJlc29sdXRpb25TbGlkZXIiLCB7DQogICAgVGl0bGUgPSAiUmVzb2x1dGlvbiBTbGlkZXIiLA0KICAgIERlc2NyaXB0aW9uID0gIkFkanVzdCB0aGUgcmVzb2x1dGlvbiB2YWx1ZSIsDQogICAgRGVmYXVsdCA9IDEwMCwgIC0tIERlZmF1bHQgdG8gMTAwIHdoaWNoIHJlcHJlc2VudHMgMQ0KICAgIE1pbiA9IDEwLCAgICAgIC0tIE1pbmltdW0gdmFsdWUgaXMgMTAgd2hpY2ggcmVwcmVzZW50cyAwLjENCiAgICBNYXggPSAxNDAsICAgICAtLSBNYXhpbXVtIHZhbHVlIGlzIDEwMCB3aGljaCByZXByZXNlbnRzIDENCiAgICBSb3VuZGluZyA9IDEsICAtLSBSb3VuZGluZyBpcyBzZXQgdG8gMSB0byBoYW5kbGUgdGhlIGludGVnZXIgcmVwcmVzZW50YXRpb24NCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQ0KICAgICAgICAtLSBDb252ZXJ0IHRoZSBzbGlkZXIgdmFsdWUgdG8gdGhlIGNvcnJlc3BvbmRpbmcgcmVzb2x1dGlvbiB2YWx1ZQ0KICAgICAgICBsb2NhbCByb3VuZGVkVmFsdWUgPSBtYXRoLmZsb29yKFZhbHVlIC8gMSArIDAuNSkgIC0tIFJvdW5kIHRvIHRoZSBuZWFyZXN0IGludGVnZXINCiAgICAgICAgZ2V0Z2VudigpLlJlc29sdXRpb25WYWx1ZSA9IHJvdW5kZWRWYWx1ZSAvIDEwMCANCiAgICBlbmQNCn0pDQoNCmxvY2FsIENhbWVyYSA9IFdvcmtzcGFjZS5DdXJyZW50Q2FtZXJhDQppZiBnZXRnZW52KCkuQ2FtZXJhTW9kaWZpZXIgPT0gbmlsIHRoZW4NCiAgICBnYW1lOkdldFNlcnZpY2UoIlJ1blNlcnZpY2UiKS5SZW5kZXJTdGVwcGVkOkNvbm5lY3QoDQogICAgICAgIGZ1bmN0aW9uKCkNCiAgICAgICAgICAgIENhbWVyYS5DRnJhbWUgPSBDYW1lcmEuQ0ZyYW1lICogQ0ZyYW1lLm5ldygwLCAwLCAwLCAxLCAwLCAwLCAwLCBnZXRnZW52KCkuUmVzb2x1dGlvblZhbHVlLCAwLCAwLCAwLCAxKQ0KICAgICAgICBlbmQNCiAgICApDQplbmQNCmdldGdlbnYoKS5DYW1lcmFNb2RpZmllciA9IHRydWUNCg0KDQoNCmxvY2FsIFRvZ2dsZSA9IFRhYnMuTW9kVGFiOkFkZFRvZ2dsZSgiSGl0TWFya2VyMSIsIHtUaXRsZSA9ICJTaG93IEhpdG1hcmtlciIsIERlc2NyaXB0aW9uID0gIlNob3cgbWFyayB3aGVyZSBidWxsZXQgaGl0cy4iLCBEZWZhdWx0ID0gZmFsc2V9KQ0KDQpUb2dnbGU6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBwYXJ0ID0gZ2FtZTpHZXRTZXJ2aWNlKCJQbGF5ZXJzIikuTG9jYWxQbGF5ZXIuUGxheWVyU2NyaXB0cy5Bc3NldHMuTWlzYy5JbXBhY3RNYXJrZXJCdWxsZXQNCg0KICAgIGlmIHBhcnQgdGhlbg0KICAgICAgICBpZiBUb2dnbGUuVmFsdWUgdGhlbg0KICAgICAgICAgICAgcGFydC5Db2xvciA9IENvbG9ycGlja2VyLlZhbHVlDQogICAgICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDAgIC0tIE1ha2UgaXQgZnVsbHkgdmlzaWJsZQ0KICAgICAgICBlbHNlDQogICAgICAgICAgICBwYXJ0LlRyYW5zcGFyZW5jeSA9IDENCiAgICAgICAgZW5kDQogICAgICAgIA0KICAgIGVsc2UgDQoNCiAgICBlbmQNCg0KICAgIGlmIHRleHRMYWJlbHMgYW5kIHRleHRMYWJlbHMudGV4dExhYmVsNSB0aGVuDQogICAgICAgIHRleHRMYWJlbHMudGV4dExhYmVsNS5WaXNpYmxlID0gVG9nZ2xlLlZhbHVlDQogICAgICAgIGZhZGVUZXh0KHRleHRMYWJlbHMudGV4dExhYmVsNSwgVG9nZ2xlLlZhbHVlKQ0KICAgICAgICBhbGlnblRleHRMYWJlbHMoKQ0KICAgIGVuZA0KZW5kKQ0KDQoNCmxvY2FsIElucHV0ID0gVGFicy5Nb2RUYWI6QWRkSW5wdXQoIkhpdE1hcmtJbnB1dCIsIHsNCiAgICBUaXRsZSA9ICJIaXQgTWFya2FyIiwNCiAgICBEZXNjcmlwdGlvbiA9ICJMZWF2ZSBpdCBlbXB0eSB0byBoaWRlIHRoZSBtYXJrZXIuIiwNCiAgICBEZWZhdWx0ID0gInJieGFzc2V0aWQ6Ly8xMzg2MjY3MDA3NyIsDQogICAgUGxhY2Vob2xkZXIgPSAicmJ4YXNzZXRpZDovLzg5MDI0NjIxNjk3ODgzIiwNCiAgICBOdW1lcmljID0gZmFsc2UsIC0tIEFsbG93cyBub24tbnVtZXJpYyB2YWx1ZXMNCiAgICBGaW5pc2hlZCA9IGZhbHNlLCAtLSBDYWxscyBjYWxsYmFjayBldmVyeSB0aW1lIHRoZSB2YWx1ZSBjaGFuZ2VzDQogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbihWYWx1ZSkNCiAgICAgICAgLS0gQWNjZXNzIFBsYXllcnMgLSBDbGllbnQgYW5kIHVwZGF0ZSB0aGUgdGV4dHVyZSBkaXJlY3RseSBpbiBJbXBhY3RNYXJrZXJCdWxsZXQuRGVjYWwNCiAgICAgICAgZ2FtZVsiUGxheWVycyAtIENsaWVudCJdLkxvY2FsUGxheWVyLlBsYXllclNjcmlwdHMuQXNzZXRzLk1pc2MuSW1wYWN0TWFya2VyQnVsbGV0LkRlY2FsLlRleHR1cmUgPSBWYWx1ZQ0KICAgIGVuZA0KfSkNCg0KSW5wdXQ6T25DaGFuZ2VkKGZ1bmN0aW9uKCkNCmVuZCkNCg0KDQpsb2NhbCBDb2xvcnBpY2tlciA9IFRhYnMuTW9kVGFiOkFkZENvbG9ycGlja2VyKCJIaXRNYXJrZXJDb2xvciIsIHsNCiAgICBUaXRsZSA9ICJDaG9vc2UgaGl0bWFya2VyIiwNCiAgICBEZWZhdWx0ID0gQ29sb3IzLmZyb21SR0IoMjU1LCAyNTUsIDI1NSkNCn0pDQoNCg0KDQpDb2xvcnBpY2tlcjpPbkNoYW5nZWQoZnVuY3Rpb24oKQ0KICAgIGxvY2FsIHBhcnQgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKS5Mb2NhbFBsYXllci5QbGF5ZXJTY3JpcHRzLkFzc2V0cy5NaXNjLkltcGFjdE1hcmtlckJ1bGxldA0KICAgIA0KICAgIC0tIENoZWNrIGlmIHRoZSBwYXJ0IGV4aXN0cyBiZWZvcmUgY2hhbmdpbmcgdGhlIGNvbG9yDQogICAgaWYgcGFydCBhbmQgVG9nZ2xlLlZhbHVlIHRoZW4NCiAgICAgICAgLS0gQ2hhbmdlIHRoZSBjb2xvciBvZiB0aGUgcGFydCB0byB0aGUgc2VsZWN0ZWQgY29sb3IgaWYgdGhlIHRvZ2dsZSBpcyBvbg0KICAgICAgICBwYXJ0LkNvbG9yID0gQ29sb3JwaWNrZXIuVmFsdWUNCiAgICBlbmQNCmVuZCkNClRhYnMuRXNzZW50aWFsOkFkZEJ1dHRvbih7DQogICAgVGl0bGUgPSAiTmlnaHRUaW1lIiwNCiAgICBEZXNjcmlwdGlvbiA9ICJUaGVyZXMgbm8gdG9nZ2xlIENhdXNlIHRoZSB0aW1lIHZhciBpcyBkeW5hbWljLiIsDQogICAgQ2FsbGJhY2sgPSBmdW5jdGlvbigpDQogICAgICAgIGxvY2FsIExpZ2h0aW5nID0gZ2FtZTpHZXRTZXJ2aWNlKCJMaWdodGluZyIpDQoNCiAgICAgICAgLS0gU2V0IHRoZSBnYW1lIHRvIG5pZ2h0dGltZQ0KICAgICAgICBMaWdodGluZy5DbG9ja1RpbWUgPSAwICAtLSAwIHJlcHJlc2VudHMgbWlkbmlnaHQNCiAgICAgICAgTGlnaHRpbmcuQnJpZ2h0bmVzcyA9IDIgIC0tIEFkanVzdCBicmlnaHRuZXNzIHRvIHN1aXQgeW91ciBuZWVkcw0KICAgICAgICBMaWdodGluZy5PdXRkb29yQW1iaWVudCA9IENvbG9yMy5mcm9tUkdCKDAsIDAsIDApICAtLSBEYXJrZW5zIG91dGRvb3IgYW1iaWVudCBsaWdodA0KICAgICAgICBMaWdodGluZy5BbWJpZW50ID0gQ29sb3IzLmZyb21SR0IoMzAsIDMwLCAzMCkgIC0tIFNldHMgYSBkaW1tZXIgYW1iaWVudCBsaWdodCBmb3IgdGhlIHNjZW5lDQogICAgICAgIExpZ2h0aW5nLkZvZ0NvbG9yID0gQ29sb3IzLmZyb21SR0IoMCwgMCwgMCkgIC0tIE9wdGlvbmFsOiBBZGRzIGZvZyBlZmZlY3QgZm9yIGEgbW9yZSBpbW1lcnNpdmUgbG9vaw0KICAgICAgICBMaWdodGluZy5Gb2dTdGFydCA9IDAgIC0tIE9wdGlvbmFsOiBDb250cm9scyBob3cgc29vbiB0aGUgZm9nIHN0YXJ0cw0KICAgICAgICBMaWdodGluZy5Gb2dFbmQgPSAxMDAwICAtLSBPcHRpb25hbDogQ29udHJvbHMgaG93IGZhciB0aGUgZm9nIHN0cmV0Y2hlcw0KDQogICAgICAgIC0tIE9wdGlvbmFsOiBTZXQgYSBtb29uIHRleHR1cmUgZm9yIGEgbW9yZSByZWFsaXN0aWMgZWZmZWN0DQogICAgICAgIExpZ2h0aW5nLk1vb25UZXh0dXJlSWQgPSAicmJ4YXNzZXRpZDovLzI5MjUxMjA3MzciICAtLSBSZXBsYWNlIHdpdGggYSBtb29uIHRleHR1cmUgYXNzZXQgSUQNCiAgICBlbmQNCn0pDQoNCi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tTmFkZXMtLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0NCi0tIFN0b3JlIHRoZSBjdXJyZW50IEVTUCBkaXNwbGF5IG1vZGUNCmxvY2FsIGVzcE1vZGUgPSAiQm90aCIgIC0tIERlZmF1bHQgdG8gIkJvdGgiDQpsb2NhbCBtYXhEaXN0YW5jZSA9IDMwMCAgLS0gTWF4aW11bSBkaXN0YW5jZSBmb3IgRVNQDQoNCi0tIEZ1bmN0aW9uIHRvIGNyZWF0ZSBFU1Agd2l0aCBvcHRpb25hbCBpbWFnZSBhbmQgdGV4dA0KbG9jYWwgZnVuY3Rpb24gY3JlYXRlVGV4dEVTUChncmVuYWRlLCBwbGF5ZXJQb3NpdGlvbikNCiAgICBsb2NhbCBtZXNoUGFydCA9IGdyZW5hZGU6RmluZEZpcnN0Q2hpbGRPZkNsYXNzKCJNZXNoUGFydCIpDQogICAgaWYgbWVzaFBhcnQgdGhlbg0KICAgICAgICAtLSBDYWxjdWxhdGUgdGhlIGRpc3RhbmNlIGZyb20gdGhlIHBsYXllciB0byB0aGUgZ3JlbmFkZQ0KICAgICAgICBsb2NhbCBkaXN0YW5jZSA9IChtZXNoUGFydC5Qb3NpdGlvbiAtIHBsYXllclBvc2l0aW9uKS5NYWduaXR1ZGUNCg0KICAgICAgICAtLSBPbmx5IGNyZWF0ZSBFU1AgaWYgd2l0aGluIG1heCBkaXN0YW5jZQ0KICAgICAgICBpZiBkaXN0YW5jZSA8PSBtYXhEaXN0YW5jZSB0aGVuDQogICAgICAgICAgICAtLSBDcmVhdGUgYSBCaWxsYm9hcmRHdWkgZm9yIHRoZSBFU1ANCiAgICAgICAgICAgIGxvY2FsIGJpbGxib2FyZEd1aSA9IEluc3RhbmNlLm5ldygiQmlsbGJvYXJkR3VpIikNCiAgICAgICAgICAgIGJpbGxib2FyZEd1aS5BZG9ybmVlID0gbWVzaFBhcnQNCiAgICAgICAgICAgIGJpbGxib2FyZEd1aS5QYXJlbnQgPSBnYW1lLkNvcmVHdWkNCiAgICAgICAgICAgIGJpbGxib2FyZEd1aS5TaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMTAwKQ0KICAgICAgICAgICAgYmlsbGJvYXJkR3VpLlN0dWRzT2Zmc2V0ID0gVmVjdG9yMy5uZXcoMCwgMywgMCkNCiAgICAgICAgICAgIGJpbGxib2FyZEd1aS5BbHdheXNPblRvcCA9IHRydWUNCg0KICAgICAgICAgICAgLS0gQ29uZGl0aW9uYWxseSBhZGQgdGhlIGltYWdlDQogICAgICAgICAgICBpZiBlc3BNb2RlID09ICJJbWFnZSIgb3IgZXNwTW9kZSA9PSAiQm90aCIgdGhlbg0KICAgICAgICAgICAgICAgIGxvY2FsIGltYWdlTGFiZWwgPSBJbnN0YW5jZS5uZXcoIkltYWdlTGFiZWwiKQ0KICAgICAgICAgICAgICAgIGltYWdlTGFiZWwuUGFyZW50ID0gYmlsbGJvYXJkR3VpDQogICAgICAgICAgICAgICAgaW1hZ2VMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDIwLCAwLCAyMCkNCiAgICAgICAgICAgICAgICBpbWFnZUxhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTEwLCAwLjUsIC0xMCkNCiAgICAgICAgICAgICAgICBpbWFnZUxhYmVsLkltYWdlID0gInJieGFzc2V0aWQ6Ly84MjYzMzgyNDExNzQxMSINCiAgICAgICAgICAgICAgICBpbWFnZUxhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxDQogICAgICAgICAgICBlbmQNCg0KICAgICAgICAgICAgLS0gQ29uZGl0aW9uYWxseSBhZGQgdGhlIHRleHQNCiAgICAgICAgICAgIGlmIGVzcE1vZGUgPT0gIlRleHQiIG9yIGVzcE1vZGUgPT0gIkJvdGgiIHRoZW4NCiAgICAgICAgICAgICAgICBsb2NhbCB0ZXh0TGFiZWwgPSBJbnN0YW5jZS5uZXcoIlRleHRMYWJlbCIpDQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlBhcmVudCA9IGJpbGxib2FyZEd1aQ0KICAgICAgICAgICAgICAgIHRleHRMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDEwMCwgMCwgMjApDQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTUwLCAwLjUsIDE1KQ0KICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0ID0gIkdyZW5hZGUiDQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRDb2xvcjMgPSBDb2xvcjMuZnJvbUhleCgiIzA0MWYyNCIpDQogICAgICAgICAgICAgICAgdGV4dExhYmVsLkZvbnQgPSBFbnVtLkZvbnQuR290aGFtQm9sZA0KICAgICAgICAgICAgICAgIHRleHRMYWJlbC5UZXh0U2l6ZSA9IDE0DQogICAgICAgICAgICAgICAgdGV4dExhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxDQogICAgICAgICAgICAgICAgdGV4dExhYmVsLlRleHRTdHJva2VUcmFuc3BhcmVuY3kgPSAwLjgNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZA0KDQotLSBGdW5jdGlvbiB0byBoYW5kbGUgZ3JlbmFkZXMgYWRkZWQgdG8gdGhlIHdvcmtzcGFjZQ0KbG9jYWwgZnVuY3Rpb24gb25HcmVuYWRlQWRkZWQoZ3JlbmFkZSkNCg0KICAgIGxvY2FsIHBsYXllciA9IGdhbWUuUGxheWVycy5Mb2NhbFBsYXllcg0KICAgIGlmIGdyZW5hZGUuTmFtZSA9PSAiR3JlbmFkZSIgYW5kIHBsYXllciB0aGVuDQogICAgICAgIGNyZWF0ZVRleHRFU1AoZ3JlbmFkZSwgcGxheWVyLkNoYXJhY3Rlci5QcmltYXJ5UGFydC5Qb3NpdGlvbikNCiAgICBlbmQNCmVuZA0KDQotLSBEcm9wZG93biBsb2dpYyB0byBjb250cm9sIEVTUCBtb2RlDQpsb2NhbCBEcm9wZG93biA9IFRhYnMuRXNzZW50aWFsOkFkZERyb3Bkb3duKCJEcm9wZG93biIsIHsNCiAgICBUaXRsZSA9ICJHcmVlbmFkZSBFU1AiLA0KICAgIFZhbHVlcyA9IHsiSW1hZ2UiLCAiVGV4dCIsICJCb3RoIiwgIk5vbmUifSwNCiAgICBNdWx0aSA9IGZhbHNlLA0KICAgIERlZmF1bHQgPSAzLCAgLS0gRGVmYXVsdCB0byAiQm90aCINCn0pDQoNCkRyb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCiAgICBlc3BNb2RlID0gVmFsdWUNCiAgICBwcmludCgiRVNQIG1vZGUgY2hhbmdlZCB0bzoiLCBlc3BNb2RlKQ0KDQogICAgLS0gUmVmcmVzaCBhbGwgZXhpc3RpbmcgRVNQcyBiYXNlZCBvbiB0aGUgbmV3IG1vZGUNCiAgICBmb3IgXywgZ3JlbmFkZSBpbiBwYWlycyh3b3Jrc3BhY2U6R2V0Q2hpbGRyZW4oKSkgZG8NCiAgICAgICAgaWYgZ3JlbmFkZS5OYW1lID09ICJHcmVuYWRlIiB0aGVuDQogICAgICAgICAgICBvbkdyZW5hZGVBZGRlZChncmVuYWRlKQ0KICAgICAgICBlbmQNCiAgICBlbmQNCmVuZCkNCg0KLS0gQ29ubmVjdCB0byB0aGUgd29ya3NwYWNlJ3MgQ2hpbGRBZGRlZCBldmVudA0Kd29ya3NwYWNlLkNoaWxkQWRkZWQ6Q29ubmVjdChmdW5jdGlvbihjaGlsZCkNCiAgICBpZiBjaGlsZC5OYW1lID09ICJHcmVuYWRlIiB0aGVuDQogICAgICAgIG9uR3JlbmFkZUFkZGVkKGNoaWxkKQ0KICAgIGVuZA0KZW5kKQ0KDQotLSBJbml0aWFsaXplIGV4aXN0aW5nIGdyZW5hZGVzIGluIHRoZSB3b3Jrc3BhY2UNCmZvciBfLCBncmVuYWRlIGluIHBhaXJzKHdvcmtzcGFjZTpHZXRDaGlsZHJlbigpKSBkbw0KICAgIGlmIGdyZW5hZGUuTmFtZSA9PSAiR3JlbmFkZSIgdGhlbg0KICAgICAgICBvbkdyZW5hZGVBZGRlZChncmVuYWRlKQ0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIFBsYXllcnMgPSBnYW1lOkdldFNlcnZpY2UoIlBsYXllcnMiKQ0KbG9jYWwgcGxheWVyID0gUGxheWVycy5Mb2NhbFBsYXllcg0KDQotLSBDcmVhdGUgYSB0b2dnbGUgZm9yIGNvbnRyb2xsaW5nIHRoZSBTcG90bGlnaHQNCmxvY2FsIFNwb3RMaWdodFRvZ2dsZSA9IFRhYnMuRXNzZW50aWFsOkFkZFRvZ2dsZSgiU3BvdExpZ2h0VG9nZ2xlIiwge1RpdGxlID0gIkdsb3cgTGlnaHQiLERlc2NyaXB0aW9uID0gIkFkZCBsaWdodGluZyB0byB5b3UiLCBEZWZhdWx0ID0gZmFsc2V9KQ0KDQotLSBDcmVhdGUgYSBzbGlkZXIgZm9yIGNvbnRyb2xsaW5nIHRoZSBSYW5nZSBvZiB0aGUgZ2xvdyBsaWdodCB1bmRlciBUYWJzLkVzc2VudGlhbA0KbG9jYWwgUmFuZ2VTbGlkZXIgPSBUYWJzLkVzc2VudGlhbDpBZGRTbGlkZXIoIlJhbmdlU2xpZGVyIiwgeyANCiAgICBUaXRsZSA9ICJHbG93IFJhbmdlIiwNCiAgICBEZXNjcmlwdGlvbiA9ICJBZGp1c3QgdGhlIHJhbmdlIG9mIHRoZSBnbG93IiwNCiAgICBEZWZhdWx0ID0gMzUsIA0KICAgIE1pbiA9IDAsDQogICAgTWF4ID0gMTAwMCwgDQogICAgUm91bmRpbmcgPSAxLA0KICAgIENhbGxiYWNrID0gZnVuY3Rpb24oVmFsdWUpDQogICAgICAgIGlmIHBsYXllci5DaGFyYWN0ZXIgdGhlbg0KICAgICAgICAgICAgLS0gVXBkYXRlIHRoZSByYW5nZSBvZiB0aGUgZ2xvdyBsaWdodA0KICAgICAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyLkhlYWQ6RmluZEZpcnN0Q2hpbGQoIkdsb3dMaWdodCIpIHRoZW4NCiAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuR2xvd0xpZ2h0LlJhbmdlID0gVmFsdWUNCiAgICAgICAgICAgIGVuZA0KICAgICAgICBlbmQNCiAgICBlbmQNCn0pDQoNCi0tIENyZWF0ZSBhIHNsaWRlciBmb3IgY29udHJvbGxpbmcgdGhlIEJyaWdodG5lc3Mgb2YgdGhlIGdsb3cgbGlnaHQgdW5kZXIgVGFicy5Fc3NlbnRpYWwNCmxvY2FsIEJyaWdodG5lc3NTbGlkZXIgPSBUYWJzLkVzc2VudGlhbDpBZGRTbGlkZXIoIkJyaWdodG5lc3NTbGlkZXIiLCB7DQogICAgVGl0bGUgPSAiR2xvdyBCcmlnaHRuZXNzIiwNCiAgICBEZXNjcmlwdGlvbiA9ICJBZGp1c3QgdGhlIGJyaWdodG5lc3Mgb2YgdGhlIGdsb3ciLA0KICAgIERlZmF1bHQgPSAyLCANCiAgICBNaW4gPSAwLA0KICAgIE1heCA9IDEwLA0KICAgIFJvdW5kaW5nID0gMSwNCiAgICBDYWxsYmFjayA9IGZ1bmN0aW9uKFZhbHVlKQ0KICAgICAgICBpZiBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4NCiAgICAgICAgICAgIC0tIFVwZGF0ZSB0aGUgYnJpZ2h0bmVzcyBvZiB0aGUgZ2xvdyBsaWdodA0KICAgICAgICAgICAgaWYgcGxheWVyLkNoYXJhY3RlcjpGaW5kRmlyc3RDaGlsZCgiSGVhZCIpIGFuZCBwbGF5ZXIuQ2hhcmFjdGVyLkhlYWQ6RmluZEZpcnN0Q2hpbGQoIkdsb3dMaWdodCIpIHRoZW4NCiAgICAgICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuR2xvd0xpZ2h0LkJyaWdodG5lc3MgPSBWYWx1ZQ0KICAgICAgICAgICAgZW5kDQogICAgICAgIGVuZA0KICAgIGVuZA0KfSkNCg0KLS0gQ3JlYXRlIGEgY29sb3IgcGlja2VyIGZvciBjb250cm9sbGluZyB0aGUgY29sb3Igb2YgdGhlIGdsb3cgbGlnaHQgdW5kZXIgVGFicy5Fc3NlbnRpYWwNCmxvY2FsIEdsb3dDb2xvcnBpY2tlciA9IFRhYnMuRXNzZW50aWFsOkFkZENvbG9ycGlja2VyKCJHbG93Q29sb3JwaWNrZXIiLCB7IA0KICAgIFRpdGxlID0gIkdsb3cgQ29sb3IiLA0KICAgIERlZmF1bHQgPSBDb2xvcjMuZnJvbVJHQig5NiwgMjA1LCAyNTUpIC0tIERlZmF1bHQgY29sb3INCn0pDQoNCi0tIFZhcmlhYmxlIHRvIHN0b3JlIHRoZSBQb2ludExpZ2h0IGluc3RhbmNlIGZvciBsYXRlciByZW1vdmFsDQpsb2NhbCBnbG93TGlnaHQNCg0KbG9jYWwgZnVuY3Rpb24gbWFrZUhlYWRHbG93KGNoYXJhY3RlciwgcmFuZ2UsIGJyaWdodG5lc3MsIGNvbG9yKQ0KICAgIC0tIEVuc3VyZSB0aGUgSGVhZCBleGlzdHMNCiAgICBsb2NhbCBoZWFkID0gY2hhcmFjdGVyOldhaXRGb3JDaGlsZCgiSGVhZCIsIDUpDQoNCiAgICBpZiBoZWFkIHRoZW4NCiAgICAgICAgLS0gQ2hlY2sgaWYgbGlnaHQgYWxyZWFkeSBleGlzdHMgdG8gYXZvaWQgZHVwbGljYXRpb24NCiAgICAgICAgaWYgbm90IGhlYWQ6RmluZEZpcnN0Q2hpbGQoIkdsb3dMaWdodCIpIHRoZW4NCiAgICAgICAgICAgIGdsb3dMaWdodCA9IEluc3RhbmNlLm5ldygiUG9pbnRMaWdodCIpDQogICAgICAgICAgICBnbG93TGlnaHQuTmFtZSA9ICJHbG93TGlnaHQiDQogICAgICAgICAgICBnbG93TGlnaHQuQ29sb3IgPSBjb2xvciAtLSBTZXQgdGhlIGNvbG9yIGZyb20gdGhlIGNvbG9yIHBpY2tlcg0KICAgICAgICAgICAgZ2xvd0xpZ2h0LkJyaWdodG5lc3MgPSBicmlnaHRuZXNzIC0tIFNldCBicmlnaHRuZXNzIGZyb20gdGhlIHNsaWRlcg0KICAgICAgICAgICAgZ2xvd0xpZ2h0LlJhbmdlID0gcmFuZ2UgLS0gU2V0IHRoZSByYW5nZSBmcm9tIHRoZSBzbGlkZXINCiAgICAgICAgICAgIGdsb3dMaWdodC5QYXJlbnQgPSBoZWFkDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kDQoNCmxvY2FsIGZ1bmN0aW9uIHJlbW92ZUhlYWRHbG93KGNoYXJhY3RlcikNCiAgICBsb2NhbCBoZWFkID0gY2hhcmFjdGVyOkZpbmRGaXJzdENoaWxkKCJIZWFkIikNCiAgICBpZiBoZWFkIGFuZCBoZWFkOkZpbmRGaXJzdENoaWxkKCJHbG93TGlnaHQiKSB0aGVuDQogICAgICAgIGhlYWQuR2xvd0xpZ2h0OkRlc3Ryb3koKQ0KICAgIGVuZA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIGhhbmRsZSBjaGFyYWN0ZXIgcmVzcGF3bg0KbG9jYWwgZnVuY3Rpb24gb25DaGFyYWN0ZXJBZGRlZChjaGFyYWN0ZXIpDQogICAgaWYgU3BvdExpZ2h0VG9nZ2xlLlZhbHVlIHRoZW4NCiAgICAgICAgbWFrZUhlYWRHbG93KGNoYXJhY3RlciwgUmFuZ2VTbGlkZXIuVmFsdWUsIEJyaWdodG5lc3NTbGlkZXIuVmFsdWUsIEdsb3dDb2xvcnBpY2tlci5WYWx1ZSkNCiAgICBlbHNlDQogICAgICAgIHJlbW92ZUhlYWRHbG93KGNoYXJhY3RlcikNCiAgICBlbmQNCmVuZA0KDQotLSBJbml0aWFsbHkgYXBwbHkgb3IgcmVtb3ZlIGdsb3cgYmFzZWQgb24gdG9nZ2xlIHN0YXRlDQppZiBwbGF5ZXIuQ2hhcmFjdGVyIHRoZW4NCiAgICBvbkNoYXJhY3RlckFkZGVkKHBsYXllci5DaGFyYWN0ZXIpDQplbmQNCg0KLS0gTGlzdGVuIGZvciB0b2dnbGUgY2hhbmdlcyBhbmQgYXBwbHkvcmVtb3ZlIHRoZSBnbG93IGVmZmVjdA0KU3BvdExpZ2h0VG9nZ2xlOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgaWYgcGxheWVyLkNoYXJhY3RlciB0aGVuDQogICAgICAgIGlmIFNwb3RMaWdodFRvZ2dsZS5WYWx1ZSB0aGVuDQogICAgICAgICAgICBtYWtlSGVhZEdsb3cocGxheWVyLkNoYXJhY3RlciwgUmFuZ2VTbGlkZXIuVmFsdWUsIEJyaWdodG5lc3NTbGlkZXIuVmFsdWUsIEdsb3dDb2xvcnBpY2tlci5WYWx1ZSkNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgcmVtb3ZlSGVhZEdsb3cocGxheWVyLkNoYXJhY3RlcikNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQoNCi0tIExpc3RlbiBmb3IgY29sb3IgcGlja2VyIGNoYW5nZXMgYW5kIHVwZGF0ZSB0aGUgZ2xvdyBjb2xvcg0KR2xvd0NvbG9ycGlja2VyOk9uQ2hhbmdlZChmdW5jdGlvbigpDQogICAgaWYgcGxheWVyLkNoYXJhY3RlciB0aGVuDQogICAgICAgIGlmIHBsYXllci5DaGFyYWN0ZXI6RmluZEZpcnN0Q2hpbGQoIkhlYWQiKSBhbmQgcGxheWVyLkNoYXJhY3Rlci5IZWFkOkZpbmRGaXJzdENoaWxkKCJHbG93TGlnaHQiKSB0aGVuDQogICAgICAgICAgICBwbGF5ZXIuQ2hhcmFjdGVyLkhlYWQuR2xvd0xpZ2h0LkNvbG9yID0gR2xvd0NvbG9ycGlja2VyLlZhbHVlDQogICAgICAgIGVuZA0KICAgIGVuZA0KZW5kKQ0KDQotLSBDb25uZWN0IHRvIHRoZSBDaGFyYWN0ZXJBZGRlZCBldmVudCBpbiBjYXNlIG9mIHJlc3Bhd24gb3IgdGVsZXBvcnQNCnBsYXllci5DaGFyYWN0ZXJBZGRlZDpDb25uZWN0KG9uQ2hhcmFjdGVyQWRkZWQpDQoNCg0KLS0tLS13ZWFwb24tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCmxvY2FsIHZpZXdNb2RlbHMgPSBwbGF5ZXIuUGxheWVyU2NyaXB0cy5Bc3NldHM6V2FpdEZvckNoaWxkKCJWaWV3TW9kZWxzIikNCmxvY2FsIHRocm93YWJsZXMgPSBwbGF5ZXIuUGxheWVyU2NyaXB0cy5Bc3NldHM6V2FpdEZvckNoaWxkKCJUaHJvd2FibGVzIikNCg0KLS0gSGVscGVyIGZ1bmN0aW9uIHRvIGNsb25lIG1vZGVscw0KbG9jYWwgZnVuY3Rpb24gY2xvbmVNb2RlbChtb2RlbCwgcGFyZW50LCBuYW1lKQ0KICAgIGlmIG1vZGVsIHRoZW4NCiAgICAgICAgbG9jYWwgY2xvbmUgPSBtb2RlbDpDbG9uZSgpDQogICAgICAgIGNsb25lLk5hbWUgPSBuYW1lDQogICAgICAgIGNsb25lLlBhcmVudCA9IHBhcmVudA0KICAgIGVuZA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIHJlcGxhY2UgbW9kZWwgd2l0aCBzZWxlY3RlZCBkcm9wZG93biB2YWx1ZQ0KbG9jYWwgZnVuY3Rpb24gcmVwbGFjZU1vZGVsKG1vZGVsTmFtZSwgdmFsdWUsIHBhcmVudCwgb3JpZ2luYWxOYW1lKQ0KICAgIGxvY2FsIGN1cnJlbnQgPSBwYXJlbnQ6RmluZEZpcnN0Q2hpbGQobW9kZWxOYW1lKQ0KICAgIGlmIGN1cnJlbnQgdGhlbiBjdXJyZW50OkRlc3Ryb3koKSBlbmQNCiAgICBsb2NhbCBuZXdNb2RlbCA9IHBhcmVudDpGaW5kRmlyc3RDaGlsZCh2YWx1ZSA9PSAiTm9uZSIgYW5kIG9yaWdpbmFsTmFtZSBvciB2YWx1ZSkNCiAgICBpZiBuZXdNb2RlbCB0aGVuDQogICAgICAgIGxvY2FsIGNsb25lID0gbmV3TW9kZWw6Q2xvbmUoKQ0KICAgICAgICBjbG9uZS5OYW1lID0gbW9kZWxOYW1lDQogICAgICAgIGNsb25lLlBhcmVudCA9IHBhcmVudA0KICAgIGVuZA0KZW5kDQoNCi0tIEZ1bmN0aW9uIHRvIHNldHVwIGRyb3Bkb3duIGZvciBlYWNoIHdlYXBvbiBtb2RlbA0KbG9jYWwgZnVuY3Rpb24gc2V0dXBEcm9wZG93bihuYW1lLCB0aXRsZSwgdmFsdWVzLCBwYXJlbnQsIG1vZGVsTWFwKQ0KICAgIGxvY2FsIGRyb3Bkb3duID0gVGFicy5Ta2luejpBZGREcm9wZG93bihuYW1lIC4uICJEcm9wZG93biIsIHsNCiAgICAgICAgVGl0bGUgPSB0aXRsZSwNCiAgICAgICAgVmFsdWVzID0gdmFsdWVzLA0KICAgICAgICBNdWx0aSA9IGZhbHNlLA0KICAgICAgICBEZWZhdWx0ID0gMSwNCiAgICB9KQ0KDQogICAgZHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KICAgICAgICByZXBsYWNlTW9kZWwobmFtZSwgVmFsdWUsIHBhcmVudCwgbmFtZSAuLiAiIE9yaWdpbmFsIikNCiAgICBlbmQpDQplbmQNCg0KLS0gQ2xvbmUgb3JpZ2luYWwgbW9kZWxzIGZvciB3ZWFwb25zDQpsb2NhbCB3ZWFwb25Db25maWdzID0gew0KICAgIHsiQXNzYXVsdCBSaWZsZSIsICJBc3NhdWx0IFJpZmxlIE9yaWdpbmFsIiwgeyJOb25lIiwgIkFVRyIsICJBSy00NyIsICJCb25lY2xhdyBSaWZsZSJ9fSwNCiAgICB7IlJldm9sdmVyIiwgIlJldm9sdmVyIE9yaWdpbmFsIiwgeyJOb25lIiwgIkJvbmVjbGF3IFJldm9sdmVyIn19LA0KICAgIHsiQm93IiwgIkJvdyBPcmlnaW5hbCIsIHsiTm9uZSIsICJCYXQgQm93IiwgIkNvbXBvdW5kIEJvdyIsICJSYXZlbiBCb3cifX0sDQogICAgeyJTaG9ydHkiLCAiU2hvcnR5IE9yaWdpbmFsIiwgeyJOb25lIiwgIkxvdmVseSBTaG9ydHkiLCAiTm90IFNvIFNob3J0eSIsICJUb28gU2hvcnR5IiwgIkRlbW9uIFNob3J0eSJ9fSwNCiAgICB7IkJ1cnN0IFJpZmxlIiwgIkJ1cnN0IFJpZmxlIE9yaWdpbmFsIiwgeyJOb25lIiwgIkVsZWN0cm8gUmlmbGUiLCAiQXF1YSBCdXJzdCIsICJQaXhlbCBCdXJzdCIsICJTcGVjdHJhbCBCdXJzdCJ9fSwNCiAgICB7IlJQRyIsICJSUEcgT3JpZ2luYWwiLCB7Ik5vbmUiLCAiTnVrZSBMYXVuY2hlciJ9fSwNCiAgICB7IlNob3RndW4iLCAiU2hvdGd1biBPcmlnaW5hbCIsIHsiTm9uZSIsICJCYWxsb29uIFNob3RndW4iLCAiSHlwZXIgU2hvdGd1biJ9fSwNCiAgICB7IlNuaXBlciIsICJTbmlwZXIgT3JpZ2luYWwiLCB7Ik5vbmUiLCAiUGl4ZWwgU25pcGVyIiwgIkh5cGVyIFNuaXBlciIsICJLZXlwZXIiLCAiRXlldGhpbmcgU25pcGVyIn19LA0KfQ0KDQpmb3IgXywgY29uZmlnIGluIGlwYWlycyh3ZWFwb25Db25maWdzKSBkbw0KICAgIGxvY2FsIG1vZGVsID0gdmlld01vZGVsczpGaW5kRmlyc3RDaGlsZChjb25maWdbMV0pDQogICAgaWYgbW9kZWwgdGhlbg0KICAgICAgICBjbG9uZU1vZGVsKG1vZGVsLCB2aWV3TW9kZWxzLCBjb25maWdbMl0pDQogICAgICAgIHNldHVwRHJvcGRvd24oY29uZmlnWzFdLCBjb25maWdbMV0sIGNvbmZpZ1szXSwgdmlld01vZGVscywgY29uZmlnWzFdKQ0KICAgIGVuZA0KZW5kDQoNCi0tIENsb25lIEdyZW5hZGUgYW5kIE1vbG90b3YgbW9kZWxzDQpjbG9uZU1vZGVsKHZpZXdNb2RlbHM6RmluZEZpcnN0Q2hpbGQoIkdyZW5hZGUiKSwgdmlld01vZGVscywgIkdyZW5hZGUgT3JpZ2luYWwiKQ0KY2xvbmVNb2RlbCh0aHJvd2FibGVzOkZpbmRGaXJzdENoaWxkKCJHcmVuYWRlIiksIHRocm93YWJsZXMsICJHcmVuYWRlIE9yaWdpbmFsIikNCmNsb25lTW9kZWwodmlld01vZGVsczpGaW5kRmlyc3RDaGlsZCgiTW9sb3RvdiIpLCB2aWV3TW9kZWxzLCAiTW9sb3RvdiBPcmlnaW5hbCIpDQpjbG9uZU1vZGVsKHRocm93YWJsZXM6RmluZEZpcnN0Q2hpbGQoIk1vbG90b3YiKSwgdGhyb3dhYmxlcywgIk1vbG90b3YgT3JpZ2luYWwiKQ0KDQotLSBDcmVhdGUgZHJvcGRvd25zIGZvciBHcmVuYWRlIGFuZCBNb2xvdG92DQpzZXR1cERyb3Bkb3duKCJHcmVuYWRlIiwgIkdyZW5hZGUiLCB7Ik5vbmUiLCAiV2hvb3BlZSBDdXNoaW9uIiwgIldhdGVyIEJhbGxvb24iLCAiU291bCBHcmVuYWRlIn0sIHZpZXdNb2RlbHMpDQpzZXR1cERyb3Bkb3duKCJNb2xvdG92IiwgIk1vbG90b3YiLCB7Ik5vbmUiLCAiQ29mZmVlIiwgIkhleHhlZCBDYW5kbGUiLCAiVG9yY2gifSwgdmlld01vZGVscykNCg0KLS0gQ2xvbmUgYW5kIGNyZWF0ZSBkcm9wZG93biBmb3IgU2N5dGhlDQpjbG9uZU1vZGVsKHZpZXdNb2RlbHM6RmluZEZpcnN0Q2hpbGQoIlNjeXRoZSIpLCB2aWV3TW9kZWxzLCAiU2N5dGhlIE9yaWdpbmFsIikNCmNsb25lTW9kZWwodGhyb3dhYmxlczpGaW5kRmlyc3RDaGlsZCgiU2N5dGhlIiksIHRocm93YWJsZXMsICJTY3l0aGUgT3JpZ2luYWwiKQ0KDQpsb2NhbCBTY3l0aGVEcm9wZG93biA9IFRhYnMuU2tpbno6QWRkRHJvcGRvd24oIlNjeXRoZURyb3Bkb3duIiwgew0KICAgIFRpdGxlID0gIlNjeXRoZSIsDQogICAgVmFsdWVzID0geyJOb25lIiwgIktleXRoZSIsICJBbmNob3IifSwNCiAgICBNdWx0aSA9IGZhbHNlLA0KICAgIERlZmF1bHQgPSAxLA0KfSkNCg0KU2N5dGhlRHJvcGRvd246T25DaGFuZ2VkKGZ1bmN0aW9uKFZhbHVlKQ0KICAgIHJlcGxhY2VNb2RlbCgiU2N5dGhlIiwgVmFsdWUsIHZpZXdNb2RlbHMsICJTY3l0aGUgT3JpZ2luYWwiKQ0KICAgIHJlcGxhY2VNb2RlbCgiU2N5dGhlIiwgVmFsdWUsIHRocm93YWJsZXMsICJTY3l0aGUgT3JpZ2luYWwiKQ0KZW5kKQ0KDQotLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCg0KDQpsb2NhbCB0aHJvd2FibGVzID0gcGxheWVyLlBsYXllclNjcmlwdHMuQXNzZXRzOldhaXRGb3JDaGlsZCgiVGhyb3dhYmxlcyIpDQpsb2NhbCBzbW9rZUNsb3VkcyA9IHBsYXllci5QbGF5ZXJTY3JpcHRzLkFzc2V0cy5NaXNjLlNtb2tlQ2xvdWRzDQpsb2NhbCBmdW5jdGlvbiBjbG9uZU1vZGVsKHNvdXJjZU1vZGVsLCB0YXJnZXRQYXJlbnQsIG5ld05hbWUpDQogICAgaWYgc291cmNlTW9kZWwgdGhlbg0KICAgICAgICBsb2NhbCBjbG9uZSA9IHNvdXJjZU1vZGVsOkNsb25lKCkNCiAgICAgICAgY2xvbmUuTmFtZSA9IG5ld05hbWUNCiAgICAgICAgY2xvbmUuUGFyZW50ID0gdGFyZ2V0UGFyZW50DQogICAgZW5kDQplbmQNCg0KLS0gRnVuY3Rpb24gdG8gZGVzdHJveSBtb2RlbHMNCmxvY2FsIGZ1bmN0aW9uIGRlc3Ryb3lNb2RlbChwYXJlbnQsIG5hbWUpDQogICAgbG9jYWwgbW9kZWwgPSBwYXJlbnQ6RmluZEZpcnN0Q2hpbGQobmFtZSkNCiAgICBpZiBtb2RlbCB0aGVuDQogICAgICAgIG1vZGVsOkRlc3Ryb3koKQ0KICAgIGVuZA0KZW5kDQoNCi0tIENsb25lIG9yaWdpbmFsIG1vZGVscw0KY2xvbmVNb2RlbCh2aWV3TW9kZWxzOkZpbmRGaXJzdENoaWxkKCJTbW9rZSBHcmVuYWRlIiksIHZpZXdNb2RlbHMsICJTbW9rZSBHcmVuYWRlIE9yaWdpbmFsIikNCmNsb25lTW9kZWwodGhyb3dhYmxlczpGaW5kRmlyc3RDaGlsZCgiU21va2UgR3JlbmFkZSIpLCB0aHJvd2FibGVzLCAiU21va2UgR3JlbmFkZSBPcmlnaW5hbCIpDQpjbG9uZU1vZGVsKHNtb2tlQ2xvdWRzOkZpbmRGaXJzdENoaWxkKCJEZWZhdWx0IiksIHNtb2tlQ2xvdWRzLCAiU21va2UgR3JlbmFkZSBPcmlnaW5hbCIpDQpjbG9uZU1vZGVsKHZpZXdNb2RlbHM6RmluZEZpcnN0Q2hpbGQoIkZsYXNoYmFuZyIpLCB2aWV3TW9kZWxzLCAiRmxhc2hiYW5nIE9yaWdpbmFsIikNCmNsb25lTW9kZWwodGhyb3dhYmxlczpGaW5kRmlyc3RDaGlsZCgiRmxhc2hiYW5nIiksIHRocm93YWJsZXMsICJGbGFzaGJhbmcgT3JpZ2luYWwiKQ0KDQotLSBEcm9wZG93biBmb3IgU21va2UgR3JlbmFkZQ0KbG9jYWwgU21va2VHcmVuYWRlRHJvcGRvd24gPSBUYWJzLlNraW56OkFkZERyb3Bkb3duKCJTbW9rZUdyZW5hZGVEcm9wZG93biIsIHsNCiAgICBUaXRsZSA9ICJTbW9rZSBHcmVuYWRlICIsDQogICAgVmFsdWVzID0geyJOb25lIiwgIkV5ZWJhbGwiLCAiQmFsYW5jZSJ9LA0KICAgIE11bHRpID0gZmFsc2UsDQogICAgRGVmYXVsdCA9IDEsDQp9KQ0KDQpTbW9rZUdyZW5hZGVEcm9wZG93bjpPbkNoYW5nZWQoZnVuY3Rpb24oVmFsdWUpDQogICAgLS0gRGVzdHJveSBleGlzdGluZyBtb2RlbHMNCiAgICBkZXN0cm95TW9kZWwodmlld01vZGVscywgIlNtb2tlIEdyZW5hZGUiKQ0KICAgIGRlc3Ryb3lNb2RlbCh2aWV3TW9kZWxzLCAiU21va2UgR3JlbmFkZSBPcmlnaW5hbCIpDQogICAgZGVzdHJveU1vZGVsKHRocm93YWJsZXMsICJTbW9rZSBHcmVuYWRlIikNCiAgICBkZXN0cm95TW9kZWwodGhyb3dhYmxlcywgIlNtb2tlIEdyZW5hZGUgT3JpZ2luYWwiKQ0KICAgIGRlc3Ryb3lNb2RlbChzbW9rZUNsb3VkcywgIkRlZmF1bHQiKQ0KICAgIGRlc3Ryb3lNb2RlbChzbW9rZUNsb3VkcywgIlNtb2tlIEdyZW5hZGUgT3JpZ2luYWwiKQ0KDQogICAgbG9jYWwgbW9kZWxOYW1lID0gKFZhbHVlID09ICJOb25lIikgYW5kICJTbW9rZSBHcmVuYWRlIE9yaWdpbmFsIiBvciBWYWx1ZQ0KICAgIC0tIENsb25lIG5ldyBtb2RlbHMgYmFzZWQgb24gZHJvcGRvd24gdmFsdWUNCiAgICBjbG9uZU1vZGVsKHZpZXdNb2RlbHM6RmluZEZpcnN0Q2hpbGQobW9kZWxOYW1lKSwgdmlld01vZGVscywgIlNtb2tlIEdyZW5hZGUiKQ0KICAgIGNsb25lTW9kZWwodGhyb3dhYmxlczpGaW5kRmlyc3RDaGlsZChtb2RlbE5hbWUpLCB0aHJvd2FibGVzLCAiU21va2UgR3JlbmFkZSIpDQogICAgY2xvbmVNb2RlbChzbW9rZUNsb3VkczpGaW5kRmlyc3RDaGlsZChtb2RlbE5hbWUpLCBzbW9rZUNsb3VkcywgIkRlZmF1bHQiKQ0KZW5kKQ0KDQotLSBEcm9wZG93biBmb3IgRmxhc2hiYW5nDQpsb2NhbCBGbGFzaGJhbmdEcm9wZG93biA9IFRhYnMuU2tpbno6QWRkRHJvcGRvd24oIkZsYXNoYmFuZ0Ryb3Bkb3duIiwgew0KICAgIFRpdGxlID0gIkZsYXNoYmFuZyAiLA0KICAgIFZhbHVlcyA9IHsiTm9uZSIsICJTa3VsbGJhbmciLCAiRGlzY28gQmFsbCIsICJDYW1lcmEiLCAiUGl4ZWwgRmxhc2hiYW5nIn0sDQogICAgTXVsdGkgPSBmYWxzZSwNCiAgICBEZWZhdWx0ID0gMSwNCn0pDQoNCkZsYXNoYmFuZ0Ryb3Bkb3duOk9uQ2hhbmdlZChmdW5jdGlvbihWYWx1ZSkNCiAgICAtLSBEZXN0cm95IGN1cnJlbnQgbW9kZWxzDQogICAgZGVzdHJveU1vZGVsKHZpZXdNb2RlbHMsICJGbGFzaGJhbmciKQ0KICAgIGRlc3Ryb3lNb2RlbCh2aWV3TW9kZWxzLCAiRmxhc2hiYW5nIE9yaWdpbmFsIikNCiAgICBkZXN0cm95TW9kZWwodGhyb3dhYmxlcywgIkZsYXNoYmFuZyIpDQogICAgZGVzdHJveU1vZGVsKHRocm93YWJsZXMsICJGbGFzaGJhbmcgT3JpZ2luYWwiKQ0KDQogICAgLS0gQ2xvbmUgbmV3IG1vZGVsIGJhc2VkIG9uIGRyb3Bkb3duIHZhbHVlDQogICAgbG9jYWwgbW9kZWxOYW1lID0gKFZhbHVlID09ICJOb25lIikgYW5kICJGbGFzaGJhbmcgT3JpZ2luYWwiIG9yIFZhbHVlDQogICAgY2xvbmVNb2RlbCh2aWV3TW9kZWxzOkZpbmRGaXJzdENoaWxkKG1vZGVsTmFtZSksIHZpZXdNb2RlbHMsICJGbGFzaGJhbmciKQ0KICAgIGNsb25lTW9kZWwodGhyb3dhYmxlczpGaW5kRmlyc3RDaGlsZChtb2RlbE5hbWUpLCB0aHJvd2FibGVzLCAiRmxhc2hiYW5nIikNCmVuZCkNCg0KDQplbmQNCg0KDQotLSBBZGRvbnM6DQotLSBTYXZlTWFuYWdlciAoQWxsb3dzIHlvdSB0byBoYXZlIGEgY29uZmlndXJhdGlvbiBzeXN0ZW0pDQotLSBJbnRlcmZhY2VNYW5hZ2VyIChBbGxvd3MgeW91IHRvIGhhdmUgYSBpbnRlcmZhY2UgbWFuYWdtZW50IHN5c3RlbSkNCg0KLS0gSGFuZCB0aGUgbGlicmFyeSBvdmVyIHRvIG91ciBtYW5hZ2Vycw0KU2F2ZU1hbmFnZXI6U2V0TGlicmFyeShGbHVlbnQpDQpJbnRlcmZhY2VNYW5hZ2VyOlNldExpYnJhcnkoRmx1ZW50KQ0KDQotLSBJZ25vcmUga2V5cyB0aGF0IGFyZSB1c2VkIGJ5IFRoZW1lTWFuYWdlci4NCi0tICh3ZSBkb250IHdhbnQgY29uZmlncyB0byBzYXZlIHRoZW1lcywgZG8gd2U/KQ0KU2F2ZU1hbmFnZXI6SWdub3JlVGhlbWVTZXR0aW5ncygpDQoNCi0tIFlvdSBjYW4gYWRkIGluZGV4ZXMgb2YgZWxlbWVudHMgdGhlIHNhdmUgbWFuYWdlciBzaG91bGQgaWdub3JlDQpTYXZlTWFuYWdlcjpTZXRJZ25vcmVJbmRleGVzKHt9KQ0KDQotLSB1c2UgY2FzZSBmb3IgZG9pbmcgaXQgdGhpcyB3YXk6DQotLSBhIHNjcmlwdCBodWIgY291bGQgaGF2ZSB0aGVtZXMgaW4gYSBnbG9iYWwgZm9sZGVyDQotLSBhbmQgZ2FtZSBjb25maWdzIGluIGEgc2VwYXJhdGUgZm9sZGVyIHBlciBnYW1lDQpJbnRlcmZhY2VNYW5hZ2VyOlNldEZvbGRlcigiRmx1ZW50U2NyaXB0SHViIikNClNhdmVNYW5hZ2VyOlNldEZvbGRlcigiRmx1ZW50U2NyaXB0SHViL3NwZWNpZmljLWdhbWUiKQ0KDQpJbnRlcmZhY2VNYW5hZ2VyOkJ1aWxkSW50ZXJmYWNlU2VjdGlvbihUYWJzLlNldHRpbmdzKQ0KU2F2ZU1hbmFnZXI6QnVpbGRDb25maWdTZWN0aW9uKFRhYnMuU2V0dGluZ3MpDQoNCg0KV2luZG93OlNlbGVjdFRhYigxKQ0KDQpGbHVlbnQ6Tm90aWZ5KHsNCiAgICBUaXRsZSA9ICJGbHVlbnQiLA0KICAgIENvbnRlbnQgPSAiVGhlIHNjcmlwdCBoYXMgYmVlbiBsb2FkZWQuIiwNCiAgICBEdXJhdGlvbiA9IDgNCn0pDQoNCi0tIFlvdSBjYW4gdXNlIHRoZSBTYXZlTWFuYWdlcjpMb2FkQXV0b2xvYWRDb25maWcoKSB0byBsb2FkIGEgY29uZmlnDQotLSB3aGljaCBoYXMgYmVlbiBtYXJrZWQgdG8gYmUgb25lIHRoYXQgYXV0byBsb2FkcyENClNhdmVNYW5hZ2VyOkxvYWRBdXRvbG9hZENvbmZpZygpDQoNCi0tLS11bm9wdGltaXplZC0tLS0tLS0NCmxvY2FsIENvcmVHdWkgPSBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKQ0KDQotLSBMb29rIHRocm91Z2ggYWxsIGRlc2NlbmRhbnRzDQpmb3IgXywgZGVzY2VuZGFudCBpbiBpcGFpcnMoQ29yZUd1aTpHZXREZXNjZW5kYW50cygpKSBkbw0KICAgIGlmIGRlc2NlbmRhbnQ6SXNBKCJUZXh0TGFiZWwiKSBhbmQgZGVzY2VuZGFudC5UZXh0ID09ICJTaWxlbnQgQWltIiB0aGVuDQogICAgICAgIC0tIENyZWF0ZSBhbiBJbWFnZUxhYmVsIGluIHRoZSBwYXJlbnQgb2YgdGhlIFRleHRMYWJlbA0KICAgICAgICBsb2NhbCBpbWFnZUxhYmVsID0gSW5zdGFuY2UubmV3KCJJbWFnZUxhYmVsIikNCiAgICAgICAgaW1hZ2VMYWJlbC5QYXJlbnQgPSBkZXNjZW5kYW50LlBhcmVudA0KICAgICAgICBpbWFnZUxhYmVsLkltYWdlID0gInJieGFzc2V0aWQ6Ly83NDgwNTgxOTUyMDg1OSINCiAgICAgICAgaW1hZ2VMYWJlbC5TaXplID0gVURpbTIubmV3KDAsIDYwLCAwLCA2KSAtLSBTZXQgdGhlIHNwZWNpZmllZCBzaXplDQogICAgICAgIGltYWdlTGFiZWwuUG9zaXRpb24gPSBVRGltMi5uZXcoMCwgMCwgMSwgMCkgLS0gUG9zaXRpb24gYmVsb3cgdGhlIFRleHRMYWJlbA0KICAgICAgICBpbWFnZUxhYmVsLkJhY2tncm91bmRUcmFuc3BhcmVuY3kgPSAxDQoNCiAgICAgICAgYnJlYWsNCiAgICBlbmQNCmVuZA0KDQpsb2NhbCBmdW5jdGlvbiBjcmVhdGVNb2Rlcm5TaWduYm9hcmQocG9zaXRpb24sIGltYWdlSWQsIHJvdGF0aW9uKQ0KICAgIC0tIENyZWF0ZSB0aGUgbWFpbiBmcmFtZSBvZiB0aGUgc2lnbmJvYXJkDQogICAgbG9jYWwgYm9hcmRGcmFtZSA9IEluc3RhbmNlLm5ldygiUGFydCIpDQogICAgYm9hcmRGcmFtZS5TaXplID0gVmVjdG9yMy5uZXcoMjAsIDcsIDAuNSkgLS0gSW5jcmVhc2VkIGhlaWdodCB0byBtYWtlIHRoZSBpbWFnZSB0YWxsZXINCiAgICBib2FyZEZyYW1lLkNGcmFtZSA9IENGcmFtZS5uZXcocG9zaXRpb24pICogQ0ZyYW1lLkFuZ2xlcygwLCBtYXRoLnJhZChyb3RhdGlvbiksIDApIC0tIEFwcGx5IDE0MC1kZWdyZWUgcm90YXRpb24NCiAgICBib2FyZEZyYW1lLkFuY2hvcmVkID0gdHJ1ZQ0KICAgIGJvYXJkRnJhbWUuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLk1ldGFsDQogICAgYm9hcmRGcmFtZS5Db2xvciA9IENvbG9yMy5mcm9tUkdCKDU1LCA1NSwgNTUpIC0tIERhcmsgbWV0YWxsaWMgZ3JheQ0KICAgIGJvYXJkRnJhbWUuTmFtZSA9ICJNb2Rlcm5TaWduYm9hcmRGcmFtZSINCiAgICBib2FyZEZyYW1lLlBhcmVudCA9IHdvcmtzcGFjZQ0KDQogICAgLS0gQ3JlYXRlIHRoZSBnbGFzcyBwYW5lbCBmb3IgdGhlIHNpZ25ib2FyZA0KICAgIGxvY2FsIGdsYXNzUGFuZWwgPSBJbnN0YW5jZS5uZXcoIlBhcnQiKQ0KICAgIGdsYXNzUGFuZWwuU2l6ZSA9IFZlY3RvcjMubmV3KDE5LjUsIDYuNSwgMC4xKSAtLSBBZGp1c3RlZCB0byBmaXQgdGhlIHRhbGxlciBmcmFtZQ0KICAgIGdsYXNzUGFuZWwuQ0ZyYW1lID0gYm9hcmRGcmFtZS5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIDAsIC0wLjMpIC0tIFBvc2l0aW9uIHJlbGF0aXZlIHRvIHRoZSBmcmFtZQ0KICAgIGdsYXNzUGFuZWwuQW5jaG9yZWQgPSB0cnVlDQogICAgZ2xhc3NQYW5lbC5NYXRlcmlhbCA9IEVudW0uTWF0ZXJpYWwuR2xhc3MNCiAgICBnbGFzc1BhbmVsLlRyYW5zcGFyZW5jeSA9IDAuMw0KICAgIGdsYXNzUGFuZWwuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQigyMDAsIDIwMCwgMjAwKSAtLSBMaWdodCBncmF5IGZvciBnbGFzcw0KICAgIGdsYXNzUGFuZWwuTmFtZSA9ICJNb2Rlcm5TaWduYm9hcmRHbGFzcyINCiAgICBnbGFzc1BhbmVsLlBhcmVudCA9IHdvcmtzcGFjZQ0KDQogICAgLS0gQWRkIFN1cmZhY2VHdWkgZm9yIHRoZSBpbWFnZQ0KICAgIGxvY2FsIHN1cmZhY2VHdWkgPSBJbnN0YW5jZS5uZXcoIlN1cmZhY2VHdWkiLCBnbGFzc1BhbmVsKQ0KICAgIHN1cmZhY2VHdWkuRmFjZSA9IEVudW0uTm9ybWFsSWQuRnJvbnQNCiAgICBzdXJmYWNlR3VpLkFkb3JuZWUgPSBnbGFzc1BhbmVsDQoNCiAgICBsb2NhbCBpbWFnZUxhYmVsID0gSW5zdGFuY2UubmV3KCJJbWFnZUxhYmVsIiwgc3VyZmFjZUd1aSkNCiAgICBpbWFnZUxhYmVsLlNpemUgPSBVRGltMi5uZXcoMSwgMCwgMSwgMCkgLS0gVXNlIHRoZSBmdWxsIGhlaWdodCBhbmQgd2lkdGggb2YgdGhlIGdsYXNzIHBhbmVsDQogICAgaW1hZ2VMYWJlbC5CYWNrZ3JvdW5kVHJhbnNwYXJlbmN5ID0gMQ0KICAgIGltYWdlTGFiZWwuSW1hZ2UgPSAicmJ4YXNzZXRpZDovLyIgLi4gaW1hZ2VJZCAtLSBTZXQgdGhlIGltYWdlIElEIGhlcmUNCiAgICBpbWFnZUxhYmVsLk5hbWUgPSAiSW1hZ2VMYWJlbCINCg0KICAgIC0tIENyZWF0ZSB0aGUgc3RhbmQgZm9yIHRoZSBzaWduYm9hcmQNCiAgICBsb2NhbCBzdGFuZCA9IEluc3RhbmNlLm5ldygiUGFydCIpDQogICAgc3RhbmQuU2l6ZSA9IFZlY3RvcjMubmV3KDAuNSwgMTIsIDAuNSkgLS0gSW5jcmVhc2VkIGhlaWdodCB0byBtYXRjaCB0aGUgdGFsbGVyIGJvYXJkDQogICAgc3RhbmQuQ0ZyYW1lID0gYm9hcmRGcmFtZS5DRnJhbWUgKiBDRnJhbWUubmV3KDAsIC0xMSwgMCkgLS0gUG9zaXRpb24gcmVsYXRpdmUgdG8gdGhlIGZyYW1lDQogICAgc3RhbmQuQW5jaG9yZWQgPSB0cnVlDQogICAgc3RhbmQuTWF0ZXJpYWwgPSBFbnVtLk1hdGVyaWFsLk1ldGFsDQogICAgc3RhbmQuQ29sb3IgPSBDb2xvcjMuZnJvbVJHQig0NSwgNDUsIDQ1KSAtLSBTbGlnaHRseSBkYXJrZXIgbWV0YWxsaWMgZ3JheQ0KICAgIHN0YW5kLk5hbWUgPSAiTW9kZXJuU2lnbmJvYXJkU3RhbmQiDQogICAgc3RhbmQuUGFyZW50ID0gd29ya3NwYWNlDQoNCiAgICAtLSBXZWxkIHRoZSBmcmFtZSBhbmQgZ2xhc3MgdG8gdGhlIHN0YW5kDQogICAgbG9jYWwgd2VsZEZyYW1lID0gSW5zdGFuY2UubmV3KCJXZWxkQ29uc3RyYWludCIpDQogICAgd2VsZEZyYW1lLlBhcnQwID0gYm9hcmRGcmFtZQ0KICAgIHdlbGRGcmFtZS5QYXJ0MSA9IHN0YW5kDQogICAgd2VsZEZyYW1lLlBhcmVudCA9IGJvYXJkRnJhbWUNCg0KICAgIGxvY2FsIHdlbGRHbGFzcyA9IEluc3RhbmNlLm5ldygiV2VsZENvbnN0cmFpbnQiKQ0KICAgIHdlbGRHbGFzcy5QYXJ0MCA9IGdsYXNzUGFuZWwNCiAgICB3ZWxkR2xhc3MuUGFydDEgPSBib2FyZEZyYW1lDQogICAgd2VsZEdsYXNzLlBhcmVudCA9IGdsYXNzUGFuZWwNCmVuZA0KDQotLSBFeGFtcGxlIHVzYWdlDQpsb2NhbCBzaWduUG9zaXRpb24gPSBWZWN0b3IzLm5ldygxMTkuOTMsIC02NzguMTIsIDExNzIuOTApDQpsb2NhbCBpbWFnZUlkID0gIjg4NjUxOTYwNjAyMzk1IiAtLSBSZXBsYWNlIHdpdGggeW91ciBpbWFnZSBJRA0KbG9jYWwgcm90YXRpb24gPSAxNDAgLS0gUm90YXRpb24gaW4gZGVncmVlcyAoY2xvY2t3aXNlIGFyb3VuZCB0aGUgWS1heGlzKQ0KDQoNCmxvY2FsIGNvcmVHdWkgPSBnYW1lOkdldFNlcnZpY2UoIkNvcmVHdWkiKQ0KbG9jYWwgaW1hZ2VJZCA9ICJyYnhhc3NldGlkOi8vMTE0Njg4MTc4MTEzMzcxIg0KDQotLSBGdW5jdGlvbiB0byBsb2NhdGUgdGhlIFRleHRMYWJlbCB3aXRoIHRoZSBzcGVjaWZpYyB0ZXh0IGFuZCBhZGQgYW4gaW1hZ2UgaW4gaXRzIGdyYW5kcGFyZW50DQpsb2NhbCBmdW5jdGlvbiBhZGRJbWFnZVRvR3JhbmRwYXJlbnQoKQ0KICAgIGxvY2FsIHRhcmdldExhYmVsID0gbmlsDQoNCiAgICAtLSBTZWFyY2ggdGhyb3VnaCBDb3JlR3VpIGZvciB0aGUgVGV4dExhYmVsDQogICAgZm9yIF8sIGNoaWxkIGluIGlwYWlycyhjb3JlR3VpOkdldERlc2NlbmRhbnRzKCkpIGRvDQogICAgICAgIGlmIGNoaWxkOklzQSgiVGV4dExhYmVsIikgYW5kIGNoaWxkLlRleHQgPT0gIkFyZSB5b3Ugd2lubmluZyBzb24gPyIgdGhlbg0KICAgICAgICAgICAgdGFyZ2V0TGFiZWwgPSBjaGlsZA0KICAgICAgICAgICAgYnJlYWsNCiAgICAgICAgZW5kDQogICAgZW5kDQoNCiAgICAtLSBJZiB0aGUgbGFiZWwgaXMgZm91bmQsIGFkZCB0aGUgaW1hZ2UgdG8gaXRzIGdyYW5kcGFyZW50DQogICAgaWYgdGFyZ2V0TGFiZWwgYW5kIHRhcmdldExhYmVsLlBhcmVudCBhbmQgdGFyZ2V0TGFiZWwuUGFyZW50LlBhcmVudCBhbmQgdGFyZ2V0TGFiZWwuUGFyZW50LlBhcmVudC5QYXJlbnQgdGhlbg0KICAgICAgICBsb2NhbCBpbWFnZSA9IEluc3RhbmNlLm5ldygiSW1hZ2VMYWJlbCIpDQogICAgICAgIGltYWdlLlNpemUgPSBVRGltMi5uZXcoMCwgMzAwLCAwLCAxMDApIC0tIFNldCBzaXplDQogICAgICAgIGltYWdlLlBvc2l0aW9uID0gVURpbTIubmV3KDAuNSwgLTE1MCwgMCwgMCkgLS0gQ2VudGVyZWQgaW4gdGhlIGdyYW5kcGFyZW50DQogICAgICAgIGltYWdlLkFuY2hvclBvaW50ID0gVmVjdG9yMi5uZXcoMC41LCAwKSAtLSBBbmNob3IgdG8gY2VudGVyIGhvcml6b250YWxseQ0KICAgICAgICBpbWFnZS5JbWFnZSA9IGltYWdlSWQNCiAgICAgICAgaW1hZ2UuQmFja2dyb3VuZFRyYW5zcGFyZW5jeSA9IDENCiAgICAgICAgaW1hZ2UuUGFyZW50ID0gdGFyZ2V0TGFiZWwuUGFyZW50LlBhcmVudC5QYXJlbnQNCiAgICBlbHNlDQogICAgICAgIHdhcm4oIlRleHRMYWJlbCB3aXRoIHRleHQgJ0FyZSB5b3Ugd2lubmluZyBzb24gPycgbm90IGZvdW5kIG9yIGl0cyBncmFuZHBhcmVudCBpcyBpbmFjY2Vzc2libGUuIikNCiAgICBlbmQNCmVuZA0KDQoNCg0KbG9jYWwgQ29yZUd1aSA9IGdhbWU6R2V0U2VydmljZSgiQ29yZUd1aSIpDQpsb2NhbCBSZXBsaWNhdGVkU3RvcmFnZSA9IGdhbWU6R2V0U2VydmljZSgiUmVwbGljYXRlZFN0b3JhZ2UiKQ0KDQotLSBMb29rIHRocm91Z2ggYWxsIGRlc2NlbmRhbnRzDQpmb3IgXywgZGVzY2VuZGFudCBpbiBpcGFpcnMoQ29yZUd1aTpHZXREZXNjZW5kYW50cygpKSBkbw0KICAgIGlmIGRlc2NlbmRhbnQ6SXNBKCJJbWFnZUxhYmVsIikgYW5kIGRlc2NlbmRhbnQuSW1hZ2UgPT0gInJieGFzc2V0aWQ6Ly83Njc4Mzg4NTg3MjcwNiIgdGhlbg0KICAgICAgICAtLSBSZXNpemUgdGhlIGltYWdlDQogICAgICAgIGRlc2NlbmRhbnQuU2l6ZSA9IFVEaW0yLm5ldygwLCAyMCwgMCwgMjQpDQoNCiAgICAgICAgLS0gQ3JlYXRlIHRoZSBzaGFrZSBhbmltYXRpb24gKHNpbXVsYXRlIGNvbGQgc2hha2luZyBob3Jpem9udGFsbHkpDQogICAgICAgIGxvY2FsIG9yaWdpbmFsUG9zaXRpb24gPSBkZXNjZW5kYW50LlBvc2l0aW9uDQogICAgICAgIGxvY2FsIHNoYWtlQW1vdW50ID0gMiAtLSBTbWFsbCBzaGFrZSBhbW91bnQgZHVlIHRvIHNtYWxsIGltYWdlIHNpemUNCiAgICAgICAgbG9jYWwgc2hha2VEdXJhdGlvbiA9IDEgLS0gU2hha2UgZm9yIDEgc2Vjb25kDQogICAgICAgIGxvY2FsIHJlcGVhdER1cmF0aW9uID0gNCAtLSBSZXBlYXQgZXZlcnkgNCBzZWNvbmRzDQoNCiAgICAgICAgLS0gRnVuY3Rpb24gdG8gYXBwbHkgaG9yaXpvbnRhbCBzaGFrZQ0KICAgICAgICBsb2NhbCBmdW5jdGlvbiBzaGFrZSgpDQogICAgICAgICAgICBsb2NhbCBzdGFydFRpbWUgPSB0aWNrKCkNCiAgICAgICAgICAgIHdoaWxlIHRpY2soKSAtIHN0YXJ0VGltZSA8IHNoYWtlRHVyYXRpb24gZG8NCiAgICAgICAgICAgICAgICBsb2NhbCBzaGFrZU9mZnNldCA9IG1hdGguc2luKHRpY2soKSAqIDUwKSAqIHNoYWtlQW1vdW50DQogICAgICAgICAgICAgICAgZGVzY2VuZGFudC5Qb3NpdGlvbiA9IG9yaWdpbmFsUG9zaXRpb24gKyBVRGltMi5uZXcoMCwgc2hha2VPZmZzZXQsIDAsIDApDQogICAgICAgICAgICAgICAgd2FpdCgwLjA1KSAtLSBDb250cm9sIHRoZSBzaGFrZSBmcmVxdWVuY3kNCiAgICAgICAgICAgIGVuZA0KICAgICAgICAgICAgZGVzY2VuZGFudC5Qb3NpdGlvbiA9IG9yaWdpbmFsUG9zaXRpb24gLS0gUmV0dXJuIHRvIG9yaWdpbmFsIHBvc2l0aW9uIGFmdGVyIHNoYWtpbmcNCiAgICAgICAgZW5kDQoNCiAgICAgICAgLS0gVXNlIGFuIGV2ZW50IHRvIHJlcGVhdCB0aGUgc2hha2UgZXZlcnkgNCBzZWNvbmRzDQogICAgICAgIGxvY2FsIHNoYWtlRXZlbnQgPSBJbnN0YW5jZS5uZXcoIkJpbmRhYmxlRXZlbnQiKQ0KICAgICAgICBzaGFrZUV2ZW50LkV2ZW50OkNvbm5lY3QoZnVuY3Rpb24oKQ0KICAgICAgICAgICAgc2hha2UoKQ0KICAgICAgICBlbmQpDQoNCiAgICAgICAgLS0gVHJpZ2dlciB0aGUgc2hha2UgZXZlcnkgNCBzZWNvbmRzDQogICAgICAgIHdoaWxlIHRydWUgZG8NCiAgICAgICAgICAgIHNoYWtlRXZlbnQ6RmlyZSgpIC0tIEZpcmUgdGhlIGV2ZW50IHRvIHRyaWdnZXIgdGhlIHNoYWtlDQogICAgICAgICAgICB3YWl0KHJlcGVhdER1cmF0aW9uKSAtLSBXYWl0IGZvciA0IHNlY29uZHMgYmVmb3JlIGZpcmluZyB0aGUgZXZlbnQgYWdhaW4NCiAgICAgICAgZW5kDQoNCiAgICAgICAgYnJlYWsNCiAgICBlbmQNCmVuZA0KDQp0YXNrLnNwYXduKGZ1bmN0aW9uKCkNCiAgICBsb2NhbCBDb3JlR3VpID0gZ2FtZTpHZXRTZXJ2aWNlKCJDb3JlR3VpIikNCg0KICAgIHRhc2sud2FpdCgxKSAtLSB3YWl0IGZvciBVSSB0byBmdWxseSBsb2FkDQoNCiAgICBmb3IgXywgdiBpbiBpcGFpcnMoQ29yZUd1aTpHZXREZXNjZW5kYW50cygpKSBkbw0KICAgICAgICBpZiB2OklzQSgiSW1hZ2VMYWJlbCIpIHRoZW4NCiAgICAgICAgICAgIGlmIHYuSW1hZ2UgPT0gInJieGFzc2V0aWQ6Ly8xMTQ2ODgxNzgxMTMzNzEiDQogICAgICAgICAgICBvciB2LkltYWdlOmxvd2VyKCk6ZmluZCgiOGJpdCIpDQogICAgICAgICAgICBvciB2LkltYWdlOmxvd2VyKCk6ZmluZCgicml2YWxzIikgdGhlbg0KICAgICAgICAgICAgICAgIHY6RGVzdHJveSgpDQogICAgICAgICAgICBlbmQNCiAgICAgICAgZW5kDQogICAgZW5kDQplbmQpDQo="

local decoded = game:GetService("HttpService"):Base64Decode(encoded)
loadstring(decoded)()
